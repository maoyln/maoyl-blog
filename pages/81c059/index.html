<h1 id="浏览器语音播放">浏览器语音播放</h1>

<p>官方地址：<a href="https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesisUtterance">https://developer.mozilla.org/zh-CN/docs/Web/API/SpeechSynthesisUtterance</a></p>

<h2 id="语音播放demo">语音播放demo</h2>

<p>::: demo [vanilla]</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"poem"</span><span class="nt">&gt;</span>
     <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content"</span><span class="nt">&gt;</span>
         <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"btn1"</span><span class="nt">&gt;</span>播放<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"close1"</span><span class="nt">&gt;</span>关闭<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"btn2"</span><span class="nt">&gt;</span>重新播放<span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"close2"</span><span class="nt">&gt;</span>播放关闭<span class="nt">&lt;/div&gt;</span>
     <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/html&gt;</span>
<span class="nt">&lt;style&gt;</span>

<span class="nc">.poem</span><span class="p">{</span>
   <span class="c">/* width: 100vw;
   height: 100vh; */</span>
   <span class="nl">height</span><span class="p">:</span> <span class="m">35vh</span><span class="p">;</span>
   <span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
   <span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
   <span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.poem</span><span class="o">,</span><span class="nc">.content</span><span class="nd">::before</span><span class="p">{</span>
   <span class="nl">background</span><span class="p">:</span> <span class="sx">url('https://cdn.jsdelivr.net/gh/maoyln/maoyl-img/blog/autumn-scenery.jpg')</span><span class="p">;</span>
   <span class="nl">background-size</span><span class="p">:</span> <span class="n">cover</span><span class="p">;</span>
   <span class="nl">background-attachment</span><span class="p">:</span> <span class="nb">fixed</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.poem</span> <span class="nc">.content</span><span class="p">{</span>
   <span class="nl">box-sizing</span><span class="p">:</span> <span class="n">border-box</span><span class="p">;</span>
   <span class="nl">color</span><span class="p">:</span><span class="m">#f9f9f9</span><span class="p">;</span>
   <span class="nl">font-size</span><span class="p">:</span> <span class="m">20px</span><span class="p">;</span>
   <span class="nl">line-height</span><span class="p">:</span> <span class="m">2.2em</span><span class="p">;</span>
   <span class="nl">letter-spacing</span><span class="p">:</span> <span class="m">3px</span><span class="p">;</span>
   <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
   <span class="nl">padding</span><span class="p">:</span> <span class="m">40px</span> <span class="m">30px</span> <span class="m">35px</span> <span class="m">40px</span><span class="p">;</span>
   <span class="nl">background</span><span class="p">:</span> <span class="n">hsla</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">0%</span><span class="p">,</span> <span class="m">100%</span><span class="p">,</span> <span class="m">0.3</span><span class="p">);</span>
   <span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
   <span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
   <span class="nl">z-index</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nc">.poem</span> <span class="nc">.content</span><span class="nd">::before</span><span class="p">{</span>
   <span class="nl">content</span><span class="p">:</span> <span class="s2">''</span><span class="p">;</span>
   <span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
   <span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
   <span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
   <span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
   <span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
   <span class="nl">filter</span><span class="p">:</span> <span class="n">blur</span><span class="p">(</span><span class="m">30px</span><span class="p">);</span>
   <span class="nl">margin</span><span class="p">:</span> <span class="m">-30px</span><span class="p">;</span>
   <span class="nl">z-index</span><span class="p">:</span> <span class="m">-1</span><span class="p">;</span>
<span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="kd">function</span> <span class="nx">$</span><span class="p">(</span><span class="nx">el</span><span class="p">){</span>
    <span class="k">return</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">let</span> <span class="nx">speechUtterance</span><span class="p">;</span>
<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#btn1</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">speechSynthesis</span><span class="p">?.</span><span class="nx">cancel</span><span class="p">();</span>
    <span class="nx">speak</span><span class="p">(</span>
        <span class="s2">`Experimental: 这是一个实验中的功能
         此功能某些浏览器尚在开发中，请参考浏览器兼容性表格以得到在不同浏览器中适合使用的前缀。由于该功能对应的标准文档可能被重新修订，所以在未来版本的浏览器中该功能的语法和行为可能随之改变。`</span><span class="p">,</span>
        <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">语音播放结束</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">语音开始播放</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>


<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#btn2</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">speechSynthesis</span><span class="p">?.</span><span class="nx">cancel</span><span class="p">();</span>
    <span class="c1">// window.speechSynthesis.getVoices?.()</span>
    <span class="nx">speak</span><span class="p">(</span>
        <span class="s2">`The SpeechSynthesisUtterance interface of the Web Speech API represents a speech request. It contains the content the speech service should read and information about how to read it (e.g. language, pitch and volume.)`</span><span class="p">,</span>
        <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">语音播放结束</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">},</span>
        <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">语音开始播放</span><span class="dl">'</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">);</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#close1</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">speechSynthesis</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">speechUtterance</span><span class="p">,</span> <span class="dl">'</span><span class="s1">speechUtterance</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">#close2</span><span class="dl">'</span><span class="p">).</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">speechSynthesis</span><span class="p">.</span><span class="nx">cancel</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">speechUtterance</span><span class="p">,</span> <span class="dl">'</span><span class="s1">speechUtterance</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">async</span> <span class="kd">function</span> <span class="nx">speak</span><span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">endEvent</span><span class="p">,</span> <span class="nx">startEvent</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">window</span><span class="p">.</span><span class="nx">SpeechSynthesisUtterance</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="dl">'</span><span class="s1">当前浏览器不支持文字转语音服务</span><span class="dl">'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="o">!</span><span class="nx">speechUtterance</span> <span class="o">&amp;&amp;</span> <span class="p">(</span> <span class="nx">speechUtterance</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SpeechSynthesisUtterance</span><span class="p">()</span> <span class="p">);</span>

    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 读取文字的语速 0.1~10  正常1</span>
    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">lang</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">zh-CN</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 读取文字时的语言</span>
    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">volume</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 读取时声音的音量 0~1  正常1</span>
    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">pitch</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// 读取时声音的音高 0~2  正常1</span>

    <span class="c1">// speechUtterance.voice = await window.speechSynthesis.getVoices()[1] // 设置语言（目前测试有问题）</span>
    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>

    <span class="c1">// 语音播报结束</span>
    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">onend</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">endEvent</span> <span class="o">&amp;&amp;</span> <span class="nx">endEvent</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="c1">// 语音播报开始</span>
    <span class="nx">speechUtterance</span><span class="p">.</span><span class="nx">onstart</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">startEvent</span> <span class="o">&amp;&amp;</span> <span class="nx">startEvent</span><span class="p">();</span>
    <span class="p">};</span>
    <span class="nx">speechSynthesis</span><span class="p">.</span><span class="nx">speak</span><span class="p">(</span><span class="nx">speechUtterance</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">speechUtterance</span><span class="p">;</span>
<span class="p">}</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>:::</p>
