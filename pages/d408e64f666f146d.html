<h1 id="非父子组件间传值">非父子组件间传值</h1>

<p>当组件的嵌套多时，非父子组件间传值就显得复杂，除了使用<a href="https://vuex.vuejs.org/zh/">vuex</a>实现之外，还可以通过Bus（或者叫 总线/发布订阅模式/观察者模式）的方式实现非父子组件间传值。</p>

<!-- more -->

<div id="root">
		<child1 content="组件1：点我传出值"></child1>
		<child2 content="组件2"></child2>
	</div>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"root"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;child1</span> <span class="na">content=</span><span class="s">"组件1：点我传出值"</span><span class="nt">&gt;&lt;/child1&gt;</span>
    <span class="nt">&lt;child2</span> <span class="na">content=</span><span class="s">"组件2"</span><span class="nt">&gt;&lt;/child2&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"text/javascript"</span><span class="nt">&gt;</span>
	<span class="nx">Vue</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">bus</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">()</span>
	<span class="c1">// 每个Vue原型上都会有bus属性,而且指向同一个Vue实例</span>

	<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="dl">'</span><span class="s1">child1</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
		<span class="na">props</span><span class="p">:</span> <span class="p">{</span>
			<span class="na">content</span><span class="p">:</span> <span class="nb">String</span>
		<span class="p">},</span>
		<span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">&lt;button @click="handleClick"&gt;&lt;/button&gt;</span><span class="dl">'</span><span class="p">,</span>
		<span class="na">methods</span><span class="p">:</span> <span class="p">{</span>
			<span class="nx">handleClick</span><span class="p">(){</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">bus</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">我是组件1过来的~</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// 触发change事件，传出值</span>
			<span class="p">}</span>
		<span class="p">}</span>
	<span class="p">})</span>

	<span class="nx">Vue</span><span class="p">.</span><span class="nx">component</span><span class="p">(</span><span class="dl">'</span><span class="s1">child2</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
		<span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">return</span> <span class="p">{</span>
				<span class="na">childVal</span><span class="p">:</span> <span class="dl">''</span>
			<span class="p">}</span>
		<span class="p">},</span>
		<span class="na">props</span><span class="p">:</span> <span class="p">{</span>
			<span class="na">content</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">&lt;button&gt; + &lt;/button&gt;</span><span class="dl">'</span><span class="p">,</span>
		<span class="nx">mounted</span><span class="p">()</span> <span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="nx">bus</span><span class="p">.</span><span class="nx">$on</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="c1">// 绑定change事件，执行函数接收值</span>
				<span class="k">this</span><span class="p">.</span><span class="nx">childVal</span> <span class="o">=</span> <span class="nx">msg</span>
			<span class="p">})</span>
		<span class="p">}</span>
	<span class="p">})</span>

	<span class="kd">var</span> <span class="nx">vm</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
		<span class="na">el</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#root</span><span class="dl">'</span>
	<span class="p">})</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>
<p>上面代码中，在Vue原型上绑定一个<code class="language-plaintext highlighter-rouge">bus</code>属性，指向一个Vue实例，之后每个Vue实例都会有一个<code class="language-plaintext highlighter-rouge">bus</code>属性。</p>

<blockquote>
  <p>此方法传值，不限于兄弟组件之间，其他关系组件间都适用。</p>
</blockquote>

<p class="codepen" data-height="400" data-theme-id="light" data-default-tab="js,result" data-user="xugaoyi" data-slug-hash="wvaGwEj" style="height: 400px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="非父子组件间传值2（Bus /总线/发布订阅模式/观察者模式）">
  <span>See the Pen <a href="https://codepen.io/xugaoyi/pen/wvaGwEj">
  非父子组件间传值2（Bus /总线/发布订阅模式/观察者模式）</a> by xugaoyi (<a href="https://codepen.io/xugaoyi">@xugaoyi</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async="" src="https://static.codepen.io/assets/embed/ei.js"></script>

