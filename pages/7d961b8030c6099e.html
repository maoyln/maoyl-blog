<h1 id="dom">DOM</h1>

<h2 id="一概述">一、概述</h2>

<h3 id="1dom">1、DOM</h3>

<p><strong>DOM 是 JavaScript 操作网页的接口</strong>，全称为“<strong>文档对象模型</strong>”（Document Object Model）。它的<strong>作用</strong>是<strong>将网页转为一个 JavaScript 对象，从而可以用脚本进行各种操作</strong>（比如增删内容）。</p>

<p>浏览器会根据 DOM 模型，将结构化文档（比如 HTML 和 XML）解析成一系列的节点，再由这些节点组成一个树状结构（DOM Tree）。所有的节点和最终的树状结构，都有规范的对外接口。</p>

<p>DOM 只是一个接口规范，可以用各种语言实现。所以严格地说，DOM 不是 JavaScript 语法的一部分，但是 DOM 操作是 JavaScript 最常见的任务，离开了 DOM，JavaScript 就无法控制网页。另一方面，JavaScript 也是最常用于 DOM 操作的语言。后面介绍的就是 JavaScript 对 DOM 标准的实现和用法。</p>

<h3 id="2节点">2、节点</h3>

<p><strong>DOM 的最小组成单位叫做节点（node）</strong>。文档的树形结构（DOM 树），就是由各种不同类型的节点组成。每个节点可以看作是文档树的一片叶子。</p>

<p>节点的类型有七种。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Document</code>：整个文档树的顶层节点</li>
  <li><code class="language-plaintext highlighter-rouge">DocumentType</code>：<code class="language-plaintext highlighter-rouge">doctype</code>标签（比如<code class="language-plaintext highlighter-rouge"> &lt;!DOCTYPE html&gt; </code>）</li>
  <li><code class="language-plaintext highlighter-rouge">Element</code>：网页的各种HTML标签（比如<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>、<code class="language-plaintext highlighter-rouge">  &lt;a&gt;  </code>等）</li>
  <li><code class="language-plaintext highlighter-rouge">Attribute</code>：网页元素的属性（比如<code class="language-plaintext highlighter-rouge">class="right"</code>）</li>
  <li><code class="language-plaintext highlighter-rouge">Text</code>：标签之间或标签包含的文本</li>
  <li><code class="language-plaintext highlighter-rouge">Comment</code>：注释</li>
  <li><code class="language-plaintext highlighter-rouge">DocumentFragment</code>：文档的片段</li>
</ul>

<p>浏览器提供一个原生的节点对象<code class="language-plaintext highlighter-rouge">Node</code>，上面这七种节点都继承了<code class="language-plaintext highlighter-rouge">Node</code>，因此具有一些共同的属性和方法。</p>

<h3 id="3节点树">3、节点树</h3>

<p>一个文档的所有节点，按照所在的层级，可以抽象成一种树状结构。这种树状结构就是 DOM 树。它有一个顶层节点，下一层都是顶层节点的子节点，然后子节点又有自己的子节点，就这样层层衍生出一个金字塔结构，倒过来就像一棵树。</p>

<p>浏览器原生提供<code class="language-plaintext highlighter-rouge">document</code>节点，代表整个文档。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span>
<span class="c1">// 整个文档树</span>
</code></pre></div></div>

<p>文档的第一层有两个节点，第一个是文档类型节点（<code class="language-plaintext highlighter-rouge"> &lt;!doctype html&gt; </code>），第二个是 HTML 网页的顶层容器标签<code class="language-plaintext highlighter-rouge"> &lt;html&gt; </code>。后者构成了树结构的根节点（root node），其他 HTML 标签节点都是它的下级节点。</p>

<p>除了根节点，其他节点都有三种层级关系。</p>

<ul>
  <li>父节点关系（parentNode）：直接的那个上级节点</li>
  <li>子节点关系（childNodes）：直接的下级节点</li>
  <li>同级节点关系（sibling）：拥有同一个父节点的节点</li>
</ul>

<p>DOM 提供操作接口，用来获取这三种关系的节点。比如，子节点接口包括<code class="language-plaintext highlighter-rouge">firstChild</code>（第一个子节点）和<code class="language-plaintext highlighter-rouge">lastChild</code>（最后一个子节点）等属性，同级节点接口包括<code class="language-plaintext highlighter-rouge">nextSibling</code>（紧邻在后的那个同级节点）和<code class="language-plaintext highlighter-rouge">previousSibling</code>（紧邻在前的那个同级节点）属性。</p>

<h2 id="二node接口">二、Node接口</h2>

<p><strong>所有 DOM 节点对象都继承了 Node 接口，拥有一些共同的属性和方法</strong>。这是 DOM 操作的基础。</p>

<h3 id="1属性">1、属性</h3>

<h4 id="11-nodeprototypenodetype节点类型">1.1 Node.prototype.nodeType节点类型</h4>

<p><code class="language-plaintext highlighter-rouge">nodeType</code>属性<strong>返回一个整数值，表示节点的类型</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">nodeType</span> <span class="c1">// 9</span>
</code></pre></div></div>

<p>上面代码中，文档节点的类型值为9。</p>

<p>Node 对象定义了几个常量，对应这些类型值。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">DOCUMENT_NODE</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码中，文档节点的<code class="language-plaintext highlighter-rouge">nodeType</code>属性等于常量<code class="language-plaintext highlighter-rouge">Node.DOCUMENT_NODE</code>。</p>

<p>不同节点的<code class="language-plaintext highlighter-rouge">nodeType</code>属性值和对应的常量如下。</p>

<ul>
  <li>文档节点（document）：9，对应常量<code class="language-plaintext highlighter-rouge">Node.DOCUMENT_NODE</code></li>
  <li>元素节点（element）：1，对应常量<code class="language-plaintext highlighter-rouge">Node.ELEMENT_NODE</code></li>
  <li>属性节点（attr）：2，对应常量<code class="language-plaintext highlighter-rouge">Node.ATTRIBUTE_NODE</code></li>
  <li>文本节点（text）：3，对应常量<code class="language-plaintext highlighter-rouge">Node.TEXT_NODE</code></li>
  <li>文档片断节点（DocumentFragment）：11，对应常量<code class="language-plaintext highlighter-rouge">Node.DOCUMENT_FRAGMENT_NODE</code></li>
  <li>文档类型节点（DocumentType）：10，对应常量<code class="language-plaintext highlighter-rouge">Node.DOCUMENT_TYPE_NODE</code></li>
  <li>注释节点（Comment）：8，对应常量<code class="language-plaintext highlighter-rouge">Node.COMMENT_NODE</code></li>
</ul>

<p>确定节点类型时，使用<code class="language-plaintext highlighter-rouge">nodeType</code>属性是常用方法。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span> <span class="c1">// 获取到&lt;head&gt;节点</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">nodeType</span> <span class="o">===</span> <span class="nx">Node</span><span class="p">.</span><span class="nx">ELEMENT_NODE</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">该节点是元素节点</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="12-nodeprototypenodename节点名称">1.2 Node.prototype.nodeName节点名称</h4>

<p><code class="language-plaintext highlighter-rouge">nodeName</code>属性<strong>返回节点的名称</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="d1"&gt;hello world&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "DIV"</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// #document</span>
</code></pre></div></div>

<p>上面代码中，元素节点<code class="language-plaintext highlighter-rouge">  &lt;div&gt;  </code>的<code class="language-plaintext highlighter-rouge">nodeName</code>属性就是大写的标签名<code class="language-plaintext highlighter-rouge">DIV</code>。</p>

<p>不同节点的<code class="language-plaintext highlighter-rouge">nodeName</code>属性值如下。</p>

<ul>
  <li>文档节点（document）：<code class="language-plaintext highlighter-rouge">#document</code></li>
  <li>元素节点（element）：大写的标签名，如DIV</li>
  <li>属性节点（attr）：属性的名称</li>
  <li>文本节点（text）：<code class="language-plaintext highlighter-rouge">#text</code></li>
  <li>文档片断节点（DocumentFragment）：<code class="language-plaintext highlighter-rouge">#document-fragment</code></li>
  <li>文档类型节点（DocumentType）：文档的类型</li>
  <li>注释节点（Comment）：<code class="language-plaintext highlighter-rouge">#comment</code></li>
</ul>

<h4 id="13-nodeprototypenodevalue当前节点文本">1.3 Node.prototype.nodeValue当前节点文本</h4>

<p><code class="language-plaintext highlighter-rouge">nodeValue</code>属性<strong>返回一个字符串，表示当前节点本身的文本值</strong>，该属性<strong>可读写</strong>。</p>

<p>只有<strong>文本节点（text）、注释节点（comment）和属性节点（attr）有文本值</strong>，因此这三类节点的<code class="language-plaintext highlighter-rouge">nodeValue</code>可以返回结果，其他类型的节点一律返回<code class="language-plaintext highlighter-rouge">null</code>。同样的，也只有这三类节点可以设置<code class="language-plaintext highlighter-rouge">nodeValue</code>属性的值，其他类型的节点设置无效。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="d1"&gt;hello world&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">nodeValue</span> <span class="c1">// null</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span> <span class="c1">// "hello world"</span>

<span class="kd">var</span> <span class="nx">textNode</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">textNode</span><span class="p">)</span> <span class="c1">// 文本节点对象"hello world"</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">typeof</span> <span class="nx">textNode</span><span class="p">)</span> <span class="c1">// object</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">textNode</span><span class="p">.</span><span class="nx">nodeType</span><span class="p">)</span> <span class="c1">// 3</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">textNode</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">)</span> <span class="c1">// #text</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">textNode</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">)</span> <span class="c1">// 'hello world'</span>

<span class="nx">textNode</span><span class="p">.</span><span class="nx">nodeValue</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span> <span class="c1">// 修改文本</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">textNode</span><span class="p">.</span><span class="nx">nodeValue</span><span class="p">)</span> <span class="c1">// '123'</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">div</code>是元素节点，<code class="language-plaintext highlighter-rouge">nodeValue</code>属性返回<code class="language-plaintext highlighter-rouge">null</code>。<code class="language-plaintext highlighter-rouge">div.firstChild</code>是文本节点，所以可以返回文本值。</p>

<h4 id="14-nodeprototypetextcontent所有文本内容">1.4 Node.prototype.textContent所有文本内容</h4>

<p><code class="language-plaintext highlighter-rouge">textContent</code>属性<strong>返回当前节点和它的所有后代节点的文本内容</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="divA"&gt;This is &lt;span&gt;some&lt;/span&gt; text&lt;/div&gt;</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">divA</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span>
<span class="c1">// This is some text</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">textContent</code>属性自动忽略当前节点内部的 HTML 标签，返回所有文本内容。</p>

<p>该属性是<strong>可读写</strong>的，设置该属性的值，会用一个新的文本节点，替换所有原来的子节点。它还有一个好处，就是自动对 HTML 标签转义。这很适合用于用户提供的内容。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;p&gt;GoodBye!&lt;/p&gt;</span><span class="dl">'</span><span class="p">;</span> <span class="c1">// 写入文本</span>
</code></pre></div></div>

<p>上面代码在插入文本时，<strong>会将<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>标签解释为文本</strong>，而不会当作标签处理。</p>

<p>对于文本节点（text）、注释节点（comment）和属性节点（attr），<code class="language-plaintext highlighter-rouge">textContent</code>属性的值与<code class="language-plaintext highlighter-rouge">nodeValue</code>属性相同。对于其他类型的节点，该属性会将每个子节点（不包括注释节点）的内容连接在一起返回。如果一个节点没有子节点，则返回空字符串。</p>

<p>文档节点（document）和文档类型节点（doctype）的<code class="language-plaintext highlighter-rouge">textContent</code>属性为<code class="language-plaintext highlighter-rouge">null</code>。如果要<strong>读取整个文档的内容</strong>，可以使用<code class="language-plaintext highlighter-rouge">document.documentElement.textContent</code>。</p>

<h4 id="15-nodeprototypebaseuri-获取网页路径">1.5 Node.prototype.baseURI 获取网页路径</h4>

<p><code class="language-plaintext highlighter-rouge">baseURI</code>属性<strong>返回一个字符串，表示当前网页的绝对路径</strong>。浏览器根据这个属性，计算网页上的相对路径的 URL。该属性为<strong>只读</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 当前网页的网址为</span>
<span class="c1">// http://www.example.com/index.html</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">baseURI</span>
<span class="c1">// "http://www.example.com/index.html"</span>
</code></pre></div></div>

<p>如果无法读到网页的 URL，<code class="language-plaintext highlighter-rouge">baseURI</code>属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<p>该属性的值一般由当前网址的 URL（即<code class="language-plaintext highlighter-rouge">window.location</code>属性）决定，但是可以使用 HTML 的<code class="language-plaintext highlighter-rouge"> &lt;base&gt; </code>标签，改变该属性的值。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;head&gt;</span>
<span class="nt">&lt;base</span> <span class="na">href=</span><span class="s">"http://www.example.com/page.html"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">baseURI</span> <span class="c1">// http://www.example.com/page.html   返回base标签的href值</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<p>设置了以后，<code class="language-plaintext highlighter-rouge">baseURI</code>属性就返回<code class="language-plaintext highlighter-rouge"> &lt;base&gt; </code>标签设置的值。</p>

<h4 id="16-nodeprototypeownerdocument顶层文档对象">1.6 Node.prototype.ownerDocument顶层文档对象</h4>

<p><code class="language-plaintext highlighter-rouge">Node.ownerDocument</code>属性<strong>返回当前节点所在的顶层文档对象</strong>，即<code class="language-plaintext highlighter-rouge">document</code>对象。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">ownerDocument</span><span class="p">;</span>
<span class="nx">d</span> <span class="o">===</span> <span class="nb">document</span> <span class="c1">// true</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document</code>对象本身的<code class="language-plaintext highlighter-rouge">ownerDocument</code>属性，返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h4 id="17-nodeprototypenextsibling下一个同级节点">1.7 Node.prototype.nextSibling下一个同级节点</h4>

<p><code class="language-plaintext highlighter-rouge">Node.nextSibling</code>属性<strong>返回紧跟在当前节点后面的第一个同级节点</strong>。如果当前节点后面没有同级节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="d1"&gt;hello&lt;/div&gt;&lt;div id="d2"&gt;world&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d1</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">d2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d2</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">d1</span><span class="p">.</span><span class="nx">nextSibling</span> <span class="o">===</span> <span class="nx">d2</span> <span class="c1">// true  // 如果d1和d2之间有空格，会返回文本节点，内容为空格</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">d1.nextSibling</code>就是紧跟在<code class="language-plaintext highlighter-rouge">d1</code>后面的同级节点<code class="language-plaintext highlighter-rouge">d2</code>。</p>

<p><strong>注意</strong>，该属性还包括文本节点和注释节点（<code class="language-plaintext highlighter-rouge"> &lt;!-- comment --&gt; </code>）。因此如果当前节点后面有空格，该属性会返回一个文本节点，内容为空格。</p>

<p><code class="language-plaintext highlighter-rouge">nextSibling</code>属性可以用来遍历所有子节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div1</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">;</span>

<span class="k">while</span> <span class="p">(</span><span class="nx">el</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">nodeName</span><span class="p">);</span>
  <span class="nx">el</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码遍历<code class="language-plaintext highlighter-rouge">div1</code>节点的所有子节点。</p>

<h4 id="18-nodeprototypeprevioussibling上一个同级节点">1.8 Node.prototype.previousSibling上一个同级节点</h4>

<p><code class="language-plaintext highlighter-rouge">previousSibling</code>属性<strong>返回当前节点前面的、距离最近的一个同级节点</strong>。如果当前节点前面没有同级节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="d1"&gt;hello&lt;/div&gt;&lt;div id="d2"&gt;world&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d1</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">d2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d2</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">d2</span><span class="p">.</span><span class="nx">previousSibling</span> <span class="o">===</span> <span class="nx">d1</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">d2.previousSibling</code>就是<code class="language-plaintext highlighter-rouge">d2</code>前面的同级节点<code class="language-plaintext highlighter-rouge">d1</code>。</p>

<p><strong>注意</strong>，该属性还包括文本节点和注释节点。因此如果当前节点前面有空格，该属性会返回一个文本节点，内容为空格。</p>

<h4 id="19-nodeprototypeparentnode父节点">1.9 Node.prototype.parentNode父节点</h4>

<p><code class="language-plaintext highlighter-rouge">parentNode</code>属性<strong>返回当前节点的父节点</strong>。对于一个节点来说，它的父节点只可能是三种类型：元素节点（element）、文档节点（document）和文档片段节点（documentfragment）。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">node</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span> <span class="c1">// node的父节点，然后删除子节点node</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，通过<code class="language-plaintext highlighter-rouge">node.parentNode</code>属性将<code class="language-plaintext highlighter-rouge">node</code>节点从文档里面移除。</p>

<p>文档节点（document）和文档片段节点（documentfragment）的父节点都是<code class="language-plaintext highlighter-rouge">null</code>。另外，对于那些生成后还没插入 DOM 树的节点，父节点也是<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h4 id="110-nodeprototypeparentelement-父元素节点">1.10 Node.prototype.parentElement 父元素节点</h4>

<p><code class="language-plaintext highlighter-rouge">parentElement</code>属性<strong>返回当前节点的父元素节点</strong>。如果当前节点没有父节点，或者父节点类型不是元素节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if (node.parentElement) {
  node.parentElement.style.color = 'red';
}
</code></pre></div></div>

<p>上面代码中，父元素节点的样式设定了红色。</p>

<p>由于父节点只可能是三种类型：元素节点、文档节点（document）和文档片段节点（documentfragment）。<code class="language-plaintext highlighter-rouge">parentElement</code>属性相当于把后两种父节点都排除了。</p>

<h4 id="111-nodeprototypefirstchild-第一个子节点nodeprototypelastchild-最后一个子节点">1.11 Node.prototype.firstChild 第一个子节点，Node.prototype.lastChild 最后一个子节点</h4>

<p><code class="language-plaintext highlighter-rouge">firstChild</code>属性<strong>返回当前节点的第一个子节点</strong>，如果当前节点没有子节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;p id="p1"&gt;&lt;span&gt;First span&lt;/span&gt;&lt;/p&gt;</span>
<span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">p1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">p1</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "SPAN"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">p</code>元素的第一个子节点是<code class="language-plaintext highlighter-rouge">span</code>元素。</p>

<p><strong>注意</strong>，<code class="language-plaintext highlighter-rouge">firstChild</code>返回的除了元素节点，<strong>还可能是文本节点或注释节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;p id="p1"&gt;</span>
<span class="c1">//   &lt;span&gt;First span&lt;/span&gt;</span>
<span class="c1">//  &lt;/p&gt;</span>
<span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">p1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">p1</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "#text"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">p</code>元素与<code class="language-plaintext highlighter-rouge">span</code>元素之间有空白字符，这导致<code class="language-plaintext highlighter-rouge">firstChild</code>返回的是文本节点。</p>

<p><code class="language-plaintext highlighter-rouge">lastChild</code>属性<strong>返回当前节点的最后一个子节点</strong>，如果当前节点没有子节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。用法与<code class="language-plaintext highlighter-rouge">firstChild</code>属性相同。</p>

<h4 id="112-nodeprototypechildnodes-所有子节点类数组对象动态集合">1.12 Node.prototype.childNodes 所有子节点，类数组对象，动态集合</h4>

<p><code class="language-plaintext highlighter-rouge">childNodes</code>属性<strong>返回一个类似数组的对象</strong>（<code class="language-plaintext highlighter-rouge">NodeList</code>集合），<strong>成员包括当前节点的所有子节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">childNodes</span><span class="p">;</span> <span class="c1">// 包含元素节点、文本节点、注释节点</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">children</code>就是<code class="language-plaintext highlighter-rouge">ul</code>元素的所有子节点。</p>

<p>使用该属性，可以遍历某个节点的所有子节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div1</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>文档节点（document）就有两个子节点：文档类型节点（docType）和 HTML 根元素节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">nodeType</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 10</span>
<span class="c1">// 1</span>
</code></pre></div></div>

<p>上面代码中，文档节点的第一个子节点的类型是10（即文档类型节点），第二个子节点的类型是1（即元素节点）。</p>

<p><strong>注意</strong>，除了元素节点，<code class="language-plaintext highlighter-rouge">childNodes</code>属性的返回值<strong>还包括文本节点和注释节点</strong>。如果当前节点不包括任何子节点，则返回一个空的<code class="language-plaintext highlighter-rouge">NodeList</code>集合。由于<code class="language-plaintext highlighter-rouge">NodeList</code>对象是一个<strong>动态集合</strong>，一旦子节点发生变化，立刻会反映在返回结果之中。</p>

<h4 id="113-nodeprototypeisconnected-是否在文档中布尔值">1.13 Node.prototype.isConnected 是否在文档中，布尔值</h4>

<p><code class="language-plaintext highlighter-rouge">isConnected</code>属性<strong>返回一个布尔值，表示当前节点是否在文档之中</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">test</span><span class="p">.</span><span class="nx">isConnected</span> <span class="c1">// false</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">test</span><span class="p">);</span>
<span class="nx">test</span><span class="p">.</span><span class="nx">isConnected</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">test</code>节点是脚本生成的节点，没有插入文档之前，<code class="language-plaintext highlighter-rouge">isConnected</code>属性返回<code class="language-plaintext highlighter-rouge">false</code>，插入之后返回<code class="language-plaintext highlighter-rouge">true</code>。</p>

<h3 id="2方法">2、方法</h3>

<h4 id="21-nodeprototypeappendchild-插入子节点到最后">2.1 Node.prototype.appendChild() 插入子节点到最后</h4>

<p><code class="language-plaintext highlighter-rouge">appendChild()</code>方法<strong>接受一个节点对象作为参数，将其作为最后一个子节点，插入当前节点</strong>。该方法的<strong>返回值就是插入文档的子节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span> <span class="c1">// 有返回值，为已插入的p节点</span>
</code></pre></div></div>

<p>上面代码新建一个<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>节点，将其插入<code class="language-plaintext highlighter-rouge">document.body</code>的尾部。</p>

<p>如果参数节点是 DOM 已经存在的节点，<code class="language-plaintext highlighter-rouge">appendChild()</code>方法会将其从原来的位置，移动到新位置。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">);</span><span class="c1">// myDiv是已存在的元素</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span> <span class="c1">// 插入已存在元素，相当于移动位置</span>
</code></pre></div></div>

<p>上面代码中，插入的是一个已经存在的节点<code class="language-plaintext highlighter-rouge">myDiv</code>，结果就是该节点会从原来的位置，移动到<code class="language-plaintext highlighter-rouge">document.body</code>的尾部。</p>

<p>如果<code class="language-plaintext highlighter-rouge">appendChild()</code>方法的参数是<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点，那么插入的是<code class="language-plaintext highlighter-rouge">DocumentFragment</code>的所有子节点，而不是<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点本身。返回值是一个空的<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点。</p>

<h4 id="22-nodeprototypehaschildnodes-是否有子节点布尔值">2.2 Node.prototype.hasChildNodes() 是否有子节点，布尔值</h4>

<p><code class="language-plaintext highlighter-rouge">hasChildNodes</code>方法返回一个<strong>布尔值</strong>，<strong>表示当前节点是否有子节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">hasChildNodes</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">foo</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">foo</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码表示，如果<code class="language-plaintext highlighter-rouge">foo</code>节点有子节点，就移除第一个子节点。</p>

<p><strong>注意</strong>，<strong>子节点包括所有类型的节点</strong>，并不仅仅是元素节点。哪怕节点只包含一个空格，<code class="language-plaintext highlighter-rouge">hasChildNodes</code>方法也会返回<code class="language-plaintext highlighter-rouge">true</code>。</p>

<p>判断一个节点有没有子节点，有许多种方法，下面是其中的三种。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">node.hasChildNodes()</code></li>
  <li><code class="language-plaintext highlighter-rouge">node.firstChild !== null</code></li>
  <li><code class="language-plaintext highlighter-rouge">node.childNodes &amp;&amp; node.childNodes.length &gt; 0</code></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">hasChildNodes</code>方法结合<code class="language-plaintext highlighter-rouge">firstChild</code>属性和<code class="language-plaintext highlighter-rouge">nextSibling</code>属性，可以<strong>遍历当前节点的所有后代节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">DOMComb</span><span class="p">(</span><span class="nx">parent</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">hasChildNodes</span><span class="p">())</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">parent</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span> <span class="nx">node</span><span class="p">;</span> <span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">DOMComb</span><span class="p">(</span><span class="nx">node</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">callback</span><span class="p">(</span><span class="nx">parent</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 用法</span>
<span class="nx">DOMComb</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">DOMComb</code>函数的第一个参数是某个指定的节点，第二个参数是回调函数。这个回调函数会依次作用于指定节点，以及指定节点的所有后代节点。</p>

<h4 id="23-nodeprototypeclonenodeboolean-克隆节点">2.3 Node.prototype.cloneNode(Boolean) 克隆节点</h4>

<p><code class="language-plaintext highlighter-rouge">cloneNode</code>方法用于<strong>克隆一个节点</strong>。<strong>它接受一个布尔值作为参数，表示是否同时克隆子节点</strong>。它的返回值是一个克隆出来的新节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">cloneUL</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
</code></pre></div></div>

<p>该方法有一些使用<strong>注意点</strong>。</p>

<p>（1）克隆一个节点，会拷贝该节点的所有属性，但是会丧失<code class="language-plaintext highlighter-rouge">addEventListener</code>方法和<code class="language-plaintext highlighter-rouge">on-</code>属性（即<code class="language-plaintext highlighter-rouge">node.onclick = fn</code>），添加在这个节点上的事件回调函数。</p>

<p>（2）该方法返回的节点不在文档之中，即没有任何父节点，必须使用诸如<code class="language-plaintext highlighter-rouge">Node.appendChild</code>这样的方法添加到文档之中。</p>

<p>（3）克隆一个节点之后，DOM 有可能出现两个有相同<code class="language-plaintext highlighter-rouge">id</code>属性（即<code class="language-plaintext highlighter-rouge">id="xxx"</code>）的网页元素，这时应该修改其中一个元素的<code class="language-plaintext highlighter-rouge">id</code>属性。如果原节点有<code class="language-plaintext highlighter-rouge">name</code>属性，可能也需要修改。</p>

<h4 id="24-nodeprototypeinsertbefore-插入节点到指定位置">2.4 Node.prototype.insertBefore() 插入节点到指定位置</h4>

<p><code class="language-plaintext highlighter-rouge">insertBefore</code>方法用于<strong>将某个节点插入父节点内部的指定位置</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">insertedNode</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">newNode</span><span class="p">,</span> <span class="nx">referenceNode</span><span class="p">);</span>
<span class="c1">// newNode新节点将插入到parentNode内部的referenceNode节点前面，并返回新节点</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">insertBefore</code>方法接受两个参数，第一个参数是所要插入的节点<code class="language-plaintext highlighter-rouge">newNode</code>，第二个参数是父节点<code class="language-plaintext highlighter-rouge">parentNode</code>内部的一个子节点<code class="language-plaintext highlighter-rouge">referenceNode</code>。<code class="language-plaintext highlighter-rouge">newNode</code>将插在<code class="language-plaintext highlighter-rouge">referenceNode</code>这个子节点的前面。返回值是插入的新节点<code class="language-plaintext highlighter-rouge">newNode</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span><span class="c1">// 把p节点插入到body内部第一个元素的前面</span>
</code></pre></div></div>

<p>上面代码中，新建一个<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>节点，插在<code class="language-plaintext highlighter-rouge">document.body.firstChild</code>的前面，也就是成为<code class="language-plaintext highlighter-rouge">document.body</code>的第一个子节点。</p>

<p>如果<code class="language-plaintext highlighter-rouge">insertBefore</code>方法的第二个参数为<code class="language-plaintext highlighter-rouge">null</code>，则新节点将插在当前节点内部的最后位置，即变成最后一个子节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">p</code>将成为<code class="language-plaintext highlighter-rouge">document.body</code>的最后一个子节点。这也说明<code class="language-plaintext highlighter-rouge">insertBefore</code>的第二个参数不能省略。</p>

<p><strong>注意</strong>，如果所要插入的节点是当前 DOM 现有的节点，则该节点将从原有的位置移除，插入新的位置。</p>

<p>由于不存在<code class="language-plaintext highlighter-rouge">insertAfter</code>方法，如果新节点要插在父节点的<strong>某个子节点后面</strong>，可以用<code class="language-plaintext highlighter-rouge">insertBefore</code>方法结合<code class="language-plaintext highlighter-rouge">nextSibling</code>属性模拟。</p>

<p><strong>插入到某个子节点后面</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">parent</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">s1</span><span class="p">,</span> <span class="nx">s2</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">parent</code>是父节点，<code class="language-plaintext highlighter-rouge">s1</code>是一个全新的节点，<code class="language-plaintext highlighter-rouge">s2</code>是可以将<code class="language-plaintext highlighter-rouge">s1</code>节点，插在<code class="language-plaintext highlighter-rouge">s2</code>节点的后面。如果<code class="language-plaintext highlighter-rouge">s2</code>是当前节点的最后一个子节点，则<code class="language-plaintext highlighter-rouge">s2.nextSibling</code>返回<code class="language-plaintext highlighter-rouge">null</code>，这时<code class="language-plaintext highlighter-rouge">s1</code>节点会插在当前节点的最后，变成当前节点的最后一个子节点，等于紧跟在<code class="language-plaintext highlighter-rouge">s2</code>的后面。</p>

<p>如果要插入的节点是<code class="language-plaintext highlighter-rouge">DocumentFragment</code>类型，那么插入的将是<code class="language-plaintext highlighter-rouge">DocumentFragment</code>的所有子节点，而不是<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点本身。返回值将是一个空的<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点。</p>

<h4 id="25-nodeprototyperemovechild-删除子节点并返回">2.5 Node.prototype.removeChild() 删除子节点，并返回</h4>

<p><code class="language-plaintext highlighter-rouge">removeChild</code>方法<strong>接受一个子节点作为参数，用于从当前节点移除该子节点。返回值是移除的子节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">divA</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">A</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">divA</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">divA</span><span class="p">);</span> <span class="c1">// 先获取父节点再调用删除子节点方法，并指定删除的子节点为divA</span>
</code></pre></div></div>

<p>上面代码移除了<code class="language-plaintext highlighter-rouge">divA</code>节点。<strong>注意，这个方法是在<code class="language-plaintext highlighter-rouge">divA</code>的父节点上调用的，不是在<code class="language-plaintext highlighter-rouge">divA</code>上调用的。</strong></p>

<p>下面是如何<strong>移除当前节点的所有子节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">top</span><span class="dl">'</span><span class="p">);</span>
<span class="k">while</span> <span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">element</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">element</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>被移除的节点依然存在于内存之中</strong>，但不再是 DOM 的一部分。所以，一个节点移除以后，依然可以使用它，比如插入到另一个节点下面。</p>

<p>如果参数节点不是当前节点的子节点，<code class="language-plaintext highlighter-rouge">removeChild</code>方法将报错。</p>

<h4 id="26-nodeprototypereplacechild-替换子节点返回被替换的">2.6 Node.prototype.replaceChild() 替换子节点，返回被替换的</h4>

<p><code class="language-plaintext highlighter-rouge">replaceChild</code>方法<strong>用于将一个新的节点，替换当前节点的某一个子节点</strong>。<strong>返回被替换的子节点。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">replacedNode</span> <span class="o">=</span> <span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">newChild</span><span class="p">,</span> <span class="nx">oldChild</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">replaceChild</code>方法接受两个参数，第一个参数<code class="language-plaintext highlighter-rouge">newChild</code>是用来替换的新节点，第二个参数<code class="language-plaintext highlighter-rouge">oldChild</code>是将要替换走的子节点。返回值是替换走的那个节点<code class="language-plaintext highlighter-rouge">oldChild</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">divA</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">divA</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">newSpan</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">newSpan</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello World!</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">divA</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span><span class="nx">newSpan</span><span class="p">,</span> <span class="nx">divA</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码是将指定节点<code class="language-plaintext highlighter-rouge">divA</code>替换为新节点<code class="language-plaintext highlighter-rouge">newSpan</code>。</p>

<h4 id="27-nodeprototypecontains-参数节点是否为后代节点或当前节点返回布尔值">2.7 Node.prototype.contains() 参数节点是否为后代节点或当前节点，返回布尔值</h4>

<p><code class="language-plaintext highlighter-rouge">contains</code>方法<strong>返回一个布尔值，表示参数节点是否满足以下三个条件之一</strong>。</p>

<ul>
  <li>参数节点为当前节点。</li>
  <li>参数节点为当前节点的子节点。</li>
  <li>参数节点为当前节点的后代节点。</li>
</ul>

<p><strong>当前节点中是否包含参数节点</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码检查参数节点<code class="language-plaintext highlighter-rouge">node</code>，是否包含在当前文档之中。</p>

<p><strong>注意</strong>，当前节点传入<code class="language-plaintext highlighter-rouge">contains</code>方法，返回<code class="language-plaintext highlighter-rouge">true</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">nodeA</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">nodeA</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="28-nodeprototypecomparedocumentposition-和contains方法类似返回值可算出位置关系">2.8 Node.prototype.compareDocumentPosition() 和contains方法类似，返回值可算出位置关系</h4>

<p><code class="language-plaintext highlighter-rouge">compareDocumentPosition</code>方法的用法，<strong>与<code class="language-plaintext highlighter-rouge">contains</code>方法完全一致，返回一个六个比特位的二进制值，表示参数节点与当前节点的关系</strong>。</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">二进制值</th>
      <th style="text-align: left">十进制值</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">000000</td>
      <td style="text-align: left">0</td>
      <td style="text-align: left">两个节点相同</td>
    </tr>
    <tr>
      <td style="text-align: left">000001</td>
      <td style="text-align: left">1</td>
      <td style="text-align: left">两个节点不在同一个文档（即有一个节点不在当前文档）</td>
    </tr>
    <tr>
      <td style="text-align: left">000010</td>
      <td style="text-align: left">2</td>
      <td style="text-align: left">参数节点在当前节点的前面</td>
    </tr>
    <tr>
      <td style="text-align: left">000100</td>
      <td style="text-align: left">4</td>
      <td style="text-align: left">参数节点在当前节点的后面</td>
    </tr>
    <tr>
      <td style="text-align: left">001000</td>
      <td style="text-align: left">8</td>
      <td style="text-align: left">参数节点包含当前节点</td>
    </tr>
    <tr>
      <td style="text-align: left">010000</td>
      <td style="text-align: left">16</td>
      <td style="text-align: left">当前节点包含参数节点</td>
    </tr>
    <tr>
      <td style="text-align: left">100000</td>
      <td style="text-align: left">32</td>
      <td style="text-align: left">浏览器内部使用</td>
    </tr>
  </tbody>
</table>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="mydiv"&gt;</span>
<span class="c1">//   &lt;form&gt;&lt;input id="test" /&gt;&lt;/form&gt;</span>
<span class="c1">// &lt;/div&gt;</span>

<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">input</span><span class="p">)</span> <span class="c1">// 20 当前节点包含参数节点（16）+ 参数节点在当前节点的后面（4）</span>
<span class="nx">input</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">div</span><span class="p">)</span> <span class="c1">// 10 参数节点包含当前节点（8）+ 参数节点在当前节点的前面（2）</span>
</code></pre></div></div>

<p>上面代码中，节点<code class="language-plaintext highlighter-rouge">div</code>包含节点<code class="language-plaintext highlighter-rouge">input</code>（二进制<code class="language-plaintext highlighter-rouge">010000</code>），而且节点<code class="language-plaintext highlighter-rouge">input</code>在节点<code class="language-plaintext highlighter-rouge">div</code>的后面（二进制<code class="language-plaintext highlighter-rouge">000100</code>），所以第一个<code class="language-plaintext highlighter-rouge">compareDocumentPosition</code>方法返回<code class="language-plaintext highlighter-rouge">20</code>（二进制<code class="language-plaintext highlighter-rouge">010100</code>，即<code class="language-plaintext highlighter-rouge">010000 + 000100</code>），第二个<code class="language-plaintext highlighter-rouge">compareDocumentPosition</code>方法返回<code class="language-plaintext highlighter-rouge">10</code>（二进制<code class="language-plaintext highlighter-rouge">001010</code>）。</p>

<p>由于<code class="language-plaintext highlighter-rouge">compareDocumentPosition</code>返回值的含义，定义在每一个比特位上，所以如果要检查某一种特定的含义，就需要使用比特位运算符。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">head</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">body</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">head</span><span class="p">.</span><span class="nx">compareDocumentPosition</span><span class="p">(</span><span class="nx">body</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 4表示 参数节点在当前节点的后面</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">文档结构正确</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;body&gt; 不能在 &lt;head&gt; 前面</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">compareDocumentPosition</code>的返回值与<code class="language-plaintext highlighter-rouge">4</code>（又称掩码）进行与运算（<code class="language-plaintext highlighter-rouge">&amp;</code>），得到一个布尔值，表示<code class="language-plaintext highlighter-rouge">是否在</code>前面。</p>

<h4 id="29-nodeprototypeisequalnode-节点是否相等-nodeprototypeissamenode-节点是否相同">2.9 Node.prototype.isEqualNode() 节点是否相等 Node.prototype.isSameNode() 节点是否相同</h4>

<p><code class="language-plaintext highlighter-rouge">isEqualNode</code>方法<strong>返回一个布尔值，用于检查两个节点是否相等。所谓相等的节点，指的是两个节点的类型相同、属性相同、子节点相同。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">p1</span><span class="p">.</span><span class="nx">isEqualNode</span><span class="p">(</span><span class="nx">p2</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">isSameNode</code>方法<strong>返回一个布尔值，表示两个节点是否为同一个节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">p1</span><span class="p">.</span><span class="nx">isSameNode</span><span class="p">(</span><span class="nx">p2</span><span class="p">)</span> <span class="c1">// false</span>
<span class="nx">p1</span><span class="p">.</span><span class="nx">isSameNode</span><span class="p">(</span><span class="nx">p1</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="210-nodeprototypenormalize--将当前节点和它的后代节点规范化">2.10 Node.prototype.normalize()  将当前节点和它的后代节点”规范化“</h4>

<p><code class="language-plaintext highlighter-rouge">normalize</code>方法 <strong>将当前节点和它的后代节点”规范化“</strong> 。在一个”规范化”后的DOM树中，不存在一个空的文本节点，或者两个相邻的文本节点。</p>

<p>注1：“空的文本节点”并不包括空白字符(空格，换行等)构成的文本节点。</p>

<p>注2：两个以上相邻文本节点的产生原因包括：</p>

<ol>
  <li>通过脚本调用有关的DOM接口进行了文本节点的插入和分割等。</li>
  <li>HTML中超长的文本节点会被浏览器自动分割为多个相邻文本节点。</li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">);</span>

<span class="nx">wrapper</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="dl">"</span><span class="s2">Part 1 </span><span class="dl">"</span><span class="p">));</span>
<span class="nx">wrapper</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="dl">"</span><span class="s2">Part 2 </span><span class="dl">"</span><span class="p">));</span>

<span class="c1">// 这时(规范化之前),wrapper.childNodes.length === 2</span>
<span class="c1">// wrapper.childNodes[0].textContent === "Part 1 "</span>
<span class="c1">// wrapper.childNodes[1].textContent === "Part 2 "</span>

<span class="nx">wrapper</span><span class="p">.</span><span class="nx">normalize</span><span class="p">();</span>
<span class="c1">// 现在(规范化之后), wrapper.childNodes.length === 1</span>
<span class="c1">// wrapper.childNodes[0].textContent === "Part 1 Part 2"</span>
</code></pre></div></div>

<p>上面代码使用<code class="language-plaintext highlighter-rouge">normalize</code>方法之前，<code class="language-plaintext highlighter-rouge">wrapper</code>节点有两个毗邻的文本子节点。使用<code class="language-plaintext highlighter-rouge">normalize</code>方法之后，两个文本子节点被合并成一个。</p>

<p>该方法是<code class="language-plaintext highlighter-rouge">Text.splitText</code>的逆方法，可以查看《Text 节点对象》一章，了解更多内容。</p>

<h4 id="211-nodeprototypegetrootnode-获取根节点document">2.11 Node.prototype.getRootNode() 获取根节点（document）</h4>

<p><code class="language-plaintext highlighter-rouge">getRootNode()</code>方法<strong>返回当前节点所在文档的根节点<code class="language-plaintext highlighter-rouge">document</code>，与<code class="language-plaintext highlighter-rouge">ownerDocument</code>属性的作用相同</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">getRootNode</span><span class="p">()</span> <span class="o">===</span> <span class="nb">document</span>
<span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">getRootNode</span><span class="p">()</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">ownerDocument</span>
<span class="c1">// true</span>
</code></pre></div></div>

<p>该方法可用于<code class="language-plaintext highlighter-rouge">document</code>节点自身，这一点与<code class="language-plaintext highlighter-rouge">document.ownerDocument</code>不同。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getRootNode</span><span class="p">()</span> <span class="c1">// document</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">ownerDocument</span> <span class="c1">// null</span>
</code></pre></div></div>

<h2 id="三nodelist-接口-与-htmlcollection-接口-节点的集合">三、NodeList 接口 与 HTMLCollection 接口 （节点的集合）</h2>

<p>节点都是单个对象，有时需要一种数据结构，能够容纳多个节点。DOM 提供两种<strong>节点集合</strong>，用于容纳多个节点：<code class="language-plaintext highlighter-rouge">NodeList</code>和<code class="language-plaintext highlighter-rouge">HTMLCollection</code>。</p>

<p>这两种集合都属于接口规范。许多 DOM 属性和方法，返回的结果是<code class="language-plaintext highlighter-rouge">NodeList</code>实例或<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例。主要区别是，<strong><code class="language-plaintext highlighter-rouge">NodeList</code>可以包含各种类型的节点，<code class="language-plaintext highlighter-rouge">HTMLCollection</code>只能包含 HTML 元素节点</strong>。</p>

<h3 id="1nodelist-接口-各类节点的集合">1、NodeList 接口 （各类节点的集合）</h3>

<h4 id="11-概述">1.1 概述</h4>

<p><code class="language-plaintext highlighter-rouge">NodeList</code>实例是一个<strong>类似数组的对象，它的成员是节点对象</strong>。通过以下方法可以得到<code class="language-plaintext highlighter-rouge">NodeList</code>实例。</p>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">Node.childNodes</code> 属性</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">document.querySelectorAll()</code>等节点搜索方法</strong></li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span> <span class="k">instanceof</span> <span class="nx">NodeList</span> <span class="c1">// true</span>

<span class="cm">/*
&lt;ul&gt;
    &lt;li&gt;&lt;/li&gt;
    &lt;li&gt;&lt;/li&gt;
    &lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;*/</span>

<span class="kd">var</span> <span class="nx">$li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$li</span><span class="p">)</span> <span class="c1">// NodeList(3) [li, li, li]</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">$li</span> <span class="k">instanceof</span> <span class="nx">NodeList</span><span class="p">)</span> <span class="c1">// true</span>

</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">NodeList</code>实例很像数组，<strong>可以使用<code class="language-plaintext highlighter-rouge">length</code>属性和<code class="language-plaintext highlighter-rouge">forEach</code>方法</strong>。但是，它不是数组，不能使用<code class="language-plaintext highlighter-rouge">pop</code>或<code class="language-plaintext highlighter-rouge">push</code>之类数组特有的方法。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>

<span class="nb">Array</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">children</span><span class="p">)</span> <span class="c1">// false</span>

<span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 34</span>
<span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码中，NodeList 实例<code class="language-plaintext highlighter-rouge">children</code>不是数组，但是具有<code class="language-plaintext highlighter-rouge">length</code>属性和<code class="language-plaintext highlighter-rouge">forEach</code>方法。</p>

<p>如果<code class="language-plaintext highlighter-rouge">NodeList</code>实例要使用数组方法，<strong>可以将其转为真正的数组</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">nodeArr</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">children</span><span class="p">);</span>
</code></pre></div></div>

<p>除了使用<code class="language-plaintext highlighter-rouge">forEach</code>方法遍历 NodeList 实例，<strong>还可以使用<code class="language-plaintext highlighter-rouge">for</code>循环</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">children</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div>

<p>注意，NodeList 实例<strong>可能是动态集合，也可能是静态集合</strong>。所谓动态集合就是一个活的集合，DOM 删除或新增一个相关节点，都会立刻反映在 NodeList 实例。<strong>目前，只有<code class="language-plaintext highlighter-rouge">Node.childNodes</code>返回的是一个动态集合，其他的 NodeList 都是静态集合。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
<span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 18</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">children</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 19</span>
</code></pre></div></div>

<p>上面代码中，文档增加一个子节点，NodeList 实例<code class="language-plaintext highlighter-rouge">children</code>的<code class="language-plaintext highlighter-rouge">length</code>属性就增加了1。</p>

<h4 id="12-nodelistprototypelength">1.2 NodeList.prototype.length</h4>

<p><code class="language-plaintext highlighter-rouge">length</code>属性返回 NodeList 实例包含的节点数量。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">xxx</span><span class="dl">'</span><span class="p">).</span><span class="nx">length</span>
<span class="c1">// 0</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">document.querySelectorAll</code>返回一个 NodeList 集合。对于那些不存在的 HTML 标签，<code class="language-plaintext highlighter-rouge">length</code>属性返回<code class="language-plaintext highlighter-rouge">0</code>。</p>

<h4 id="13-nodelistprototypeforeach">1.3 NodeList.prototype.forEach()</h4>

<p><code class="language-plaintext highlighter-rouge">forEach</code>方法用于遍历 NodeList 的所有成员。它接受一个回调函数作为参数，每一轮遍历就执行一次这个回调函数，用法与数组实例的<code class="language-plaintext highlighter-rouge">forEach</code>方法完全一致。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>
<span class="nx">children</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="nx">f</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">i</span><span class="p">,</span> <span class="nx">list</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 参数：当前成员、当前索引、NodeList实例</span>
  <span class="c1">// ...</span>
<span class="p">},</span> <span class="k">this</span><span class="p">);</span> <span class="c1">// forEach参数二： 绑定回调函数内部的this，可省略</span>
</code></pre></div></div>

<p>上面代码中，回调函数<code class="language-plaintext highlighter-rouge">f</code>的三个参数依次是<strong>当前成员、位置和当前 NodeList 实例</strong>。<code class="language-plaintext highlighter-rouge">forEach</code>方法的第二个参数，用于绑定回调函数内部的<code class="language-plaintext highlighter-rouge">this</code>，该参数可省略。</p>

<h4 id="14-nodelistprototypeitem-接受一个索引参数返回该索引上的成员节点">1.4 NodeList.prototype.item() 接受一个索引参数，返回该索引上的成员（节点）</h4>

<p><code class="language-plaintext highlighter-rouge">item</code>方法<strong>接受一个整数值作为参数，表示成员的位置，返回该位置上的成员。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">item(0)</code>返回第一个成员。</p>

<p>如果参数值大于实际长度，或者索引不合法（比如负数），<code class="language-plaintext highlighter-rouge">item</code>方法返回<code class="language-plaintext highlighter-rouge">null</code>。如果省略参数，<code class="language-plaintext highlighter-rouge">item</code>方法会报错。</p>

<p>所有类似数组的对象，都可以使用方括号运算符取出成员。<strong>一般情况下，都是使用方括号运算符，而不使用<code class="language-plaintext highlighter-rouge">item</code>方法。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</code></pre></div></div>

<h4 id="15-nodelistprototypekeysnodelistprototypevaluesnodelistprototypeentries--遍历器对象结合forof遍历每一个成员的信息">1.5 NodeList.prototype.keys()，NodeList.prototype.values()，NodeList.prototype.entries()  遍历器对象，结合for…of遍历每一个成员的信息</h4>

<p>这三个方法都返回一个 ES6 的遍历器对象，可以通过<code class="language-plaintext highlighter-rouge">for...of</code>循环遍历获取每一个成员的信息。区别在于，<code class="language-plaintext highlighter-rouge">keys()</code>返回<strong>键名</strong>的遍历器，<code class="language-plaintext highlighter-rouge">values()</code>返回<strong>键值</strong>的遍历器，<code class="language-plaintext highlighter-rouge">entries()</code>返回的遍历器<strong>同时包含键名和键值的数组</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">of</span> <span class="nx">children</span><span class="p">.</span><span class="nx">keys</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span> <span class="c1">// 返回键名</span>
<span class="p">}</span>
<span class="c1">// 0</span>
<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">// ...</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">children</span><span class="p">.</span><span class="nx">values</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span> <span class="c1">// 返回键值 (即节点名)</span>
<span class="p">}</span>
<span class="c1">// #text</span>
<span class="c1">// &lt;script&gt;</span>
<span class="c1">// ...</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">entry</span> <span class="k">of</span> <span class="nx">children</span><span class="p">.</span><span class="nx">entries</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span> <span class="c1">// 返回键名和键值的数组</span>
<span class="p">}</span>
<span class="c1">// Array [ 0, #text ]</span>
<span class="c1">// Array [ 1, &lt;script&gt; ]</span>
<span class="c1">// ...</span>
</code></pre></div></div>

<h3 id="2htmlcollection-接口-html元素节点的集合">2、HTMLCollection 接口 （HTML元素节点的集合）</h3>

<h4 id="21-概述">2.1 概述</h4>

<p><code class="language-plaintext highlighter-rouge">HTMLCollection</code>是一个<strong>节点对象的集合，只能包含元素节点</strong>（element），不能包含其他类型的节点。它的返回值是一个<strong>类似数组的对象</strong>，但是与<code class="language-plaintext highlighter-rouge">NodeList</code>接口不同，<code class="language-plaintext highlighter-rouge">HTMLCollection</code><strong>没有<code class="language-plaintext highlighter-rouge">forEach</code>方法，只能使用<code class="language-plaintext highlighter-rouge">for</code>循环遍历。</strong></p>

<p>返回<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例的，主要是一些<code class="language-plaintext highlighter-rouge">Document</code>对象的集合属性，比如<code class="language-plaintext highlighter-rouge">document.links</code>、<code class="language-plaintext highlighter-rouge">document.forms</code>、<code class="language-plaintext highlighter-rouge">document.images</code>等。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">links</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例都是<strong>动态集合</strong>，节点的变化会实时反映在集合中。</p>

<p>如果元素节点有<code class="language-plaintext highlighter-rouge">id</code>或<code class="language-plaintext highlighter-rouge">name</code>属性，那么<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例上面，可以使用<code class="language-plaintext highlighter-rouge">id</code>属性或<code class="language-plaintext highlighter-rouge">name</code>属性引用该节点元素。如果没有对应的节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;img id="pic" src="http://example.com/foo.jpg"&gt;</span>

<span class="kd">var</span> <span class="nx">pic</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">pic</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">pic</span> <span class="o">===</span> <span class="nx">pic</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">document.images</code>是一个<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例，可以通过<code class="language-plaintext highlighter-rouge">  &lt;img&gt;  </code>元素的<code class="language-plaintext highlighter-rouge">id</code>属性值，从<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例上取到这个元素。</p>

<h6 id="各js选择器返回的数据对比">各js选择器返回的数据对比</h6>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">id=</span><span class="s">"li1"</span><span class="nt">&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"li2"</span><span class="nt">&gt;&lt;/li&gt;</span>
    <span class="nt">&lt;li</span> <span class="na">name=</span><span class="s">'liName'</span><span class="nt">&gt;&lt;/li&gt;</span>
 <span class="nt">&lt;/ul&gt;</span>

<span class="nt">&lt;script&gt;</span>
    <span class="kd">var</span> <span class="nx">li1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">li1</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">li2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#li1</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">li3</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">li2</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">li4</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">li5</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">liName</span><span class="dl">'</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">li6</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">li1</span><span class="p">)</span> <span class="c1">// </span><span class="o">&lt;</span><span class="nx">li</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">li1</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">li2</span><span class="p">)</span> <span class="c1">// </span><span class="o">&lt;</span><span class="nx">li</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">li1</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/li</span><span class="err">&gt;
</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">li3</span><span class="p">)</span> <span class="c1">// HTMLCollection [li.li2]</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">li4</span><span class="p">)</span> <span class="c1">// HTMLCollection(3) [li#li1, li.li2, li, li1: li#li1, liName: li]</span>

    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">li5</span><span class="p">)</span> <span class="c1">// NodeList [li]</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">li6</span><span class="p">)</span> <span class="c1">// NodeList(3) [li#li1, li.li2, li]</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h4 id="22-htmlcollectionprototypelength">2.2 HTMLCollection.prototype.length</h4>

<p><code class="language-plaintext highlighter-rouge">length</code>属性返回<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例包含的成员数量。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">links</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 18</span>
</code></pre></div></div>

<h4 id="23-htmlcollectionprototypeitem-和方括号访问一样">2.3 HTMLCollection.prototype.item() 和方括号访问一样</h4>

<p><code class="language-plaintext highlighter-rouge">item</code>方法接受一个整数值作为参数，表示成员的位置，返回该位置上的成员。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">img0</span> <span class="o">=</span> <span class="nx">c</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">item(0)</code>表示返回0号位置的成员。由于方<strong>括号运算符也具有同样作用，而且使用更方便，所以一般情况下，总是使用方括号运算符</strong>。</p>

<p>如果参数值超出成员数量或者不合法（比如小于0），那么<code class="language-plaintext highlighter-rouge">item</code>方法返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h4 id="24-htmlcollectionprototypenameditem-参数为id或name返回元素节点">2.4 HTMLCollection.prototype.namedItem() 参数为id或name，返回元素节点</h4>

<p><code class="language-plaintext highlighter-rouge">namedItem</code>方法的<strong>参数是一个字符串，表示<code class="language-plaintext highlighter-rouge">id</code>属性或<code class="language-plaintext highlighter-rouge">name</code>属性的值，返回对应的元素节点</strong>。如果没有对应的节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;img id="pic" src="http://example.com/foo.jpg"&gt;</span>

<span class="kd">var</span> <span class="nx">pic</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">pic</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">.</span><span class="nx">namedItem</span><span class="p">(</span><span class="dl">'</span><span class="s1">pic</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="nx">pic</span> <span class="c1">// true</span>
</code></pre></div></div>

<h2 id="四parentnode-接口父节点接口childnode-接口子节点接口">四、ParentNode 接口（父节点接口），ChildNode 接口（子节点接口）</h2>

<p>节点对象除了继承 Node 接口以外，还会继承其他接口。<code class="language-plaintext highlighter-rouge">ParentNode</code>接口<strong>表示当前节点是一个父节点，提供一些处理子节点的方法</strong>。<code class="language-plaintext highlighter-rouge">ChildNode</code>接口<strong>表示当前节点是一个子节点，提供一些相关方法。</strong></p>

<h3 id="1parentnode-接口">1、ParentNode 接口</h3>

<p><strong>如果当前节点是父节点，就会继承<code class="language-plaintext highlighter-rouge">ParentNode</code>接口</strong>。由于只有<strong>元素节点</strong>（element）、<strong>文档节点</strong>（document）和<strong>文档片段节点</strong>（documentFragment）拥有子节点，因此只有这三类节点会继承<code class="language-plaintext highlighter-rouge">ParentNode</code>接口。</p>

<h4 id="11-属性">1.1 属性</h4>

<h4 id="1parentnodechildren--返回htmlcollection实例当前节点的所有元素子节点">（1）ParentNode.children  （返回HTMLCollection实例，当前节点的所有元素子节点）</h4>

<p><code class="language-plaintext highlighter-rouge">children</code>属性<strong>返回一个<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例，成员是当前节点的所有元素子节点</strong>。该属性<strong>只读</strong>。</p>

<p>下面是遍历某个节点的所有元素子节点的示例。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">el</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">children</code>属性<strong>只包括元素子节点</strong>，不包括其他类型的子节点（比如文本子节点）。如果没有元素类型的子节点，返回值<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例的<code class="language-plaintext highlighter-rouge">length</code>属性为<code class="language-plaintext highlighter-rouge">0</code>。</p>

<p>另外，<code class="language-plaintext highlighter-rouge">HTMLCollection</code>是动态集合，会实时反映 DOM 的任何变化。</p>

<h4 id="2parentnodefirstelementchild-第一个元素子节点">（2）ParentNode.firstElementChild 第一个元素子节点</h4>

<p><code class="language-plaintext highlighter-rouge">firstElementChild</code>属性<strong>返回当前节点的第一个元素子节点</strong>。如果没有任何元素子节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">.</span><span class="nx">nodeName</span>
<span class="c1">// "HTML"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">document</code>节点的第一个元素子节点是``。</p>

<h4 id="3parentnodelastelementchild-最后一个元素子节点">（3）ParentNode.lastElementChild 最后一个元素子节点</h4>

<p><code class="language-plaintext highlighter-rouge">lastElementChild</code>属性<strong>返回当前节点的最后一个元素子节点</strong>，如果不存在任何元素子节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">lastElementChild</span><span class="p">.</span><span class="nx">nodeName</span>
<span class="c1">// "HTML"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">document</code>节点的最后一个元素子节点是``（因为<code class="language-plaintext highlighter-rouge">document</code>只包含这一个元素子节点）。</p>

<h4 id="4parentnodechildelementcount-所有元素子节点的数量">（4）ParentNode.childElementCount 所有元素子节点的数量</h4>

<p><code class="language-plaintext highlighter-rouge">childElementCount</code>属性<strong>返回一个整数，表示当前节点的所有元素子节点的数目</strong>。如果不包含任何元素子节点，则返回<code class="language-plaintext highlighter-rouge">0</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">childElementCount</span> <span class="c1">// 13</span>
</code></pre></div></div>

<h4 id="12-方法">1.2 方法</h4>

<h5 id="parentnodeappend-插入子节点于后parentnodeprepend--插入子节点于前">ParentNode.append() 插入子节点于后，ParentNode.prepend()  插入子节点于前</h5>

<p><code class="language-plaintext highlighter-rouge">append</code>方法<strong>为当前节点追加一个或多个子节点，位置是最后一个元素子节点的后面</strong>。</p>

<p>该方法不仅可以添加元素子节点，还可以添加文本子节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">parent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

<span class="c1">// 添加元素子节点</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>

<span class="c1">// 添加文本子节点</span>
<span class="nx">parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 添加多个元素子节点</span>
<span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">p1</span><span class="p">,</span> <span class="nx">p2</span><span class="p">);</span>

<span class="c1">// 添加元素子节点和文本子节点</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">parent</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">,</span> <span class="nx">p</span><span class="p">);</span>
</code></pre></div></div>

<p>注意，该方法<strong>没有返回值</strong>。</p>

<p><code class="language-plaintext highlighter-rouge">prepend</code>方法为<strong>当前节点追加一个或多个子节点，位置是第一个元素子节点的前面</strong>。它的用法与<code class="language-plaintext highlighter-rouge">append</code>方法完全一致，也是<strong>没有返回值</strong>。</p>

<h3 id="2childnode-接口">2、ChildNode 接口</h3>

<p><strong>如果一个节点有父节点，那么该节点就继承了<code class="language-plaintext highlighter-rouge">ChildNode</code>接口。</strong></p>

<h4 id="21-childnoderemove-移除当前节点">2.1 ChildNode.remove() 移除当前节点</h4>

<p><code class="language-plaintext highlighter-rouge">remove</code>方法用于从父节点<strong>移除当前节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
</code></pre></div></div>

<p>上面代码在 DOM 里面移除了<code class="language-plaintext highlighter-rouge">el</code>节点。</p>

<h4 id="22-childnodebefore-插入同级节点于前childnodeafter-插入同级节点于后">2.2 ChildNode.before() 插入同级节点于前，ChildNode.after() 插入同级节点于后</h4>

<p><code class="language-plaintext highlighter-rouge">before</code>方法用于<strong>在当前节点的前面，插入一个或多个同级节点</strong>。两者拥有相同的父节点。</p>

<p>注意，该方法不仅可以插入元素节点，还可以插入文本节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 插入元素节点</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>

<span class="c1">// 插入文本节点</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 插入多个元素节点</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="nx">p1</span><span class="p">);</span>

<span class="c1">// 插入元素节点和文本节点</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">p</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">after</code>方法用于<strong>在当前节点的后面，插入一个或多个同级节点</strong>，两者拥有相同的父节点。用法与<code class="language-plaintext highlighter-rouge">before</code>方法完全相同。</p>

<h4 id="23-childnodereplacewith-用参数节点替换当前节点">2.3 ChildNode.replaceWith() 用参数节点替换当前节点</h4>

<p><code class="language-plaintext highlighter-rouge">replaceWith</code>方法<strong>使用参数节点，替换当前节点。</strong>参数可以是元素节点，也可以是文本节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">span</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">span</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">el</code>节点将被<code class="language-plaintext highlighter-rouge">span</code>节点替换。</p>

<h2 id="五document节点">五、Document节点</h2>

<h3 id="1概述">1、概述</h3>

<p><code class="language-plaintext highlighter-rouge">document</code>节点对象<strong>代表整个文档</strong>，每张网页都有自己的<code class="language-plaintext highlighter-rouge">document</code>对象。<code class="language-plaintext highlighter-rouge">window.document</code>属性就指向这个对象。只要浏览器开始载入 HTML 文档，该对象就存在了，可以直接使用。</p>

<p><code class="language-plaintext highlighter-rouge">document</code>对象有不同的办法可以获取。</p>

<ul>
  <li>正常的网页，直接使用<code class="language-plaintext highlighter-rouge">document</code>或<code class="language-plaintext highlighter-rouge">window.document</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">iframe</code>框架里面的网页，使用<code class="language-plaintext highlighter-rouge">iframe</code>节点的<code class="language-plaintext highlighter-rouge">contentDocument</code>属性。</li>
  <li>Ajax 操作返回的文档，使用<code class="language-plaintext highlighter-rouge">XMLHttpRequest</code>对象的<code class="language-plaintext highlighter-rouge">responseXML</code>属性。</li>
  <li>内部节点的<code class="language-plaintext highlighter-rouge">ownerDocument</code>属性。</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">document</code>对象<strong>继承了<code class="language-plaintext highlighter-rouge">EventTarget</code>接口、<code class="language-plaintext highlighter-rouge">Node</code>接口、<code class="language-plaintext highlighter-rouge">ParentNode</code>接口</strong>。这意味着，这些接口的方法都可以在<code class="language-plaintext highlighter-rouge">document</code>对象上调用。除此之外，<code class="language-plaintext highlighter-rouge">document</code>对象还有很多自己的属性和方法。</p>

<h3 id="2属性">2、属性</h3>

<h4 id="21-快捷方式属性-指向文档内部某个节点的快捷方式">2.1 快捷方式属性 （指向文档内部某个节点的快捷方式）</h4>

<p><strong>以下属性是指向文档内部的某个节点的快捷方式。</strong></p>

<h5 id="1documentdefaultview--返回window对象">（1）document.defaultView  返回window对象</h5>

<p><code class="language-plaintext highlighter-rouge">document.defaultView</code>属性<strong>返回<code class="language-plaintext highlighter-rouge">document</code>对象所属的<code class="language-plaintext highlighter-rouge">window</code>对象</strong>。如果当前文档不属于<code class="language-plaintext highlighter-rouge">window</code>对象，该属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">defaultView</span> <span class="o">===</span> <span class="nb">window</span> <span class="c1">// true</span>
</code></pre></div></div>

<h5 id="2documentdoctype-指向doctype-html">（2）document.doctype 指向<code class="language-plaintext highlighter-rouge">&lt;!DOCTYPE html&gt;</code></h5>

<p>对于 HTML 文档来说，<code class="language-plaintext highlighter-rouge">document</code>对象<strong>一般有两个子节点</strong>。第一个子节点是<code class="language-plaintext highlighter-rouge">document.doctype</code>，指向<code class="language-plaintext highlighter-rouge"> &lt;DOCTYPE&gt; </code>节点，即文档类型（Document Type Declaration，简写DTD）节点。HTML 的文档类型节点，一般写成<code class="language-plaintext highlighter-rouge"> &lt;!DOCTYPE html&gt; </code>。如果网页没有声明 DTD，该属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">doctype</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">doctype</span><span class="p">;</span>
<span class="nx">doctype</span> <span class="c1">// "&lt;!DOCTYPE html&gt;"</span>
<span class="nx">doctype</span><span class="p">.</span><span class="nx">name</span> <span class="c1">// "html"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document.firstChild</code>通常就返回这个节点。</p>

<h5 id="3documentdocumentelement-返回当前文档的根元素节点即html节点">（3）document.documentElement 返回当前文档的根元素节点，即&lt;html&gt;节点</h5>

<p><code class="language-plaintext highlighter-rouge">document.documentElement</code>属性<strong>返回当前文档的根元素节点</strong>（root）。它通常是<code class="language-plaintext highlighter-rouge">document</code>节点的第二个子节点，紧跟在<code class="language-plaintext highlighter-rouge">document.doctype</code>节点后面。HTML网页的该属性，一般是<code class="language-plaintext highlighter-rouge"> &lt;html&gt; </code>节点。</p>

<h5 id="4documentbody-指向bodydocumenthead-指向-head">（4）document.body 指向&lt;body&gt;，document.head 指向 &lt;head&gt;</h5>

<p><code class="language-plaintext highlighter-rouge">document.body</code>属性指向<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>节点，<code class="language-plaintext highlighter-rouge">document.head</code>属性指向<code class="language-plaintext highlighter-rouge"> &lt;head&gt; </code>节点。</p>

<p>这两个属性<strong>总是存在的</strong>，如果网页源码里面省略了<code class="language-plaintext highlighter-rouge"> &lt;head&gt; </code>或<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>，浏览器会自动创建。另外，这两个属性是<strong>可写的</strong>，如果改写它们的值，相当于移除所有子节点。</p>

<h5 id="5documentscrollingelement-返回文档的滚动元素标准模式html兼容模式body">（5）document.scrollingElement 返回文档的滚动元素（标准模式&lt;html&gt;,兼容模式&lt;body&gt;）</h5>

<p><code class="language-plaintext highlighter-rouge">document.scrollingElement</code>属性<strong>返回文档的滚动元素</strong>。也就是说，当文档整体滚动时，到底是哪个元素在滚动。</p>

<p><strong>标准模式下</strong>，这个属性<strong>返回的文档的根元素<code class="language-plaintext highlighter-rouge">document.documentElement</code>（即<code class="language-plaintext highlighter-rouge"> &lt;html&gt; </code>）</strong>。</p>

<p><strong>兼容（quirk）模式下</strong>，<strong>返回的是<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>元素</strong>，如果该元素不存在，返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 页面滚动到浏览器顶部</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">scrollingElement</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div></div>

<h5 id="6documentactiveelement-返回文档中获取焦点的元素一般为表单元素如没有则返回body或null">（6）document.activeElement 返回文档中获取焦点的元素，一般为表单元素，如没有则返回&lt;body&gt;或null</h5>

<p><code class="language-plaintext highlighter-rouge">document.activeElement</code>属性<strong>返回获得当前焦点（focus）的 DOM 元素</strong>。通常，这个属性返回的是<code class="language-plaintext highlighter-rouge"> &lt;input&gt; </code>、<code class="language-plaintext highlighter-rouge"> &lt;textarea&gt; </code>、<code class="language-plaintext highlighter-rouge"> &lt;select&gt; </code>等表单元素，如果当前没有焦点元素，返回<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>元素或<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h5 id="7documentfullscreenelement-返回当前以全屏状态展示的-dom-元素">（7）document.fullscreenElement 返回当前以全屏状态展示的 DOM 元素</h5>

<p><code class="language-plaintext highlighter-rouge">document.fullscreenElement</code>属性<strong>返回当前以全屏状态展示的 DOM 元素</strong>。如果不是全屏状态，该属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">fullscreenElement</span><span class="p">.</span><span class="nx">nodeName</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">VIDEO</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">全屏播放视频</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，通过<code class="language-plaintext highlighter-rouge">document.fullscreenElement</code>可以知道<code class="language-plaintext highlighter-rouge">  &lt;video&gt;  </code>元素有没有处在全屏状态，从而判断用户行为。</p>

<h4 id="22-节点集合属性-文档内部特定元素的集合返htmlcollection实例">2.2 节点集合属性 （文档内部特定元素的集合，返HTMLCollection实例）</h4>

<p>以下属性<strong>返回一个<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例</strong>，表示文档内部特定元素的集合。这些集合都是<strong>动态的</strong>，原节点有任何变化，立刻会反映在集合中。</p>

<h5 id="1documentlinks-返回所有含href属性的a和area">（1）document.links 返回所有含href属性的&lt;a&gt;和&lt;area&gt;</h5>

<p><code class="language-plaintext highlighter-rouge">document.links</code>属性<strong>返回当前文档所有设定了<code class="language-plaintext highlighter-rouge">href</code>属性的<code class="language-plaintext highlighter-rouge">  &lt;a&gt;  </code>及<code class="language-plaintext highlighter-rouge"> &lt;area&gt; </code>节点。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 打印文档所有的链接</span>
<span class="kd">var</span> <span class="nx">links</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">links</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">links</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">links</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="2documentforms-返回所有form-表单节点">（2）document.forms 返回所有&lt;form&gt; 表单节点</h5>

<p><code class="language-plaintext highlighter-rouge">document.forms</code>属性<strong>返回所有<code class="language-plaintext highlighter-rouge"> &lt;form&gt; </code>表单节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">selectForm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</code></pre></div></div>

<p>上面代码获取文档第一个表单。</p>

<p>除了使用位置序号，<code class="language-plaintext highlighter-rouge">id</code>属性和<code class="language-plaintext highlighter-rouge">name</code>属性也可以用来引用表单。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* HTML 代码如下
  &lt;form name="foo" id="bar"&gt;&lt;/form&gt;
*/</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">.</span><span class="nx">foo</span> <span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">.</span><span class="nx">bar</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">.</span><span class="nx">foo</span> <span class="c1">// true</span>
</code></pre></div></div>

<h5 id="3documentimages-返回页面所有--img--图片节点">（3）document.images 返回页面所有<code class="language-plaintext highlighter-rouge">  &lt;img&gt;  </code>图片节点</h5>

<p><code class="language-plaintext highlighter-rouge">document.images</code>属性<strong>返回页面所有<code class="language-plaintext highlighter-rouge">  &lt;img&gt;  </code>图片节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">imglist</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">;</span>

<span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">imglist</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">imglist</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">src</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">banner.gif</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码在所有<code class="language-plaintext highlighter-rouge">img</code>标签中，寻找某张图片。</p>

<h5 id="4documentembedsdocumentplugins-返回所有-embed-嵌入节点">（4）document.embeds，document.plugins 返回所有<code class="language-plaintext highlighter-rouge"> &lt;embed&gt; </code>嵌入节点</h5>

<p><code class="language-plaintext highlighter-rouge">document.embeds</code>属性和<code class="language-plaintext highlighter-rouge">document.plugins</code>属性，都<strong>返回所有<code class="language-plaintext highlighter-rouge"> &lt;embed&gt; </code>节点</strong>。</p>

<h5 id="5documentscripts--返回所有--script--节点">（5）document.scripts  返回所有<code class="language-plaintext highlighter-rouge">  &lt;script&gt;  </code>节点</h5>

<p><code class="language-plaintext highlighter-rouge">document.scripts</code>属性<strong>返回所有<code class="language-plaintext highlighter-rouge">  &lt;script&gt;  </code>节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">scripts</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">当前网页有脚本</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="6documentstylesheets-返回文档内嵌或引入的样式表集合">（6）document.styleSheets 返回文档内嵌或引入的样式表集合</h5>

<p><code class="language-plaintext highlighter-rouge">document.styleSheets</code>属性<strong>返回文档内嵌或引入的样式表集合</strong>，详细介绍请看《CSS 操作》一章。</p>

<h5 id="7小结除了stylesheets属性其他返回都是htmlcollection实例">（7）小结（除了styleSheets属性，其他返回都是HTMLCollection实例）</h5>

<p>除了<code class="language-plaintext highlighter-rouge">document.styleSheets</code>，以上的集合属性返回的都是<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">links</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">images</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">forms</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">embeds</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">scripts</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例是<strong>类似数组的对象</strong>，所以这些属性都有<code class="language-plaintext highlighter-rouge">length</code>属性，<strong>都可以使用方括号运算符引用成员</strong>。如果成员有<code class="language-plaintext highlighter-rouge">id</code>或<code class="language-plaintext highlighter-rouge">name</code>属性，还可以用这两个属性的值，在<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例上引用到这个成员。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;form name="myForm"&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">myForm</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">.</span><span class="nx">myForm</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="23-文档静态信息属性">2.3 文档静态信息属性</h4>

<p>以下属性<strong>返回文档信息</strong>。</p>

<h5 id="1documentdocumenturidocumenturl-返回网址字符串">（1）document.documentURI，document.URL 返回网址字符串</h5>

<p><code class="language-plaintext highlighter-rouge">document.documentURI</code>属性和<code class="language-plaintext highlighter-rouge">document.URL</code>属性都<strong>返回一个字符串，表示当前文档的网址</strong>。不同之处是它们继承自不同的接口，<code class="language-plaintext highlighter-rouge">documentURI</code>继承自<code class="language-plaintext highlighter-rouge">Document</code>接口，可用于所有文档；<code class="language-plaintext highlighter-rouge">URL</code>继承自<code class="language-plaintext highlighter-rouge">HTMLDocument</code>接口，只能用于 HTML 文档。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">URL</span>
<span class="c1">// http://www.example.com/about</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">documentURI</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">URL</span>
<span class="c1">// true</span>
</code></pre></div></div>

<p>如果<strong>文档的锚点（<code class="language-plaintext highlighter-rouge">#anchor</code>）变化，这两个属性都会跟着变化</strong>。</p>

<h5 id="2documentdomain-返回域名">（2）document.domain 返回域名</h5>

<p><code class="language-plaintext highlighter-rouge">document.domain</code>属性<strong>返回当前文档的域名，不包含协议和端口</strong>。比如，网页的网址是<code class="language-plaintext highlighter-rouge">http://www.example.com:80/hello.html</code>，那么<code class="language-plaintext highlighter-rouge">document.domain</code>属性就等于<code class="language-plaintext highlighter-rouge">www.example.com</code>。如果无法获取域名，该属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<p><code class="language-plaintext highlighter-rouge">document.domain</code>基本上是一个只读属性，只有一种情况除外。次级域名的网页，可以把<code class="language-plaintext highlighter-rouge">document.domain</code>设为对应的上级域名。比如，当前域名是<code class="language-plaintext highlighter-rouge">a.sub.example.com</code>，则<code class="language-plaintext highlighter-rouge">document.domain</code>属性可以设置为<code class="language-plaintext highlighter-rouge">sub.example.com</code>，也可以设为<code class="language-plaintext highlighter-rouge">example.com</code>。修改后，<code class="language-plaintext highlighter-rouge">document.domain</code>相同的两个网页，可以读取对方的资源，比如设置的 Cookie。</p>

<p>另外，设置<code class="language-plaintext highlighter-rouge">document.domain</code>会导致端口被改成<code class="language-plaintext highlighter-rouge">null</code>。因此，如果通过设置<code class="language-plaintext highlighter-rouge">document.domain</code>来进行通信，双方网页都必须设置这个值，才能保证端口相同。</p>

<h5 id="3documentlocation-提供-url-相关的信息和操作方法">（3）document.location 提供 URL 相关的信息和操作方法</h5>

<p><code class="language-plaintext highlighter-rouge">Location</code>对象是浏览器提供的原生对象，提供 URL 相关的信息和操作方法。通过<code class="language-plaintext highlighter-rouge">window.location</code>和<code class="language-plaintext highlighter-rouge">document.location</code>属性，可以拿到这个对象。</p>

<p>关于这个对象的详细介绍，请看《浏览器模型》部分的《Location 对象》章节。</p>

<h5 id="4documentlastmodified--返回当前文档最后修改的时间">（4）document.lastModified  返回当前文档最后修改的时间</h5>

<p><code class="language-plaintext highlighter-rouge">document.lastModified</code>属性返回一个<strong>字符串</strong>，表示<strong>当前文档最后修改的时间</strong>。不同浏览器的返回值，日期格式是不一样的。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">lastModified</span>
<span class="c1">// "03/07/2018 11:18:27"</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">document.lastModified</code>属性的值是字符串，所以不能直接用来比较。<code class="language-plaintext highlighter-rouge">Date.parse</code>方法将其转为<code class="language-plaintext highlighter-rouge">Date</code>实例，才能比较两个网页。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">lastVisitedDate</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="dl">'</span><span class="s1">01/01/2018</span><span class="dl">'</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">Date</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">lastModified</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nx">lastVisitedDate</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">网页已经变更</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>如果页面上有 JavaScript 生成的内容，<code class="language-plaintext highlighter-rouge">document.lastModified</code>属性返回的总是当前时间。</p>

<h5 id="5documenttitle--返回当前文档的标题">（5）document.title  返回当前文档的标题</h5>

<p><code class="language-plaintext highlighter-rouge">document.title</code>属性<strong>返回当前文档的标题</strong>。默认情况下，返回<code class="language-plaintext highlighter-rouge"> &lt;title&gt; </code>节点的值。但是该属性是可写的，一旦被修改，就返回修改后的值。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">新标题</span><span class="dl">'</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">title</span> <span class="c1">// "新标题"</span>
</code></pre></div></div>

<h5 id="6documentcharacterset-返回当前文档的编码如utf-8等">（6）document.characterSet 返回当前文档的编码，如UTF-8等</h5>

<p><code class="language-plaintext highlighter-rouge">document.characterSet</code>属性<strong>返回当前文档的编码</strong>，比如<code class="language-plaintext highlighter-rouge">UTF-8</code>、<code class="language-plaintext highlighter-rouge">ISO-8859-1</code>等等。</p>

<h5 id="7documentreferrer-当前文档的访问者来自哪里如通过百度进入的">（7）document.referrer 当前文档的访问者来自哪里（如通过百度进入的）</h5>

<p><code class="language-plaintext highlighter-rouge">document.referrer</code>属性<strong>返回一个字符串，表示当前文档的访问者来自哪里</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">referrer</span>
<span class="c1">// "https://example.com/path"</span>
</code></pre></div></div>

<p>如果无法获取来源，或者用户直接键入网址而不是从其他网页点击进入，<code class="language-plaintext highlighter-rouge">document.referrer</code>返回一个空字符串。</p>

<p><code class="language-plaintext highlighter-rouge">document.referrer</code>的值，总是与 HTTP 头信息的<code class="language-plaintext highlighter-rouge">Referer</code>字段保持一致。但是，<code class="language-plaintext highlighter-rouge">document.referrer</code>的拼写有两个<code class="language-plaintext highlighter-rouge">r</code>，而头信息的<code class="language-plaintext highlighter-rouge">Referer</code>字段只有一个<code class="language-plaintext highlighter-rouge">r</code>。</p>

<h5 id="8documentdir-返回文字方向rtl从右到左ltr从左到右">（8）document.dir 返回文字方向（rtl从右到左，ltr从左到右）</h5>

<p><code class="language-plaintext highlighter-rouge">document.dir</code>返回<strong>一个字符串，表示文字方向</strong>。它<strong>只有两个可能</strong>的值：<code class="language-plaintext highlighter-rouge">rtl</code>表示文字从右到左，阿拉伯文是这种方式；<code class="language-plaintext highlighter-rouge">ltr</code>表示文字从左到右，包括英语和汉语在内的大多数文字采用这种方式。</p>

<blockquote>
  <p>注： 第一次调用该属性时，可能返回空字符串””</p>
</blockquote>

<h5 id="9documentcompatmode-返回浏览器处理文档的模式向后兼容与严格模式">（9）document.compatMode 返回浏览器处理文档的模式（向后兼容与严格模式）</h5>

<p><code class="language-plaintext highlighter-rouge">compatMode</code>属性返回浏览器处理文档的模式，可能的值为<code class="language-plaintext highlighter-rouge">BackCompat</code>（向后兼容模式）和<code class="language-plaintext highlighter-rouge">CSS1Compat</code>（严格模式）。</p>

<p>一般来说，如果网页代码的第一行设置了明确的<code class="language-plaintext highlighter-rouge">DOCTYPE</code>（比如``），<code class="language-plaintext highlighter-rouge">document.compatMode</code>的值都为<code class="language-plaintext highlighter-rouge">CSS1Compat</code>。</p>

<h4 id="24-文档状态属性">2.4 文档状态属性</h4>

<h5 id="1documenthidden-当前页面是否可见返布尔值">（1）document.hidden 当前页面是否可见，返布尔值。</h5>

<p><code class="language-plaintext highlighter-rouge">document.hidden</code>属性<strong>返回一个布尔值，表示当前页面是否可见</strong>。如果<strong>窗口最小化、浏览器切换了 Tab，都会导致导致页面不可见，使得<code class="language-plaintext highlighter-rouge">document.hidden</code>返回<code class="language-plaintext highlighter-rouge">true</code>。</strong></p>

<p>这个属性是 Page Visibility API 引入的，一般都是配合这个 API 使用。</p>

<h5 id="2documentvisibilitystate-返回文档可见状态visiblehiddenprerenderunloaded">（2）document.visibilityState 返回文档可见状态（visible、hidden、prerender、unloaded）</h5>

<p><code class="language-plaintext highlighter-rouge">document.visibilityState</code><strong>返回文档的可见状态</strong>。</p>

<p>它的值有<strong>四种状态</strong>。</p>

<blockquote>
  <ul>
    <li><code class="language-plaintext highlighter-rouge">visible</code>：页面可见。注意，页面可能是部分可见，即不是焦点窗口，前面被其他窗口部分挡住了。</li>
    <li><code class="language-plaintext highlighter-rouge">hidden</code>：页面不可见，有可能窗口最小化，或者浏览器切换到了另一个 Tab。</li>
    <li><code class="language-plaintext highlighter-rouge">prerender</code>：页面处于正在渲染状态，对于用户来说，该页面不可见。</li>
    <li><code class="language-plaintext highlighter-rouge">unloaded</code>：页面从内存里面卸载了。</li>
  </ul>
</blockquote>

<p><strong>这个属性可以用在页面加载时，防止加载某些资源；或者页面不可见时，停掉一些页面功能。</strong></p>

<h5 id="3documentreadystate-返回当前文档的状态loadinginteractivecomplete">（3）document.readyState 返回当前文档的状态（loading、interactive、complete）</h5>

<p><code class="language-plaintext highlighter-rouge">document.readyState</code>属性<strong>返回当前文档的状态</strong>，共有<strong>三种可能</strong>的值。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">loading</code>：加载 HTML 代码阶段（尚未完成解析）</li>
  <li><code class="language-plaintext highlighter-rouge">interactive</code>：加载外部资源阶段</li>
  <li><code class="language-plaintext highlighter-rouge">complete</code>：加载完成</li>
</ul>

<p>这个属性变化的过程如下。</p>

<ol>
  <li>浏览器开始解析 HTML 文档，<code class="language-plaintext highlighter-rouge">document.readyState</code>属性等于<code class="language-plaintext highlighter-rouge">loading</code>。</li>
  <li>浏览器遇到 HTML 文档中的<code class="language-plaintext highlighter-rouge">  &lt;script&gt;  </code>元素，并且没有<code class="language-plaintext highlighter-rouge">async</code>或<code class="language-plaintext highlighter-rouge">defer</code>属性，就暂停解析，开始执行脚本，这时<code class="language-plaintext highlighter-rouge">document.readyState</code>属性还是等于<code class="language-plaintext highlighter-rouge">loading</code>。</li>
  <li>HTML 文档解析完成，<code class="language-plaintext highlighter-rouge">document.readyState</code>属性变成<code class="language-plaintext highlighter-rouge">interactive</code>。</li>
  <li>浏览器等待图片、样式表、字体文件等外部资源加载完成，一旦全部加载完成，<code class="language-plaintext highlighter-rouge">document.readyState</code>属性变成<code class="language-plaintext highlighter-rouge">complete</code>。</li>
</ol>

<p>下面的代码用来检查网页是否加载成功。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 基本检查</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">complete</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// ...</span>
<span class="p">}</span>

<span class="c1">// 轮询检查</span>
<span class="kd">var</span> <span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">complete</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">interval</span><span class="p">);</span>
    <span class="c1">// ...</span>
  <span class="p">}</span>
<span class="p">},</span> <span class="mi">100</span><span class="p">);</span>
</code></pre></div></div>

<p>另外，<strong>每次状态变化都会触发一个<code class="language-plaintext highlighter-rouge">readystatechange</code>事件。</strong></p>

<h4 id="25-documentcookie-用来操作浏览器-cookie">2.5 document.cookie 用来操作浏览器 Cookie</h4>

<p><code class="language-plaintext highlighter-rouge">document.cookie</code>属性用来操作浏览器 Cookie，详见《浏览器模型》部分的《Cookie》章节。</p>

<h4 id="26-documentdesignmode-控制当前文档是否可编辑onoff">2.6 document.designMode 控制当前文档是否可编辑（on、off）</h4>

<p><code class="language-plaintext highlighter-rouge">document.designMode</code>属性<strong>控制当前文档是否可编辑。该属性只有两个值<code class="language-plaintext highlighter-rouge">on</code>和<code class="language-plaintext highlighter-rouge">off</code>，默认值为<code class="language-plaintext highlighter-rouge">off</code></strong>。一旦设为<code class="language-plaintext highlighter-rouge">on</code>，用户就可以编辑整个文档的内容。</p>

<p>下面代码打开<code class="language-plaintext highlighter-rouge">iframe</code>元素内部文档的<code class="language-plaintext highlighter-rouge">designMode</code>属性，就能将其变为一个所见即所得的编辑器。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;iframe id="editor" src="about:blank"&gt;&lt;/iframe&gt;</span>
<span class="kd">var</span> <span class="nx">editor</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">editor</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">editor</span><span class="p">.</span><span class="nx">contentDocument</span><span class="p">.</span><span class="nx">designMode</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">on</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="27-documentimplementation-返回一个domimplementation对象">2.7 document.implementation 返回一个<code class="language-plaintext highlighter-rouge">DOMImplementation</code>对象</h4>

<p><code class="language-plaintext highlighter-rouge">document.implementation</code>属性<strong>返回一个<code class="language-plaintext highlighter-rouge">DOMImplementation</code>对象</strong>。该对象有三个方法，<strong>主要用于创建独立于当前文档的新的 Document 对象</strong>。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DOMImplementation.createDocument()</code>：创建一个 XML 文档。</li>
  <li><code class="language-plaintext highlighter-rouge">DOMImplementation.createHTMLDocument()</code>：创建一个 HTML 文档。</li>
  <li><code class="language-plaintext highlighter-rouge">DOMImplementation.createDocumentType()</code>：创建一个 DocumentType 对象。</li>
</ul>

<p>下面是创建 HTML 文档的例子。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">implementation</span><span class="p">.</span><span class="nx">createHTMLDocument</span><span class="p">(</span><span class="dl">'</span><span class="s1">Title</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">doc</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">replaceChild</span><span class="p">(</span>
  <span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span>
<span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，第一步生成一个新的 HTML 文档<code class="language-plaintext highlighter-rouge">doc</code>，然后用它的根元素<code class="language-plaintext highlighter-rouge">document.documentElement</code>替换掉<code class="language-plaintext highlighter-rouge">document.documentElement</code>。这会使得当前文档的内容全部消失，变成<code class="language-plaintext highlighter-rouge">hello world</code>。</p>

<h3 id="3方法">3、方法</h3>

<h4 id="31-documentopendocumentclose-打开和关闭文档可写状态">3.1 document.open()，document.close() 打开和关闭文档可写状态</h4>

<p><code class="language-plaintext highlighter-rouge">document.open</code>方法<strong>清除当前文档所有内容，使得文档处于可写状态，供<code class="language-plaintext highlighter-rouge">document.write</code>方法写入内容</strong>。</p>

<p><code class="language-plaintext highlighter-rouge">document.close</code>方法用来<strong>关闭<code class="language-plaintext highlighter-rouge">document.open()</code>打开的文档</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello world</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></div></div>

<h4 id="32-documentwrite-向当前文档写入内容documentwriteln-写入内容并换行">3.2 document.write() 向当前文档写入内容，document.writeln() 写入内容并换行</h4>

<p><code class="language-plaintext highlighter-rouge">document.write</code>方法<strong>用于向当前文档写入内容</strong>。</p>

<p>在网页的首次渲染阶段，只要页面没有关闭写入（即没有执行<code class="language-plaintext highlighter-rouge">document.close()</code>），<code class="language-plaintext highlighter-rouge">document.write</code>写入的内容就会追加在已有内容的后面。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 页面显示“helloworld”</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">world</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">document.write</code>会当作 HTML 代码解析，不会转义。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;p&gt;hello world&lt;/p&gt;</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">document.write</code>会将<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>当作 HTML 标签解释。</p>

<p>如果页面已经解析完成（<code class="language-plaintext highlighter-rouge">DOMContentLoaded</code>事件发生之后），再调用<code class="language-plaintext highlighter-rouge">write</code>方法，它会先调用<code class="language-plaintext highlighter-rouge">open</code>方法，擦除当前文档所有内容，然后再写入。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">DOMContentLoaded</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;p&gt;Hello World!&lt;/p&gt;</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// 等同于</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">DOMContentLoaded</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;p&gt;Hello World!&lt;/p&gt;</span><span class="dl">'</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div></div>

<p>如果在页面渲染过程中调用<code class="language-plaintext highlighter-rouge">write</code>方法，并不会自动调用<code class="language-plaintext highlighter-rouge">open</code>方法。（可以理解成，<code class="language-plaintext highlighter-rouge">open</code>方法已调用，但<code class="language-plaintext highlighter-rouge">close</code>方法还未调用。）</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
<span class="nx">hello</span>
<span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="o">&gt;</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="dl">"</span><span class="s2">world</span><span class="dl">"</span><span class="p">)</span>
<span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span></code></pre></div></div>

<p>在浏览器打开上面网页，将会显示<code class="language-plaintext highlighter-rouge">hello world</code>。</p>

<p><code class="language-plaintext highlighter-rouge">document.write</code>是 JavaScript 语言标准化之前就存在的方法，现在完全有更符合标准的方法向文档写入内容（比如对<code class="language-plaintext highlighter-rouge">innerHTML</code>属性赋值）。所以，<strong>除了某些特殊情况，应该尽量避免使用<code class="language-plaintext highlighter-rouge">document.write</code>这个方法。</strong></p>

<p><code class="language-plaintext highlighter-rouge">document.writeln</code>方法与<code class="language-plaintext highlighter-rouge">write</code>方法完全一致，除了会在输出内容的尾部添加换行符。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="c1">// 12</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
<span class="c1">// 1</span>
<span class="c1">// 2</span>
<span class="c1">//</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">writeln</code>方法添加的是 ASCII 码的换行符，渲染成 HTML 网页时不起作用，即在网页上显示不出换行。网页上的换行，必须显式写入<code class="language-plaintext highlighter-rouge"> </code>。</p>

<h4 id="33-documentqueryselector-返回匹配该选择器的元素节点documentqueryselectorall-返回一个nodelist对象包含所有匹配给定选择器的节点">3.3 document.querySelector() 返回匹配该选择器的元素节点，document.querySelectorAll() 返回一个<code class="language-plaintext highlighter-rouge">NodeList</code>对象，包含所有匹配给定选择器的节点</h4>

<p><code class="language-plaintext highlighter-rouge">document.querySelector</code>方法接受一个 CSS 选择器作为参数，<strong>返回匹配该选择器的元素节点</strong>。如果有多个节点满足匹配条件，则返回第一个匹配的节点。如果没有发现匹配的节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">el1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.myclass</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">el2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#myParent &gt; [ng-click]</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document.querySelectorAll</code>方法与<code class="language-plaintext highlighter-rouge">querySelector</code>用法类似，区别是<strong>返回一个<code class="language-plaintext highlighter-rouge">NodeList</code>对象，包含所有匹配给定选择器的节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">elementList</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.myclass</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>这两个方法的参数，可以是逗号分隔的多个 CSS 选择器，返回匹配其中一个选择器的元素节点，这与 CSS 选择器的规则是一致的。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">div.note, div.alert</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码返回<code class="language-plaintext highlighter-rouge">class</code>属性是<code class="language-plaintext highlighter-rouge">note</code>或<code class="language-plaintext highlighter-rouge">alert</code>的<code class="language-plaintext highlighter-rouge">div</code>元素。</p>

<p>这两个方法都<strong>支持复杂的 CSS 选择器</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 选中 data-foo-bar 属性等于 someval 的元素</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-foo-bar="someval"]</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 选中 myForm 表单中所有不通过验证的元素</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">#myForm :invalid</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 选中div元素，那些 class 含 ignore 的除外</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">DIV:not(.ignore)</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 同时选中 div，a，script 三类元素</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">DIV, A, SCRIPT</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>但是，它们<strong>不支持 CSS 伪元素的选择器</strong>（比如<code class="language-plaintext highlighter-rouge">:first-line</code>和<code class="language-plaintext highlighter-rouge">:first-letter</code>）和<strong>伪类的选择器</strong>（比如<code class="language-plaintext highlighter-rouge">:link</code>和<code class="language-plaintext highlighter-rouge">:visited</code>），即无法选中伪元素和伪类。</p>

<p>如果<code class="language-plaintext highlighter-rouge">querySelectorAll</code>方法的参数是字符串<code class="language-plaintext highlighter-rouge">*</code>，则会返回文档中的所有元素节点。另外，<code class="language-plaintext highlighter-rouge">querySelectorAll</code>的返回结果不是动态集合，不会实时反映元素节点的变化。</p>

<p>最后，这两个方法除了定义在<code class="language-plaintext highlighter-rouge">document</code>对象上，还定义在元素节点上，即<strong>在元素节点上也可以调用</strong>。</p>

<h4 id="34-documentgetelementsbytagname-搜索-html-标签名返回符合条件的元素">3.4 document.getElementsByTagName() 搜索 HTML 标签名，返回符合条件的元素</h4>

<p><code class="language-plaintext highlighter-rouge">document.getElementsByTagName</code>方法<strong>搜索 HTML 标签名，返回符合条件的元素</strong>。它的返回值是一个类似数组对象（<strong><code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例</strong>），可以实时反映 HTML 文档的变化。如果没有任何匹配的元素，就返回一个空集。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">paras</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">paras</span> <span class="k">instanceof</span> <span class="nx">HTMLCollection</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码返回当前文档的所有<code class="language-plaintext highlighter-rouge">p</code>元素节点。</p>

<p>HTML 标签名是大小写不敏感的，因此<code class="language-plaintext highlighter-rouge">getElementsByTagName</code>方法也是大小写不敏感的。另外，返回结果中，各个成员的顺序就是它们在文档中出现的顺序。</p>

<p>如果传入<code class="language-plaintext highlighter-rouge">*</code>，就可以返回文档中所有 HTML 元素。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">allElements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>注意</strong>，元素节点本身也定义了<code class="language-plaintext highlighter-rouge">getElementsByTagName</code>方法，返回该元素的后代元素中符合条件的元素。也就是说，这个方法不仅可以在<code class="language-plaintext highlighter-rouge">document</code>对象上调用，也可以在任何元素节点上调用。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">firstPara</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">spans</span> <span class="o">=</span> <span class="nx">firstPara</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">span</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码选中第一个<code class="language-plaintext highlighter-rouge">p</code>元素内部的所有<code class="language-plaintext highlighter-rouge">span</code>元素。</p>

<h4 id="35-documentgetelementsbyclassname-返回class符合条件的元素">3.5 document.getElementsByClassName() 返回class符合条件的元素</h4>

<p><code class="language-plaintext highlighter-rouge">document.getElementsByClassName</code>方法返回一个类似数组的对象（<strong><code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例</strong>），<strong>包括了所有<code class="language-plaintext highlighter-rouge">class</code>名字符合指定条件的元素，元素的变化实时反映在返回结果中</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">names</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>由于<code class="language-plaintext highlighter-rouge">class</code>是保留字，所以 JavaScript 一律使用<code class="language-plaintext highlighter-rouge">className</code>表示 CSS 的<code class="language-plaintext highlighter-rouge">class</code>。</strong></p>

<p>参数可以是多个<code class="language-plaintext highlighter-rouge">class</code>，它们之间使用空格分隔。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo bar</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码返回<strong>同时具有<code class="language-plaintext highlighter-rouge">foo</code>和<code class="language-plaintext highlighter-rouge">bar</code>两个<code class="language-plaintext highlighter-rouge">class</code>的元素</strong>，<code class="language-plaintext highlighter-rouge">foo</code>和<code class="language-plaintext highlighter-rouge">bar</code>的顺序不重要。</p>

<p>注意，正常模式下，CSS 的<code class="language-plaintext highlighter-rouge">class</code>是大小写敏感的。（<code class="language-plaintext highlighter-rouge">quirks mode</code>下，大小写不敏感。）</p>

<p>与<code class="language-plaintext highlighter-rouge">getElementsByTagName</code>方法一样，<code class="language-plaintext highlighter-rouge">getElementsByClassName</code>方法不仅可以在<code class="language-plaintext highlighter-rouge">document</code>对象上调用，也可以在任何元素节点上调用。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 非document对象上调用</span>
<span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">rootElement</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">names</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="36-documentgetelementsbyname-返回拥有相应name值的元素">3.6 document.getElementsByName() 返回拥有相应name值的元素</h4>

<p><code class="language-plaintext highlighter-rouge">document.getElementsByName</code>方法用于选择拥有<code class="language-plaintext highlighter-rouge">name</code>属性的 HTML 元素（比如<code class="language-plaintext highlighter-rouge"> &lt;form&gt; </code>、<code class="language-plaintext highlighter-rouge"> &lt;radio&gt; </code>、<code class="language-plaintext highlighter-rouge">  &lt;img&gt;  </code>、<code class="language-plaintext highlighter-rouge"> &lt;frame&gt; </code>、<code class="language-plaintext highlighter-rouge"> &lt;embed&gt; </code>和<code class="language-plaintext highlighter-rouge"> &lt;object&gt; </code>等），返回一个类似数组的的对象（<strong><code class="language-plaintext highlighter-rouge">NodeList</code>实例</strong>），因为<code class="language-plaintext highlighter-rouge">name</code>属性相同的元素可能不止一个。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 表单为 &lt;form name="x"&gt;&lt;/form&gt;</span>
<span class="kd">var</span> <span class="nx">forms</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByName</span><span class="p">(</span><span class="dl">'</span><span class="s1">x</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">tagName</span> <span class="c1">// "FORM"</span>
</code></pre></div></div>

<h4 id="37-documentgetelementbyid-返回匹配指定id属性的元素节点">3.7 document.getElementById() 返回匹配指定<code class="language-plaintext highlighter-rouge">id</code>属性的元素节点</h4>

<p><code class="language-plaintext highlighter-rouge">document.getElementById</code>方法<strong>返回匹配指定<code class="language-plaintext highlighter-rouge">id</code>属性的元素节点</strong>。如果没有发现匹配的节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">para1</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>注意，该方法的参数是大小写敏感的。比如，如果某个节点的<code class="language-plaintext highlighter-rouge">id</code>属性是<code class="language-plaintext highlighter-rouge">main</code>，那么<code class="language-plaintext highlighter-rouge">document.getElementById('Main')</code>将返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<p><strong><code class="language-plaintext highlighter-rouge">document.getElementById</code>方法与<code class="language-plaintext highlighter-rouge">document.querySelector</code>方法都能获取元素节点，</strong>不同之处是<code class="language-plaintext highlighter-rouge">document.querySelector</code>方法的参数使用 CSS 选择器语法，<code class="language-plaintext highlighter-rouge">document.getElementById</code>方法的参数是元素的<code class="language-plaintext highlighter-rouge">id</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myElement</span><span class="dl">'</span><span class="p">)</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#myElement</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码中，两个方法都能选中<code class="language-plaintext highlighter-rouge">id</code>为<code class="language-plaintext highlighter-rouge">myElement</code>的元素，但是<code class="language-plaintext highlighter-rouge">document.getElementById()</code>比<code class="language-plaintext highlighter-rouge">document.querySelector()</code>效率高得多。</p>

<p>另外，<strong>这个方法只能在<code class="language-plaintext highlighter-rouge">document</code>对象上使用，不能在其他元素节点上使用</strong>。</p>

<h4 id="38-documentelementfrompointx-y-返回位于页面指定坐标最上层的元素节点documentelementsfrompointx-y-返回一个数组成员是位于指定坐标的所有元素">3.8 document.elementFromPoint(x, y) 返回位于页面指定坐标最上层的元素节点，document.elementsFromPoint(x, y) 返回一个数组，成员是位于指定坐标的所有元素</h4>

<p><code class="language-plaintext highlighter-rouge">document.elementFromPoint</code>方法<strong>返回位于页面指定位置最上层的元素节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">elementFromPoint</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码选中在<code class="language-plaintext highlighter-rouge">(50, 50)</code>这个坐标位置的最上层的那个 HTML 元素。</p>

<p><code class="language-plaintext highlighter-rouge">elementFromPoint</code>方法的<strong>两个参数</strong>，依次<strong>是相对于当前视口左上角的横坐标和纵坐标</strong>，单位是像素。如果位于该位置的 HTML 元素不可返回（比如文本框的滚动条），则返回它的父元素（比如文本框）。如果坐标值无意义（比如负值或超过视口大小），则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<p><code class="language-plaintext highlighter-rouge">document.elementsFromPoint()</code><strong>返回一个数组，成员是位于指定坐标（相对于视口）的所有元素</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">elementsFromPoint</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>注意：这两个方法的坐标都是相对于视口，就是说当滚动条滚动时，选中的元素可能会跟着变化。</strong></p>

<h4 id="39-documentcreateelement-创建元素节点并返回">3.9 document.createElement() 创建元素节点，并返回</h4>

<p><code class="language-plaintext highlighter-rouge">document.createElement</code>方法<strong>用来生成元素节点，并返回该节点。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">newDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">createElement</code>方法的参数为元素的标签名，即元素节点的<code class="language-plaintext highlighter-rouge">tagName</code>属性，对于 HTML 网页大小写不敏感，即参数为<code class="language-plaintext highlighter-rouge">div</code>或<code class="language-plaintext highlighter-rouge">DIV</code>返回的是同一种节点。如果参数里面包含尖括号（即<code class="language-plaintext highlighter-rouge">&lt;</code>和<code class="language-plaintext highlighter-rouge">&gt;</code>）会报错。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;div&gt;</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// DOMException: The tag name provided ('&lt;div&gt;') is not a valid name</span>
</code></pre></div></div>

<p><strong>注意</strong>，<code class="language-plaintext highlighter-rouge">document.createElement</code>的参数可以是自定义的标签名。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="310-documentcreatetextnode-创建文本节点并返回">3.10 document.createTextNode() 创建文本节点，并返回</h4>

<p><code class="language-plaintext highlighter-rouge">document.createTextNode</code>方法<strong>用来生成文本节点（<code class="language-plaintext highlighter-rouge">Text</code>实例），并返回该节点</strong>。它的<strong>参数是文本节点的内容</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">newDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">newContent</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">newDiv</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newContent</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码新建一个<code class="language-plaintext highlighter-rouge">div</code>节点和一个文本节点，然后将文本节点插入<code class="language-plaintext highlighter-rouge">div</code>节点。</p>

<p><strong>这个方法可以确保返回的节点，被浏览器当作文本渲染，而不是当作 HTML 代码渲染。因此，可以用来展示用户的输入，避免 XSS 攻击。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="dl">'</span><span class="s1">&lt;span&gt;Foo &amp; bar&lt;/span&gt;</span><span class="dl">'</span><span class="p">));</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">)</span>
<span class="c1">// &amp;lt;span&amp;gt;Foo &amp;amp; bar&amp;lt;/span&amp;gt;</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">createTextNode</code>方法对大于号和小于号进行转义，从而保证即使用户输入的内容包含恶意代码，也能正确显示。</p>

<p>需要注意的是，该方法不对单引号和双引号转义，所以不能用来对 HTML 属性赋值。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">escapeHtml</span><span class="p">(</span><span class="nx">str</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">div</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">str</span><span class="p">));</span>
  <span class="k">return</span> <span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">userWebsite</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">" onmouseover="alert(</span><span class="se">\'</span><span class="s1">derp</span><span class="se">\'</span><span class="s1">)" "</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">profileLink</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;a href="</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">escapeHtml</span><span class="p">(</span><span class="nx">userWebsite</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">"&gt;Bob&lt;/a&gt;</span><span class="dl">'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">target</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">profileLink</span><span class="p">;</span>
<span class="c1">// &lt;a href="" onmouseover="alert('derp')" ""&gt;Bob&lt;/a&gt;</span>
</code></pre></div></div>

<p>上面代码中，由于<code class="language-plaintext highlighter-rouge">createTextNode</code>方法不转义双引号，导致<code class="language-plaintext highlighter-rouge">onmouseover</code>方法被注入了代码。</p>

<h4 id="311-documentcreateattribute-创建属性节点并返回">3.11 document.createAttribute() 创建属性节点，并返回</h4>

<p><code class="language-plaintext highlighter-rouge">document.createAttribute</code>方法<strong>生成一个新的属性节点（<code class="language-plaintext highlighter-rouge">Attr</code>实例），并返回它</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">attribute</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createAttribute</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document.createAttribute</code>方法的参数<code class="language-plaintext highlighter-rouge">name</code>，是属性的名称。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div1</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">my_attrib</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">newVal</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">node</span><span class="p">.</span><span class="nx">setAttributeNode</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
<span class="c1">// 或者</span>
<span class="nx">node</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">my_attrib</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">newVal</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码为<code class="language-plaintext highlighter-rouge">div1</code>节点，插入一个值为<code class="language-plaintext highlighter-rouge">newVal</code>的<code class="language-plaintext highlighter-rouge">my_attrib</code>属性。</p>

<h4 id="312-documentcreatecomment-创建注释节点并返回">3.12 document.createComment() 创建注释节点，并返回</h4>

<p><code class="language-plaintext highlighter-rouge">document.createComment</code>方法<strong>生成一个新的注释节点，并返回该节点。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">CommentNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createComment</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document.createComment</code>方法的参数是一个字符串，会成为注释节点的内容。</p>

<h4 id="313-documentcreatedocumentfragment-创建空文档片段对象">3.13 document.createDocumentFragment() 创建空文档片段对象</h4>

<p><code class="language-plaintext highlighter-rouge">document.createDocumentFragment</code>方法<strong>生成一个空的文档片段对象（<code class="language-plaintext highlighter-rouge">DocumentFragment</code>实例）</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">docFragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">DocumentFragment</code><strong>是一个存在于内存的 DOM 片段，不属于当前文档，常常用来生成一段较复杂的 DOM 结构，然后再插入当前文档</strong>。这样做的好处在于，因为<code class="language-plaintext highlighter-rouge">DocumentFragment</code>不属于当前文档，对它的任何改动，都不会引发网页的重新渲染，<strong>比直接修改当前文档的 DOM 有更好的性能表现。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">docfrag</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>

<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">li</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">e</span><span class="p">;</span>
  <span class="nx">docfrag</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">var</span> <span class="nx">element</span>  <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">docfrag</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，文档片断<code class="language-plaintext highlighter-rouge">docfrag</code>包含四个<code class="language-plaintext highlighter-rouge"> &lt;li&gt; </code>节点，这些子节点被一次性插入了当前文档。</p>

<h4 id="314-documentcreateevent-创建事件对象event实例">3.14 document.createEvent() 创建事件对象（Event实例）</h4>

<p><code class="language-plaintext highlighter-rouge">document.createEvent</code>方法<strong>生成一个事件对象（<code class="language-plaintext highlighter-rouge">Event</code>实例）</strong>，该对象可以被<code class="language-plaintext highlighter-rouge">element.dispatchEvent</code>方法使用，触发指定事件。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="nx">type</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document.createEvent</code>方法的<strong>参数是事件类型，比如<code class="language-plaintext highlighter-rouge">UIEvents</code>、<code class="language-plaintext highlighter-rouge">MouseEvents</code>、<code class="language-plaintext highlighter-rouge">MutationEvents</code>、<code class="language-plaintext highlighter-rouge">HTMLEvents</code>。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">Event</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">event</span><span class="p">.</span><span class="nx">initEvent</span><span class="p">(</span><span class="dl">'</span><span class="s1">build</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">build</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span> <span class="c1">// "build"</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码新建了一个名为<code class="language-plaintext highlighter-rouge">build</code>的事件实例，然后触发该事件。</p>

<h4 id="315-documentaddeventlistener-添加事件监听documentremoveeventlistener-移除事件监听documentdispatchevent-触发事件">3.15 document.addEventListener() 添加事件监听，document.removeEventListener() 移除事件监听，document.dispatchEvent() 触发事件</h4>

<p>这三个方法用于处理<code class="language-plaintext highlighter-rouge">document</code>节点的事件。它们都继承自<code class="language-plaintext highlighter-rouge">EventTarget</code>接口，详细介绍参见《EventTarget 接口》一章。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 添加事件监听函数</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// 移除事件监听函数</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="c1">// 触发事件</span>
<span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="316-documenthasfocus-判断当前文档是否有元素被激活或获取焦点">3.16 document.hasFocus() 判断当前文档是否有元素被激活或获取焦点</h4>

<p><code class="language-plaintext highlighter-rouge">document.hasFocus</code>方法<strong>返回一个布尔值，表示当前文档之中是否有元素被激活或获得焦点。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">focused</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">hasFocus</span><span class="p">();</span>
</code></pre></div></div>

<p><strong>注意，有焦点的文档必定被激活（active），反之不成立，激活的文档未必有焦点。比如，用户点击按钮，从当前窗口跳出一个新窗口，该新窗口就是激活的，但是不拥有焦点。</strong></p>

<h4 id="317-documentadoptnode-采用外部节点documentimportnode-输入拷贝外部节点">3.17 document.adoptNode() 采用外部节点，document.importNode() 输入（拷贝）外部节点</h4>

<p><code class="language-plaintext highlighter-rouge">document.adoptNode</code>方法<strong>将某个节点及其子节点，从原来所在的文档或<code class="language-plaintext highlighter-rouge">DocumentFragment</code>里面移除，归属当前<code class="language-plaintext highlighter-rouge">document</code>对象，返回插入后的新节点</strong>。插入的节点对象的<code class="language-plaintext highlighter-rouge">ownerDocument</code>属性，会变成当前的<code class="language-plaintext highlighter-rouge">document</code>对象，而<code class="language-plaintext highlighter-rouge">parentNode</code>属性是<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">adoptNode</span><span class="p">(</span><span class="nx">externalNode</span><span class="p">);</span> <span class="c1">// externalNode 外部节点</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">node</span><span class="p">);</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">document.adoptNode</code>方法只是<strong>改变了节点的归属</strong>，并没有将这个节点插入新的文档树。所以，还要再用<code class="language-plaintext highlighter-rouge">appendChild</code>方法或<code class="language-plaintext highlighter-rouge">insertBefore</code>方法，将新节点插入当前文档树。</p>

<p><code class="language-plaintext highlighter-rouge">document.importNode</code>方法则是<strong>从原来所在的文档或<code class="language-plaintext highlighter-rouge">DocumentFragment</code>里面，拷贝某个节点及其子节点，让它们归属当前<code class="language-plaintext highlighter-rouge">document</code>对象</strong>。拷贝的节点对象的<code class="language-plaintext highlighter-rouge">ownerDocument</code>属性，会变成当前的<code class="language-plaintext highlighter-rouge">document</code>对象，而<code class="language-plaintext highlighter-rouge">parentNode</code>属性是<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">node</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">importNode</span><span class="p">(</span><span class="nx">externalNode</span><span class="p">,</span> <span class="nx">deep</span><span class="p">);</span> <span class="c1">// externalNode 外部节点 deep是否深拷贝</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">document.importNode</code>方法的<strong>第一个参数是外部节点</strong>，<strong>第二个参数是一个布尔值，表示对外部节点是深拷贝还是浅拷贝</strong>，默认是浅拷贝（false）。虽然第二个参数是可选的，但是建议总是保留这个参数，并设为<code class="language-plaintext highlighter-rouge">true</code>。</p>

<p>注意，<code class="language-plaintext highlighter-rouge">document.importNode</code>方法只是拷贝外部节点，这时该节点的父节点是<code class="language-plaintext highlighter-rouge">null</code>。下一步还必须将这个节点插入当前文档树。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">oldNode</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myNode</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">newNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">importNode</span><span class="p">(</span><span class="nx">oldNode</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">container</span><span class="dl">"</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>上面代码从<code class="language-plaintext highlighter-rouge">iframe</code>窗口，拷贝一个指定节点<code class="language-plaintext highlighter-rouge">myNode</code>，插入当前文档。</strong></p>

<h4 id="318-documentcreatenodeiterator-返回一个子节点遍历器nodefilter实例">3.18 document.createNodeIterator() 返回一个子节点遍历器（NodeFilter实例）</h4>

<p><code class="language-plaintext highlighter-rouge">document.createNodeIterator</code>方法<strong>返回一个子节点遍历器（NodeFilter实例）</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">nodeIterator</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createNodeIterator</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="c1">// 所要遍历的根节点</span>
  <span class="nx">NodeFilter</span><span class="p">.</span><span class="nx">SHOW_ELEMENT</span> <span class="c1">// 所要遍历的节点类型</span>
<span class="p">);</span>
</code></pre></div></div>

<p>上面代码返回<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>元素子节点的遍历器。</p>

<p><code class="language-plaintext highlighter-rouge">document.createNodeIterator</code>方法<strong>第一个参数为所要遍历的根节点</strong>，<strong>第二个参数为所要遍历的节点类型</strong>，这里指定为元素节点（<code class="language-plaintext highlighter-rouge">NodeFilter.SHOW_ELEMENT</code>）。几种主要的节点类型写法如下。</p>

<ul>
  <li><strong>所有节点：NodeFilter.SHOW_ALL</strong></li>
  <li><strong>元素节点：NodeFilter.SHOW_ELEMENT</strong></li>
  <li><strong>文本节点：NodeFilter.SHOW_TEXT</strong></li>
  <li><strong>评论节点：NodeFilter.SHOW_COMMENT</strong></li>
</ul>

<p><code class="language-plaintext highlighter-rouge">document.createNodeIterator</code>方法返回一个“遍历器”对象（<code class="language-plaintext highlighter-rouge">NodeFilter</code>实例）。该实例的<code class="language-plaintext highlighter-rouge">nextNode()</code>方法和<code class="language-plaintext highlighter-rouge">previousNode()</code>方法，可以用来遍历所有子节点。</p>

<p><strong>每次调用NodeFilter实例的nextNode() / previousNode()方法都会把当前指针往 下一个 / 上一个节点移动。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">nodeIterator</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createNodeIterator</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">pars</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">currentNode</span><span class="p">;</span>

<span class="k">while</span> <span class="p">(</span><span class="nx">currentNode</span> <span class="o">=</span> <span class="nx">nodeIterator</span><span class="p">.</span><span class="nx">nextNode</span><span class="p">())</span> <span class="p">{</span>
    <span class="c1">// js中所有运算符都有返回值，为运算结果。这里面即给currentNode赋值了，还会自动调用Boolean()进行布尔运算。</span>
    <span class="c1">// 每次调用NodeFilter实例的nextNode()方法都会返回下一个节点</span>

  <span class="nx">pars</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">currentNode</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，使用遍历器的<code class="language-plaintext highlighter-rouge">nextNode</code>方法，将根节点的所有子节点，依次读入一个数组。<code class="language-plaintext highlighter-rouge">nextNode</code>方法先返回遍历器的内部指针所在的节点，然后会将指针移向下一个节点。所有成员遍历完成后，返回<code class="language-plaintext highlighter-rouge">null</code>。<code class="language-plaintext highlighter-rouge">previousNode</code>方法则是先将指针移向上一个节点，然后返回该节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">nodeIterator</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createNodeIterator</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span>
  <span class="nx">NodeFilter</span><span class="p">.</span><span class="nx">SHOW_ELEMENT</span>
<span class="p">);</span>

<span class="kd">var</span> <span class="nx">currentNode</span> <span class="o">=</span> <span class="nx">nodeIterator</span><span class="p">.</span><span class="nx">nextNode</span><span class="p">();</span>
<span class="kd">var</span> <span class="nx">previousNode</span> <span class="o">=</span> <span class="nx">nodeIterator</span><span class="p">.</span><span class="nx">previousNode</span><span class="p">();</span>

<span class="nx">currentNode</span> <span class="o">===</span> <span class="nx">previousNode</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">currentNode</code>和<code class="language-plaintext highlighter-rouge">previousNode</code>都指向同一个的节点。</p>

<p>注意，遍历器返回的<strong>第一个节点，总是根节点</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="319-documentcreatetreewalker-返回一个dom的子树遍历器treewalker实例">3.19 document.createTreeWalker() 返回一个DOM的子树遍历器（TreeWalker实例）</h4>

<p><code class="language-plaintext highlighter-rouge">document.createTreeWalker</code>方法<strong>返回一个 DOM 的子树遍历器</strong>。它与<code class="language-plaintext highlighter-rouge">document.createNodeIterator</code>方法基本是类似的，区别在于它返回的是<code class="language-plaintext highlighter-rouge">TreeWalker</code>实例，后者返回的是<code class="language-plaintext highlighter-rouge">NodeIterator</code>实例。另外，它的<strong>第一个节点不是根节点</strong>。</p>

<p><code class="language-plaintext highlighter-rouge">document.createTreeWalker</code>方法的<strong>第一个参数是所要遍历的根节点</strong>，<strong>第二个参数指定所要遍历的节点类型</strong>（与<code class="language-plaintext highlighter-rouge">document.createNodeIterator</code>方法的第二个参数相同）。</p>

<p><strong>和<code class="language-plaintext highlighter-rouge">document.createNodeIterator</code>方法区别二是：<code class="language-plaintext highlighter-rouge">TreeWalker</code>实例有<code class="language-plaintext highlighter-rouge">currentNode</code>属性。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">treeWalker</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTreeWalker</span><span class="p">(</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="c1">// 所要遍历的根节点</span>
  <span class="nx">NodeFilter</span><span class="p">.</span><span class="nx">SHOW_ELEMENT</span> <span class="c1">// 所要遍历的节点类型</span>
<span class="p">);</span>

<span class="kd">var</span> <span class="nx">nodeList</span> <span class="o">=</span> <span class="p">[];</span>
<span class="c1">// 每调用一次nextNode()，currentNode属性的值将改为下一个节点</span>
<span class="k">while</span><span class="p">(</span><span class="nx">treeWalker</span><span class="p">.</span><span class="nx">nextNode</span><span class="p">())</span> <span class="p">{</span>
  <span class="nx">nodeList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">treeWalker</span><span class="p">.</span><span class="nx">currentNode</span><span class="p">);</span> <span class="c1">// TreeWalker实例有currentNode属性</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码遍历<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>节点下属的所有元素节点，将它们插入<code class="language-plaintext highlighter-rouge">nodeList</code>数组。</p>

<h4 id="320-documentexeccommanddocumentquerycommandsupporteddocumentquerycommandenabled">3.20 document.execCommand()，document.queryCommandSupported()，document.queryCommandEnabled()</h4>

<h5 id="1documentexeccommand-执行命令实现复制文本等功能富文本编辑器大量使用此方法">（1）document.execCommand() 执行命令（实现复制文本等功能，富文本编辑器大量使用此方法）</h5>

<p>概念一： <strong>当一个HTML文档切换到设计模式时，<code class="language-plaintext highlighter-rouge">document</code>暴露 <code class="language-plaintext highlighter-rouge">execCommand</code> 方法，该方法允许运行命令来操纵<a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Global_attributes/contenteditable">可编辑内容区域</a>的元素。</strong></p>

<p>概念二： <strong>execCommand方法是执行一个对当前文档，当前选择或者给出范围的命令。处理Html数据时常用</strong></p>

<p>概念三：如果<code class="language-plaintext highlighter-rouge">document.designMode</code>属性设为<code class="language-plaintext highlighter-rouge">on</code>，那么整个文档用户可编辑；如果元素的<code class="language-plaintext highlighter-rouge">contenteditable</code>属性设为<code class="language-plaintext highlighter-rouge">true</code>，那么该元素可编辑。这两种情况下，可以使用<code class="language-plaintext highlighter-rouge">document.execCommand()</code>方法，改变内容的样式，比如<code class="language-plaintext highlighter-rouge">document.execCommand('bold')</code>会使得字体加粗。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="nx">command</span><span class="p">,</span> <span class="nx">showDefaultUI</span><span class="p">,</span> <span class="nx">input</span><span class="p">)</span>
</code></pre></div></div>

<p>该方法接受三个参数。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">command</code>：字符串，表示所要实施的样式。</li>
  <li><code class="language-plaintext highlighter-rouge">showDefaultUI</code>：布尔值，表示是否要使用默认的用户界面，建议总是设为<code class="language-plaintext highlighter-rouge">false</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">input</code>：字符串，表示该样式的辅助内容，比如生成超级链接时，这个参数就是所要链接的网址。如果第二个参数设为<code class="language-plaintext highlighter-rouge">true</code>，那么浏览器会弹出提示框，要求用户在提示框输入该参数。但是，不是所有浏览器都支持这样做，为了兼容性，还是需要自己部署获取这个参数的方式。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">prompt</span><span class="p">(</span><span class="dl">'</span><span class="s1">请输入网址</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">'</span><span class="s1">createlink</span><span class="dl">'</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">url</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，先提示用户输入所要链接的网址，然后手动生成超级链接。注意，第二个参数是<code class="language-plaintext highlighter-rouge">false</code>，表示此时不需要自动弹出提示框。</p>

<p><code class="language-plaintext highlighter-rouge">document.execCommand()</code>的返回值是一个布尔值。如果为<code class="language-plaintext highlighter-rouge">false</code>，表示这个方法无法生效。</p>

<p>这个方法大部分情况下，只对选中的内容生效。如果有多个内容可编辑区域，那么只对当前焦点所在的元素生效。</p>

<p><code class="language-plaintext highlighter-rouge">document.execCommand()</code>方法可以执行的样式改变有很多种，下面是其中的一些：bold、insertLineBreak、selectAll、createLink、insertOrderedList、subscript、delete、insertUnorderedList、superscript、formatBlock、insertParagraph、undo、forwardDelete、insertText、unlink、insertImage、italic、unselect、insertHTML、redo。这些值都可以用作第一个参数，它们的含义不难从字面上看出来。</p>

<h6 id="命令列表">命令列表</h6>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">1</span><span class="o">.</span> <span class="err">2</span><span class="nt">D-Position</span> <span class="nt">允许通过拖曳移动绝对定位的对象</span><span class="err">。</span>

<span class="err">2</span><span class="o">.</span> <span class="nt">AbsolutePosition</span> <span class="nt">设定元素的</span> <span class="nt">position</span> <span class="nt">属性为</span><span class="err">“</span><span class="nt">absolute</span><span class="err">”</span><span class="o">(</span><span class="nt">绝对</span><span class="o">)</span><span class="err">。</span>

<span class="err">3</span><span class="o">.</span> <span class="nt">BackColor</span> <span class="nt">设置或获取当前选中区的背景颜色</span><span class="err">。</span>

<span class="err">4</span><span class="o">.</span> <span class="nt">BlockDirLTR</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">5</span><span class="o">.</span> <span class="nt">BlockDirRTL</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">6</span><span class="o">.</span> <span class="nt">Bold</span> <span class="nt">切换当前选中区的粗体显示与否</span><span class="err">。</span>

<span class="err">7</span><span class="o">.</span> <span class="nt">BrowseMode</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">8</span><span class="o">.</span> <span class="nt">Copy</span> <span class="nt">将当前选中区复制到剪贴板</span><span class="err">。</span>

<span class="err">9</span><span class="o">.</span> <span class="nt">CreateBookmark</span> <span class="nt">创建一个书签锚或获取当前选中区或插入点的书签锚的名称</span><span class="err">。</span>

<span class="err">10</span><span class="nc">.CreateLink</span> <span class="nt">在当前选中区上插入超级链接</span><span class="err">，</span><span class="nt">或显示一个对话框允许用户指定要为当前选中区插入的超级链接的</span> <span class="nt">URL</span><span class="err">。</span>

<span class="err">11</span><span class="nc">.Cut</span> <span class="nt">将当前选中区复制到剪贴板并删除之</span><span class="err">。</span>

<span class="err">12</span><span class="nc">.Delete</span> <span class="nt">删除当前选中区</span><span class="err">。</span>

<span class="err">13</span><span class="nc">.DirLTR</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">14</span><span class="nc">.DirRTL</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">15</span><span class="nc">.EditMode</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">16</span><span class="nc">.FontName</span> <span class="nt">设置或获取当前选中区的字体</span><span class="err">。</span>

<span class="err">17</span><span class="nc">.FontSize</span> <span class="nt">设置或获取当前选中区的字体大小</span><span class="err">。</span>

<span class="err">18</span><span class="nc">.ForeColor</span> <span class="nt">设置或获取当前选中区的前景</span><span class="o">(</span><span class="nt">文本</span><span class="o">)</span><span class="nt">颜色</span><span class="err">。</span>

<span class="err">19</span><span class="nc">.FormatBlock</span> <span class="nt">设置当前块格式化标签</span><span class="err">。</span>

<span class="err">20</span><span class="nc">.Indent</span> <span class="nt">增加选中文本的缩进</span><span class="err">。</span>

<span class="err">21</span><span class="nc">.InlineDirLTR</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">22</span><span class="nc">.InlineDirRTL</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">23</span><span class="nc">.InsertButton</span> <span class="nt">用按钮控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">24</span><span class="nc">.InsertFieldset</span> <span class="nt">用方框覆盖当前选中区</span><span class="err">。</span>

<span class="err">25</span><span class="nc">.InsertHorizontalRule</span> <span class="nt">用水平线覆盖当前选中区</span><span class="err">。</span>

<span class="err">26</span><span class="nc">.InsertIFrame</span> <span class="nt">用内嵌框架覆盖当前选中区</span><span class="err">。</span>

<span class="err">27</span><span class="nc">.InsertImage</span> <span class="nt">用图像覆盖当前选中区</span><span class="err">。</span>

<span class="err">28</span><span class="nc">.InsertInputButton</span> <span class="nt">用按钮控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">29</span><span class="nc">.InsertInputCheckbox</span> <span class="nt">用复选框控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">30</span><span class="nc">.InsertInputFileUpload</span> <span class="nt">用文件上载控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">31</span><span class="nc">.InsertInputHidden</span> <span class="nt">插入隐藏控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">32</span><span class="nc">.InsertInputImage</span> <span class="nt">用图像控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">33</span><span class="nc">.InsertInputPassword</span> <span class="nt">用密码控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">34</span><span class="nc">.InsertInputRadio</span> <span class="nt">用单选钮控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">35</span><span class="nc">.InsertInputReset</span> <span class="nt">用重置控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">36</span><span class="nc">.InsertInputSubmit</span> <span class="nt">用提交控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">37</span><span class="nc">.InsertInputText</span> <span class="nt">用文本控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">38</span><span class="nc">.InsertMarquee</span> <span class="nt">用空字幕覆盖当前选中区</span><span class="err">。</span>

<span class="err">39</span><span class="nc">.InsertOrderedList</span> <span class="nt">切换当前选中区是编号列表还是常规格式化块</span><span class="err">。</span>

<span class="err">40</span><span class="nc">.InsertParagraph</span> <span class="nt">用换行覆盖当前选中区</span><span class="err">。</span>

<span class="err">41</span><span class="nc">.InsertSelectDropdown</span> <span class="nt">用下拉框控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">42</span><span class="nc">.InsertSelectListbox</span> <span class="nt">用列表框控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">43</span><span class="nc">.InsertTextArea</span> <span class="nt">用多行文本输入控件覆盖当前选中区</span><span class="err">。</span>

<span class="err">44</span><span class="nc">.InsertUnorderedList</span> <span class="nt">切换当前选中区是项目符号列表还是常规格式化块</span><span class="err">。</span>

<span class="err">45</span><span class="nc">.Italic</span> <span class="nt">切换当前选中区斜体显示与否</span><span class="err">。</span>

<span class="err">46</span><span class="nc">.JustifyCenter</span> <span class="nt">将当前选中区在所在格式化块置中</span><span class="err">。</span>

<span class="err">47</span><span class="nc">.JustifyFull</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">48</span><span class="nc">.JustifyLeft</span> <span class="nt">将当前选中区所在格式化块左对齐</span><span class="err">。</span>

<span class="err">49</span><span class="nc">.JustifyNone</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">50</span><span class="nc">.JustifyRight</span> <span class="nt">将当前选中区所在格式化块右对齐</span><span class="err">。</span>

<span class="err">51</span><span class="nc">.LiveResize</span> <span class="nt">迫使</span> <span class="nt">MSHTML</span> <span class="nt">编辑器在缩放或移动过程中持续更新元素外观</span><span class="err">，</span><span class="nt">而不是只在移动或缩放完成后更新</span><span class="err">。</span>

<span class="err">52</span><span class="nc">.MultipleSelection</span> <span class="nt">允许当用户按住</span> <span class="nt">Shift</span> <span class="nt">或</span> <span class="nt">Ctrl</span> <span class="nt">键时一次选中多于一个站点可选元素</span><span class="err">。</span>

<span class="err">53</span><span class="nc">.Open</span> <span class="nt">打开</span><span class="err">。</span>

<span class="err">54</span><span class="nc">.Outdent</span> <span class="nt">减少选中区所在格式化块的缩进</span><span class="err">。</span>

<span class="err">55</span><span class="nc">.OverWrite</span> <span class="nt">切换文本状态的插入和覆盖</span><span class="err">。</span>

<span class="err">56</span><span class="nc">.Paste</span> <span class="nt">用剪贴板内容覆盖当前选中区</span><span class="err">。</span>

<span class="err">57</span><span class="nc">.PlayImage</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">58</span><span class="nc">.Print</span> <span class="nt">打开打印对话框以便用户可以打印当前页</span><span class="err">。</span>

<span class="err">59</span><span class="nc">.Redo</span> <span class="nt">重做</span><span class="err">。</span>

<span class="err">60</span><span class="nc">.Refresh</span> <span class="nt">刷新当前文档</span><span class="err">。</span>

<span class="err">61</span><span class="nc">.RemoveFormat</span> <span class="nt">从当前选中区中删除格式化标签</span><span class="err">。</span>

<span class="err">62</span><span class="nc">.RemoveParaFormat</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">63</span><span class="nc">.SaveAs</span> <span class="nt">将当前</span> <span class="nt">Web</span> <span class="nt">页面保存为文件</span><span class="err">。</span>

<span class="err">64</span><span class="nc">.SelectAll</span> <span class="nt">选中整个文档</span><span class="err">。</span>

<span class="err">65</span><span class="nc">.SizeToControl</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">66</span><span class="nc">.SizeToControlHeight</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">67</span><span class="nc">.SizeToControlWidth</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">68</span><span class="nc">.Stop</span> <span class="nt">停止</span><span class="err">。</span>

<span class="err">69</span><span class="nc">.StopImage</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">70</span><span class="nc">.StrikeThrough</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">71</span><span class="nc">.Subscript</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">72</span><span class="nc">.Superscript</span> <span class="nt">目前尚未支持</span><span class="err">。</span>

<span class="err">73</span><span class="nc">.UnBookmark</span> <span class="nt">从当前选中区中删除全部书签</span><span class="err">。</span>

<span class="err">74</span><span class="nc">.Underline</span> <span class="nt">切换当前选中区的下划线显示与否</span><span class="err">。</span>

<span class="err">75</span><span class="nc">.Undo</span> <span class="nt">撤消</span><span class="err">。</span>

<span class="err">76</span><span class="nc">.Unlink</span> <span class="nt">从当前选中区中删除全部超级链接</span><span class="err">。</span>

<span class="err">77</span><span class="nc">.Unselect</span> <span class="nt">清除当前选中区的选中状态</span><span class="err">。</span>
</code></pre></div></div>

<h5 id="2documentquerycommandsupported-浏览器是否支持execcommand的某个命令">（2）document.queryCommandSupported() 浏览器是否支持execCommand的某个命令</h5>

<p><code class="language-plaintext highlighter-rouge">document.queryCommandSupported()</code>方法返回一个布尔值，表示浏览器是否支持<code class="language-plaintext highlighter-rouge">document.execCommand()</code>的某个命令。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">queryCommandSupported</span><span class="p">(</span><span class="dl">'</span><span class="s1">SelectAll</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">浏览器支持选中可编辑区域的所有内容</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="3documentquerycommandenabled-当前是否可用execcommand的某个命令">（3）document.queryCommandEnabled() 当前是否可用execCommand的某个命令</h5>

<p><code class="language-plaintext highlighter-rouge">document.queryCommandEnabled()</code>方法返回一个布尔值，表示当前是否可用<code class="language-plaintext highlighter-rouge">document.execCommand()</code>的某个命令。比如，<code class="language-plaintext highlighter-rouge">bold</code>（加粗）命令只有存在文本选中时才可用，如果没有选中文本，就不可用。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;input type="button" value="Copy" onclick="doCopy()"&gt;</span>

<span class="kd">function</span> <span class="nx">doCopy</span><span class="p">(){</span>
  <span class="c1">// 浏览器是否支持 copy 命令（选中内容复制到剪贴板）</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">queryCommandSupported</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="nx">copyText</span><span class="p">(</span><span class="dl">'</span><span class="s1">你好</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">浏览器不支持</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">copyText</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">input</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">textarea</span><span class="dl">'</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">text</span><span class="p">;</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">focus</span><span class="p">();</span>
  <span class="nx">input</span><span class="p">.</span><span class="nx">select</span><span class="p">();</span>

  <span class="c1">// 当前是否有选中文字</span>
  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">queryCommandEnabled</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">success</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">input</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Copy Ok</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">queryCommandEnabled is false</span><span class="dl">'</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，先判断浏览器是否支持<code class="language-plaintext highlighter-rouge">copy</code>命令（允许可编辑区域的选中内容，复制到剪贴板），如果支持，就新建一个临时文本框，里面写入内容“你好”，并将其选中。然后，判断是否选中成功，如果成功，就将“你好”复制到剪贴板，再删除那个临时文本框。</p>

<h4 id="321-documentgetselection">3.21 document.getSelection()</h4>

<p>这个方法指向<code class="language-plaintext highlighter-rouge">window.getSelection()</code>，参见<code class="language-plaintext highlighter-rouge">window</code>对象一节的介绍。</p>

<h2 id="六element节点">六、Element节点</h2>

<p><strong><code class="language-plaintext highlighter-rouge">Element</code>节点对象对应网页的 HTML 元素。每一个 HTML 元素，在 DOM 树上都会转化成一个<code class="language-plaintext highlighter-rouge">Element</code>节点对象（以下简称元素节点）。</strong></p>

<p>元素节点的<code class="language-plaintext highlighter-rouge">nodeType</code>属性都是<code class="language-plaintext highlighter-rouge">1</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "P"</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">nodeType</span> <span class="c1">// 1  节点类型 1代表元素节点</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Element</code>对象继承了<code class="language-plaintext highlighter-rouge">Node</code>接口，因此<strong><code class="language-plaintext highlighter-rouge">Node</code>的属性和方法在<code class="language-plaintext highlighter-rouge">Element</code>对象都存在</strong>。此外，<strong>不同的 HTML 元素对应的元素节点是不一样的，浏览器使用不同的构造函数，生成不同的元素节点</strong>，比如<code class="language-plaintext highlighter-rouge">  &lt;a&gt;  </code>元素的节点对象由<code class="language-plaintext highlighter-rouge">HTMLAnchorElement</code>构造函数生成，<code class="language-plaintext highlighter-rouge"> &lt;button&gt; </code>元素的节点对象由<code class="language-plaintext highlighter-rouge">HTMLButtonElement</code>构造函数生成。因此，元素节点不是一种对象，而是一组对象，这些对象除了继承<code class="language-plaintext highlighter-rouge">Element</code>的属性和方法，还有各自构造函数的属性和方法。</p>

<p><strong>元素节点拥有 各自构造函数 的属性和方法，继承<code class="language-plaintext highlighter-rouge">Element</code>的属性和方法，同时继承<code class="language-plaintext highlighter-rouge">Node</code>的属性和方法。</strong></p>

<h3 id="1实例属性">1、实例属性</h3>

<h4 id="11-元素特性的相关属性">1.1 元素特性的相关属性</h4>

<h5 id="1elementid-返回元素id属性可读写">（1）Element.id 返回元素ID属性，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.id</code>属性<strong>返回指定元素的<code class="language-plaintext highlighter-rouge">id</code>属性，该属性可读写。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为 &lt;p id="foo"&gt;</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">id</span> <span class="c1">// "foo"</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">id</code>属性的值是<strong>大小写敏感</strong>，即浏览器能正确识别<code class="language-plaintext highlighter-rouge">  &lt;p id="foo"&gt;  </code>和<code class="language-plaintext highlighter-rouge">  &lt;p id="FOO"&gt;  </code>这两个元素的<code class="language-plaintext highlighter-rouge">id</code>属性，但是最好不要这样命名。</p>

<h5 id="2elementtagname-返回元素的大写标签">（2）Element.tagName 返回元素的大写标签</h5>

<p><code class="language-plaintext highlighter-rouge">Element.tagName</code>属性<strong>返回指定元素的大写标签名，与<code class="language-plaintext highlighter-rouge">nodeName</code>属性的值相等。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML代码为</span>
<span class="c1">// &lt;span id="myspan"&gt;Hello&lt;/span&gt;</span>
<span class="kd">var</span> <span class="nx">span</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myspan</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">span</span><span class="p">.</span><span class="nx">id</span> <span class="c1">// "myspan"</span>
<span class="nx">span</span><span class="p">.</span><span class="nx">tagName</span> <span class="c1">// "SPAN"</span>
</code></pre></div></div>

<h5 id="3elementdir-元素的文字方向可读写ltrrtl">（3）Element.dir 元素的文字方向，可读写（ltr、rtl）</h5>

<p><code class="language-plaintext highlighter-rouge">Element.dir</code>属性<strong>用于读写当前元素的文字方向</strong>，可能是从左到右（<code class="language-plaintext highlighter-rouge">"ltr"</code>），也可能是从右到左（<code class="language-plaintext highlighter-rouge">"rtl"</code>）。</p>

<h5 id="4elementaccesskey-分配给当前元素的快捷键可读写">（4）Element.accessKey 分配给当前元素的快捷键，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.accessKey</code>属性<strong>用于读写分配给当前元素的快捷键</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;button accesskey="h" id="btn"&gt;点击&lt;/button&gt;</span>
<span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">btn</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">btn</span><span class="p">.</span><span class="nx">accessKey</span> <span class="c1">// "h"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">btn</code>元素的快捷键是<code class="language-plaintext highlighter-rouge">h</code>，按下<code class="language-plaintext highlighter-rouge">Alt + h</code>就能将焦点转移到它上面。</p>

<h5 id="5elementdraggable-当前元素是否可拖动布尔值可读写">（5）Element.draggable 当前元素是否可拖动，布尔值，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.draggable</code>属性<strong>返回一个布尔值，表示当前元素是否可拖动。该属性可读写。</strong></p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;p</span> <span class="na">draggable=</span><span class="s">"true"</span> <span class="na">ondragstart=</span><span class="s">"drag(this)"</span><span class="nt">&gt;</span>这是一段可移动的段落。<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;script&gt;</span>
    <span class="kd">function</span> <span class="nx">drag</span><span class="p">(</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">draggable</span><span class="p">)</span> <span class="c1">// true</span>
    <span class="p">}</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h5 id="6elementlang-返回当前元素的语言设置可读写">（6）Element.lang 返回当前元素的语言设置，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.lang</code>属性<strong>返回当前元素的语言设置。该属性可读写。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;html lang="en"&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">lang</span> <span class="c1">// "en"</span>
</code></pre></div></div>

<h5 id="7elementtabindex-当前元素在-tab-键遍历时的顺序整数可读写">（7）Element.tabIndex 当前元素在 Tab 键遍历时的顺序，整数，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.tabIndex</code>属性<strong>返回一个整数，表示当前元素在 Tab 键遍历时的顺序。该属性可读写。</strong></p>

<p><code class="language-plaintext highlighter-rouge">tabIndex</code>属性值<strong>如果是负值（通常是<code class="language-plaintext highlighter-rouge">-1</code>），则 Tab 键不会遍历到该元素</strong>。如果是正整数，则按照顺序，从小到大遍历。如果两个元素的<code class="language-plaintext highlighter-rouge">tabIndex</code>属性的正整数值相同，则按照出现的顺序遍历。遍历完所有<code class="language-plaintext highlighter-rouge">tabIndex</code>为正整数的元素以后，再遍历所有<code class="language-plaintext highlighter-rouge">tabIndex</code>等于<code class="language-plaintext highlighter-rouge">0</code>、或者属性值是非法值、或者没有<code class="language-plaintext highlighter-rouge">tabIndex</code>属性的元素，顺序为它们在网页中出现的顺序。</p>

<h5 id="8elementtitle-当前元素的-html-属性title可读写">（8）Element.title 当前元素的 HTML 属性<code class="language-plaintext highlighter-rouge">title</code>，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.title</code>属性<strong>用来读写当前元素的 HTML 属性<code class="language-plaintext highlighter-rouge">title</code>。该属性通常用来指定，鼠标悬浮时弹出的文字提示框。</strong></p>

<h4 id="12-元素状态的相关属性">1.2 元素状态的相关属性</h4>

<h5 id="1elementhidden-当前元素的hidden属性控制是否可见布尔值可读写">（1）Element.hidden 当前元素的hidden属性，控制是否可见，布尔值，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">Element.hidden</code>属性<strong>返回一个布尔值，表示当前元素的<code class="language-plaintext highlighter-rouge">hidden</code>属性，用来控制当前元素是否可见。该属性可读写。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">btn</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">mydiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">btn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="nx">mydiv</span><span class="p">.</span><span class="nx">hidden</span> <span class="o">=</span> <span class="o">!</span><span class="nx">mydiv</span><span class="p">.</span><span class="nx">hidden</span><span class="p">;</span>
<span class="p">},</span> <span class="kc">false</span><span class="p">);</span>
</code></pre></div></div>

<p><strong>注意，该属性与 CSS 设置是互相独立的</strong>。CSS 对这个元素可见性的设置，<code class="language-plaintext highlighter-rouge">Element.hidden</code>并不能反映出来。也就是说，这个属性并不能用来判断当前元素的实际可见性。</p>

<p><strong>CSS 的设置高于<code class="language-plaintext highlighter-rouge">Element.hidden</code>。</strong>如果 CSS 指定了该元素不可见（<code class="language-plaintext highlighter-rouge">display: none</code>）或可见（<code class="language-plaintext highlighter-rouge">display: hidden</code>），那么<code class="language-plaintext highlighter-rouge">Element.hidden</code>并不能改变该元素实际的可见性。换言之，<strong>这个属性只在 CSS 没有明确设定当前元素的可见性时才有效。</strong></p>

<h5 id="2elementcontenteditable元素内容的可编辑性字符串可读写">（2）Element.contentEditable元素内容的可编辑性，字符串，可读写，</h5>

<h5 id="elementiscontenteditable-元素内容是否可编辑布尔值只读">Element.isContentEditable 元素内容是否可编辑，布尔值，只读</h5>

<p>HTML 元素可以设置<code class="language-plaintext highlighter-rouge">contentEditable</code>属性，使得元素的内容可以编辑。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">contenteditable</span><span class="nt">&gt;</span>123<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">  &lt;div&gt;  </code>元素有<code class="language-plaintext highlighter-rouge">contenteditable</code>属性，因此用户可以在网页上编辑这个区块的内容。</p>

<p><code class="language-plaintext highlighter-rouge">Element.contentEditable</code>属性返回一个字符串，表示是否设置了<code class="language-plaintext highlighter-rouge">contenteditable</code>属性，有三种可能的值。该属性可写。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">"true"</code>：元素内容可编辑</li>
  <li><code class="language-plaintext highlighter-rouge">"false"</code>：元素内容不可编辑</li>
  <li><code class="language-plaintext highlighter-rouge">"inherit"</code>：元素是否可编辑，继承了父元素的设置</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">Element.isContentEditable</code>属性返回一个布尔值，同样表示是否设置了<code class="language-plaintext highlighter-rouge">contenteditable</code>属性。该属性只读。</p>

<h4 id="13-elementattributes-类数组成员是元素的所有html属性节点">1.3 Element.attributes 类数组，成员是元素的所有HTML属性节点</h4>

<p><code class="language-plaintext highlighter-rouge">Element.attributes</code>属性<strong>返回一个类似数组的对象，成员是当前元素节点的所有属性节点</strong>，详见《属性的操作》一章。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">-&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码遍历<code class="language-plaintext highlighter-rouge">p</code>元素的所有属性。</p>

<h4 id="14-elementclassname-元素的classelementclasslist-类数组成员是各class有自身方法">1.4 Element.className 元素的class，Element.classList 类数组，成员是各class，有自身方法</h4>

<p><code class="language-plaintext highlighter-rouge">className</code>属性<strong>用来读写当前元素节点的<code class="language-plaintext highlighter-rouge">class</code>属性。</strong>它的值是一个字符串，每个<code class="language-plaintext highlighter-rouge">class</code>之间用空格分割。</p>

<p><code class="language-plaintext highlighter-rouge">classList</code>属性<strong>返回一个类似数组的对象，当前元素节点的每个<code class="language-plaintext highlighter-rouge">class</code>就是这个对象的一个成员。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码 &lt;div class="one two three" id="myDiv"&gt;&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">className</span>
<span class="c1">// "one two three"</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span>
<span class="c1">// {</span>
<span class="c1">//   0: "one"</span>
<span class="c1">//   1: "two"</span>
<span class="c1">//   2: "three"</span>
<span class="c1">//   length: 3</span>
<span class="c1">// }</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">className</code>属性返回一个空格分隔的字符串，而<code class="language-plaintext highlighter-rouge">classList</code>属性指向一个类似数组的对象，该对象的<code class="language-plaintext highlighter-rouge">length</code>属性（只读）返回当前元素的<code class="language-plaintext highlighter-rouge">class</code>数量。</p>

<h6 id="classlist对象有下列方法"><code class="language-plaintext highlighter-rouge">classList</code>对象有下列方法。</h6>

<ul>
  <li><strong><code class="language-plaintext highlighter-rouge">add()</code>：增加一个 class。</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">remove()</code>：移除一个 class。</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">contains()</code>：检查当前元素是否包含某个 class。</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">toggle()</code>：将某个 class 移入或移出当前元素。</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">item()</code>：返回指定索引位置的 class。</strong></li>
  <li><strong><code class="language-plaintext highlighter-rouge">toString()</code>：将 class 的列表转为字符串。</strong></li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">myCssClass</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">myCssClass</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="dl">'</span><span class="s1">myCssClass</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 如果 myCssClass 不存在就加入，否则移除</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="dl">'</span><span class="s1">myCssClass</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 返回 true 或者 false</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="c1">// 返回第一个 Class</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toString</span><span class="p">();</span>
</code></pre></div></div>

<p>下面比较一下，<code class="language-plaintext highlighter-rouge">className</code>和<code class="language-plaintext highlighter-rouge">classList</code>在添加和删除某个 class 时的写法。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 添加class</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">className</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">bold</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">bold</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 删除class</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">bold</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="nx">foo</span><span class="p">.</span><span class="nx">className</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^bold$/</span><span class="p">,</span> <span class="dl">''</span><span class="p">);</span>
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">toggle</code>方法可以接受一个布尔值，作为第二个参数。</strong>如果为<code class="language-plaintext highlighter-rouge">true</code>，则添加该属性；如果为<code class="language-plaintext highlighter-rouge">false</code>，则去除该属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">toggle</span><span class="p">(</span><span class="dl">'</span><span class="s1">abc</span><span class="dl">'</span><span class="p">,</span> <span class="nx">boolValue</span><span class="p">);</span>

<span class="c1">// 等同于</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">boolValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">abc</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">el</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">abc</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="15-elementdataset-返回一个对象读写元素的data-属性">1.5 Element.dataset 返回一个对象，读写元素的data-属性</h4>

<p>网页元素可以自定义<code class="language-plaintext highlighter-rouge">data-</code>属性，用来添加数据。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">data</span><span class="o">-</span><span class="nx">timestamp</span><span class="o">=</span><span class="dl">"</span><span class="s2">1522907809292</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">  &lt;div&gt;  </code>元素有一个自定义的<code class="language-plaintext highlighter-rouge">data-timestamp</code>属性，用来为该元素添加一个时间戳。</p>

<p><code class="language-plaintext highlighter-rouge">Element.dataset</code>属性<strong>返回一个对象，可以从这个对象读写<code class="language-plaintext highlighter-rouge">data-</code>属性。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// &lt;article</span>
<span class="c1">//   id="foo"</span>
<span class="c1">//   data-columns="3"</span>
<span class="c1">//   data-index-number="12314"</span>
<span class="c1">//   data-parent="cars"&gt;</span>
<span class="c1">//   ...</span>
<span class="c1">// &lt;/article&gt;</span>
<span class="kd">var</span> <span class="nx">article</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">article</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">columns</span> <span class="c1">// "3"</span>
<span class="nx">article</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">indexNumber</span> <span class="c1">// "12314"</span>
<span class="nx">article</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">parent</span> <span class="c1">// "cars"</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">dataset</code>上面的各个属性返回都是字符串。</p>

<p>HTML 代码中，<code class="language-plaintext highlighter-rouge">data-</code>属性的属性名，只能包含英文字母、数字、连词线（<code class="language-plaintext highlighter-rouge">-</code>）、点（<code class="language-plaintext highlighter-rouge">.</code>）、冒号（<code class="language-plaintext highlighter-rouge">:</code>）和下划线（<code class="language-plaintext highlighter-rouge">_</code>）。它们转成 JavaScript 对应的<code class="language-plaintext highlighter-rouge">dataset</code>属性名，<strong>规则如下</strong>。</p>

<ul>
  <li><strong>开头的<code class="language-plaintext highlighter-rouge">data-</code>会省略。</strong></li>
  <li><strong>如果连词线后面跟了一个英文字母，那么连词线会取消，该字母变成大写。</strong></li>
  <li><strong>其他字符不变。</strong></li>
</ul>

<p>因此，<code class="language-plaintext highlighter-rouge">data-abc-def</code>对应<code class="language-plaintext highlighter-rouge">dataset.abcDef</code>，<code class="language-plaintext highlighter-rouge">data-abc-1</code>对应<code class="language-plaintext highlighter-rouge">dataset["abc-1"]</code>。</p>

<p>除了使用<code class="language-plaintext highlighter-rouge">dataset</code>读写<code class="language-plaintext highlighter-rouge">data-</code>属性，也<strong>可以使用<code class="language-plaintext highlighter-rouge">Element.getAttribute()</code>和<code class="language-plaintext highlighter-rouge">Element.setAttribute()</code>，通过完整的属性名读写这些属性。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mydiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">mydiv</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">mydiv</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-foo</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// "bar"</span>
</code></pre></div></div>

<h4 id="16-elementinnerhtml-返回一个字符串是元素包含的所有-html-代码可读写">1.6 Element.innerHTML 返回一个字符串，是元素包含的所有 HTML 代码，可读写</h4>

<p><code class="language-plaintext highlighter-rouge">Element.innerHTML</code>属性<strong>返回一个字符串，等同于该元素包含的所有 HTML 代码</strong>。该属性<strong>可读写</strong>，常用来设置某个节点的内容。它能改写所有元素节点的内容，包括<code class="language-plaintext highlighter-rouge"> &lt;HTML&gt; </code>和<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>元素。</p>

<p>如果将<code class="language-plaintext highlighter-rouge">innerHTML</code>属性设为空，等于删除所有它包含的所有节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
</code></pre></div></div>

<p>上面代码等于将<code class="language-plaintext highlighter-rouge">el</code>节点变成了一个空节点，<code class="language-plaintext highlighter-rouge">el</code>原来包含的节点被全部删除。</p>

<p>注意，读取属性值的时候，如果文本节点包含<code class="language-plaintext highlighter-rouge">&amp;</code>、小于号（<code class="language-plaintext highlighter-rouge">&lt;</code>）和大于号（<code class="language-plaintext highlighter-rouge">&gt;</code>），<code class="language-plaintext highlighter-rouge">innerHTML</code>属性会将它们转为实体形式 <code class="language-plaintext highlighter-rouge">&amp; amp;</code>、<code class="language-plaintext highlighter-rouge">&amp; lt;</code>、<code class="language-plaintext highlighter-rouge">&amp; gt;</code> 。如果想得到原文，建议使用<code class="language-plaintext highlighter-rouge">element.textContent</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML代码如下 &lt;p id="para"&gt; 5 &gt; 3 &lt; 6 &amp;&lt;/p&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">para</span><span class="dl">'</span><span class="p">).</span><span class="nx">innerHTML</span>
<span class="c1">// 5 &amp;gt; 3 &amp;lt; &amp;amp;</span>
</code></pre></div></div>

<p>写入的时候，如果插入的<strong>文本包含 HTML 标签，会被解析成为节点对象插入 DOM</strong>。注意，如果文本之中含有<code class="language-plaintext highlighter-rouge">  &lt;script&gt;  </code>标签，虽然可以生成<code class="language-plaintext highlighter-rouge">script</code>节点，但是插入的代码不会执行。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;script&gt;alert('haha')&lt;/script&gt;</span><span class="dl">"</span><span class="p">;</span> <span class="c1">// 插入包含js代码字符串，插入后js不会执行</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</code></pre></div></div>

<p>上面代码将脚本插入内容，脚本并不会执行。但是，<code class="language-plaintext highlighter-rouge">innerHTML</code>还是有安全风险的。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">name</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">&lt;img src=x onerror=alert(1)&gt;</span><span class="dl">"</span><span class="p">;</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">alert</code>方法是会执行的。<strong>因此为了安全考虑，如果插入的是文本，最好用<code class="language-plaintext highlighter-rouge">textContent</code>属性代替<code class="language-plaintext highlighter-rouge">innerHTML</code>。</strong></p>

<h4 id="17-elementouterhtml-返回一个字符串包含元素本身和所有子元素的html代码可读写">1.7 Element.outerHTML 返回一个字符串，包含元素本身和所有子元素的HTML代码，可读写</h4>

<p><code class="language-plaintext highlighter-rouge">Element.outerHTML</code>属性<strong>返回一个字符串，表示当前元素节点的所有 HTML 代码，包括该元素本身和所有子元素。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="d"&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">outerHTML</span>
<span class="c1">// '&lt;div id="d"&gt;&lt;p&gt;Hello&lt;/p&gt;&lt;/div&gt;'</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">outerHTML</code>属性是<strong>可读写</strong>的，<strong>对它进行赋值，等于替换掉当前元素。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="container"&gt;&lt;div id="d"&gt;Hello&lt;/div&gt;&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">container</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">container</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">d</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "DIV"</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "DIV"</span>

<span class="nx">d</span><span class="p">.</span><span class="nx">outerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;p&gt;Hello&lt;/p&gt;</span><span class="dl">'</span><span class="p">;</span> <span class="c1">//div替换成p标签</span>
<span class="nx">container</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "P"</span>
<span class="nx">d</span><span class="p">.</span><span class="nx">nodeName</span> <span class="c1">// "DIV"  但是变量b依旧指向原来的div元素，还存在于内存中</span>
</code></pre></div></div>

<p>上面代码中，变量<code class="language-plaintext highlighter-rouge">d</code>代表子节点，它的<code class="language-plaintext highlighter-rouge">outerHTML</code>属性重新赋值以后，内层的<code class="language-plaintext highlighter-rouge">div</code>元素就不存在了，被<code class="language-plaintext highlighter-rouge">p</code>元素替换了。但是，<strong>变量<code class="language-plaintext highlighter-rouge">d</code>依然指向原来的<code class="language-plaintext highlighter-rouge">div</code>元素，这表示被替换的<code class="language-plaintext highlighter-rouge">DIV</code>元素还存在于内存中。</strong></p>

<p>注意，如果一个<strong>节点没有父节点，设置<code class="language-plaintext highlighter-rouge">outerHTML</code>属性会报错</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">outerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">&lt;p&gt;test&lt;/p&gt;</span><span class="dl">'</span><span class="p">;</span>
<span class="c1">// DOMException: This element has no parent node.</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">div</code>元素没有父节点，设置<code class="language-plaintext highlighter-rouge">outerHTML</code>属性会报错。</p>

<h4 id="18-elementclientheight-元素高度elementclientwidth元素宽度">1.8 Element.clientHeight 元素高度，Element.clientWidth元素宽度</h4>

<p><code class="language-plaintext highlighter-rouge">Element.clientHeight</code>属性返回一个整数值，表示<strong>元素节点的 CSS 高度</strong>（单位像素），<strong>只对块级元素生效，对于行内元素返回<code class="language-plaintext highlighter-rouge">0</code></strong>。如果块级元素没有设置 CSS 高度，则返回实际高度。</p>

<p>除了元素本身的高度，它还<strong>包括<code class="language-plaintext highlighter-rouge">padding</code>部分</strong>，但是不包括<code class="language-plaintext highlighter-rouge">border</code>、<code class="language-plaintext highlighter-rouge">margin</code>。如果有水平滚动条，还要减去水平滚动条的高度。注意，这个值始终是整数，如果是小数会被四舍五入。</p>

<p><code class="language-plaintext highlighter-rouge">Element.clientWidth</code>属性返回<strong>元素节点的 CSS 宽度，同样只对块级元素有效</strong>，也是只包括元素本身的宽度和<code class="language-plaintext highlighter-rouge">padding</code>，如果有垂直滚动条，还要减去垂直滚动条的宽度。</p>

<p><code class="language-plaintext highlighter-rouge">document.documentElement</code>的<code class="language-plaintext highlighter-rouge">clientHeight</code>属性，返回当前视口的高度（即浏览器窗口的高度），等同于<code class="language-plaintext highlighter-rouge">window.innerHeight</code>属性减去水平滚动条的高度（如果有的话）。<code class="language-plaintext highlighter-rouge">document.body</code>的高度则是网页的实际高度。一般来说，<code class="language-plaintext highlighter-rouge">document.body.clientHeight</code>大于<code class="language-plaintext highlighter-rouge">document.documentElement.clientHeight</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 视口高度  不包括不可见的部分</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">clientHeight</span>

<span class="c1">// 网页总高度</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">clientHeight</span>
</code></pre></div></div>

<h4 id="19-elementclientleft-左边框宽度elementclienttop上边框宽">1.9 Element.clientLeft 左边框宽度，Element.clientTop上边框宽</h4>

<p><code class="language-plaintext highlighter-rouge">Element.clientLeft</code>属性等于元素节点<strong>左边框（left border）的宽度</strong>（单位像素），不包括左侧的<code class="language-plaintext highlighter-rouge">padding</code>和<code class="language-plaintext highlighter-rouge">margin</code>。如果没有设置左边框，或者是行内元素（<code class="language-plaintext highlighter-rouge">display: inline</code>），该属性返回<code class="language-plaintext highlighter-rouge">0</code>。该属性总是返回整数值，如果是小数，会四舍五入。</p>

<p><code class="language-plaintext highlighter-rouge">Element.clientTop</code>属性等于网页元素<strong>顶部边框的宽度</strong>（单位像素），其他特点都与<code class="language-plaintext highlighter-rouge">clientLeft</code>相同。</p>

<h4 id="110-elementscrollheight-元素总高度elementscrollwidth-元素总宽度">1.10 Element.scrollHeight 元素总高度，Element.scrollWidth 元素总宽度</h4>

<p><code class="language-plaintext highlighter-rouge">Element.scrollHeight</code>属性返回一个整数值（小数会四舍五入），表示当前<strong>元素的总高度</strong>（单位像素），<strong>包括溢出容器、当前不可见的部分。它包括<code class="language-plaintext highlighter-rouge">padding</code></strong>，但是不包括<code class="language-plaintext highlighter-rouge">border</code>、<code class="language-plaintext highlighter-rouge">margin</code>以及水平滚动条的高度（如果有水平滚动条的话），还包括伪元素（<code class="language-plaintext highlighter-rouge">::before</code>或<code class="language-plaintext highlighter-rouge">::after</code>）的高度。</p>

<p><code class="language-plaintext highlighter-rouge">Element.scrollWidth</code>属性表示当前<strong>元素的总宽度</strong>（单位像素），其他地方都与<code class="language-plaintext highlighter-rouge">scrollHeight</code>属性类似。这两个属性只读。</p>

<p><strong>整张网页的总高度</strong>可以从<code class="language-plaintext highlighter-rouge">document.documentElement</code>或<code class="language-plaintext highlighter-rouge">document.body</code>上读取。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 返回网页的总高度</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollHeight</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span>
</code></pre></div></div>

<p>注意，如果元素节点的内容出现溢出，即使溢出的内容是隐藏的，<code class="language-plaintext highlighter-rouge">scrollHeight</code>属性仍然返回元素的总高度。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="myDiv" style="height: 200px; overflow: hidden;"&gt;...&lt;div&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">scrollHeight</span> <span class="c1">// 356</span>
</code></pre></div></div>

<p>上面代码中，即使<code class="language-plaintext highlighter-rouge">myDiv</code>元素的 CSS 高度只有200像素，且溢出部分不可见，但是<code class="language-plaintext highlighter-rouge">scrollHeight</code>仍然会返回该元素的原始高度。</p>

<h4 id="111-elementscrollleft-元素水平滚动条右侧滚动的像素量elementscrolltop-元素垂直滚动条向下滚动的像素量">1.11 Element.scrollLeft 元素水平滚动条右侧滚动的像素量，Element.scrollTop 元素垂直滚动条向下滚动的像素量</h4>

<p><code class="language-plaintext highlighter-rouge">Element.scrollLeft</code>属性表示<strong>当前元素的水平滚动条向右侧滚动的像素数量</strong>，<code class="language-plaintext highlighter-rouge">Element.scrollTop</code>属性表示<strong>当前元素的垂直滚动条向下滚动的像素数量</strong>。对于那些没有滚动条的网页元素，这两个属性总是等于0。</p>

<p>如果要查看整张网页的水平的和垂直的滚动距离，要从<code class="language-plaintext highlighter-rouge">document.documentElement</code>元素上读取。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollLeft</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">scrollTop</span>
</code></pre></div></div>

<p>这两个属性都<strong>可读写</strong>，设置该属性的值，会导致浏览器将当前元素自动滚动到相应的位置。</p>

<h4 id="112-elementoffsetparent-返回最靠近当前元素的并且-css-的position属性不等于static的上层元素">1.12 Element.offsetParent 返回最靠近当前元素的、并且 CSS 的<code class="language-plaintext highlighter-rouge">position</code>属性不等于<code class="language-plaintext highlighter-rouge">static</code>的上层元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.offsetParent</code>属性<strong>返回最靠近当前元素的、并且 CSS 的<code class="language-plaintext highlighter-rouge">position</code>属性不等于<code class="language-plaintext highlighter-rouge">static</code>的上层元素</strong>。</p>

<blockquote>
  <p>position:static; 即默认没有定位的样式。</p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="dl">"</span><span class="s2">position: absolute;</span><span class="dl">"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">span</code>元素的<code class="language-plaintext highlighter-rouge">offsetParent</code>属性就是<code class="language-plaintext highlighter-rouge">div</code>元素。</p>

<p><strong>该属性主要用于确定子元素位置偏移的计算基准</strong>，<code class="language-plaintext highlighter-rouge">Element.offsetTop</code>和<code class="language-plaintext highlighter-rouge">Element.offsetLeft</code>就是<code class="language-plaintext highlighter-rouge">offsetParent</code>元素计算的。</p>

<p>如果该元素是不可见的（<code class="language-plaintext highlighter-rouge">display</code>属性为<code class="language-plaintext highlighter-rouge">none</code>），或者位置是固定的（<code class="language-plaintext highlighter-rouge">position</code>属性为<code class="language-plaintext highlighter-rouge">fixed</code>），则<code class="language-plaintext highlighter-rouge">offsetParent</code>属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="dl">"</span><span class="s2">position: absolute;</span><span class="dl">"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">span</span> <span class="nx">style</span><span class="o">=</span><span class="dl">"</span><span class="s2">display: none;</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Hello</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span>  <span class="o">&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/div</span><span class="err">&gt;
</span></code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">span</code>元素的<code class="language-plaintext highlighter-rouge">offsetParent</code>属性是<code class="language-plaintext highlighter-rouge">null</code>。</p>

<p>如果某个元素的所有上层节点的<code class="language-plaintext highlighter-rouge">position</code>属性都是<code class="language-plaintext highlighter-rouge">static</code>，则<code class="language-plaintext highlighter-rouge">Element.offsetParent</code>属性指向<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>元素。</p>

<h4 id="113-elementoffsetheight-元素的css垂直高度elementoffsetwidth元素的css水平宽度">1.13 Element.offsetHeight 元素的CSS垂直高度，Element.offsetWidth元素的CSS水平宽度</h4>

<p><code class="language-plaintext highlighter-rouge">Element.offsetHeight</code>属性返回一个整数，表示<strong>元素的 CSS 垂直高度</strong>（单位像素），<strong>包括元素本身的高度、padding 和 border，以及水平滚动条的高度（</strong>如果存在滚动条）。</p>

<p><code class="language-plaintext highlighter-rouge">Element.offsetWidth</code>属性表示<strong>元素的 CSS 水平宽度</strong>（单位像素），其他都与<code class="language-plaintext highlighter-rouge">Element.offsetHeight</code>一致。</p>

<p>这两个属性都是<strong>只读属性</strong>，只比<code class="language-plaintext highlighter-rouge">Element.clientHeight</code>和<code class="language-plaintext highlighter-rouge">Element.clientWidth</code>多了边框的高度或宽度。如果元素的 CSS 设为不可见（比如<code class="language-plaintext highlighter-rouge">display: none;</code>），则返回<code class="language-plaintext highlighter-rouge">0</code>。</p>

<h4 id="114-elementoffsetleft-水平位移elementoffsettop-垂直位移">1.14 Element.offsetLeft 水平位移，Element.offsetTop 垂直位移</h4>

<p><code class="language-plaintext highlighter-rouge">Element.offsetLeft</code>返回当前<strong>元素左上角相对于<code class="language-plaintext highlighter-rouge">Element.offsetParent</code>节点的水平位移</strong>，<code class="language-plaintext highlighter-rouge">Element.offsetTop</code>返回<strong>垂直位移</strong>，单位为像素。通常，这两个值是指相对于父节点的位移。</p>

<p>下面的代码可以算出元素左上角相对于整张网页的坐标。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getElementPosition</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span>  <span class="p">{</span>
    <span class="nx">x</span> <span class="o">+=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">offsetLeft</span><span class="p">;</span>
    <span class="nx">y</span> <span class="o">+=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
    <span class="nx">e</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">offsetParent</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">{</span><span class="na">x</span><span class="p">:</span> <span class="nx">x</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="nx">y</span><span class="p">};</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="115-elementstyle-返回cssstyledeclaration实例用于操作css">1.15 Element.style 返回CSSStyleDeclaration实例，用于操作CSS</h4>

<p>每个元素节点都有<code class="language-plaintext highlighter-rouge">style</code>用来读写该<strong>元素的行内样式信息</strong>，具体介绍参见《CSS 操作》一章。</p>

<h4 id="116-elementchildren-类数组所有子元素elementchildelementcount-子元素个数">1.16 Element.children 类数组，所有子元素，Element.childElementCount 子元素个数</h4>

<p><code class="language-plaintext highlighter-rouge">Element.children</code>属性<strong>返回一个类似数组的对象（<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例），包括当前元素节点的所有子元素</strong>。如果当前元素没有子元素，则返回的对象包含零个成员。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">para</span><span class="p">.</span><span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="nx">para</span><span class="p">.</span><span class="nx">children</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">children</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// ...</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码遍历了<code class="language-plaintext highlighter-rouge">para</code>元素的所有子元素。</p>

<p>这个属性与<code class="language-plaintext highlighter-rouge">Node.childNodes</code>属性的区别是，它只包括元素类型的子节点，不包括其他类型的子节点。</p>

<p><code class="language-plaintext highlighter-rouge">Element.childElementCount</code>属性返回当前元素节点包含的<strong>子元素节点的个数</strong>，与<code class="language-plaintext highlighter-rouge">Element.children.length</code>的值相同。</p>

<h4 id="117-elementfirstelementchild-首个子元素elementlastelementchild-最后一个子元素">1.17 Element.firstElementChild 首个子元素，Element.lastElementChild 最后一个子元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.firstElementChild</code>属性返回当前元素的第一个元素子节点，<code class="language-plaintext highlighter-rouge">Element.lastElementChild</code>返回最后一个元素子节点。</p>

<p>如果没有元素子节点，这两个属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h4 id="118-elementnextelementsibling后一个兄弟元素节点elementpreviouselementsibling上一个兄弟元素节点">1.18 Element.nextElementSibling后一个兄弟元素节点，Element.previousElementSibling上一个兄弟元素节点</h4>

<p><code class="language-plaintext highlighter-rouge">Element.nextElementSibling</code>属性返回当前元素节点的<strong>后一个同级元素节点</strong>，如果没有则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="div-01"&gt;Here is div-01&lt;/div&gt;</span>
<span class="c1">// &lt;div id="div-02"&gt;Here is div-02&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div-01</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">nextElementSibling</span>
<span class="c1">// &lt;div id="div-02"&gt;Here is div-02&lt;/div&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Element.previousElementSibling</code>属性返回当前元素节点的<strong>前一个同级元素节点</strong>，如果没有则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h3 id="2实例方法">2、实例方法</h3>

<h4 id="21-标签属性相关方法">2.1 标签属性相关方法</h4>

<p>元素节点提供六个方法，用来操作属性。</p>

<h5 id="1getattribute读取某个属性的值">（1）<code class="language-plaintext highlighter-rouge">getAttribute()</code>：读取某个属性的值</h5>

<h5 id="2getattributenames返回当前元素的所有属性名">（2）<code class="language-plaintext highlighter-rouge">getAttributeNames()</code>：返回当前元素的所有属性名</h5>

<h5 id="3setattribute写入属性值">（3）<code class="language-plaintext highlighter-rouge">setAttribute()</code>：写入属性值</h5>

<h5 id="4hasattribute某个属性是否存在">（4）<code class="language-plaintext highlighter-rouge">hasAttribute()</code>：某个属性是否存在</h5>

<h5 id="5hasattributes当前元素是否有属性">（5）<code class="language-plaintext highlighter-rouge">hasAttributes()</code>：当前元素是否有属性</h5>

<h5 id="6removeattribute删除属性">（6）<code class="language-plaintext highlighter-rouge">removeAttribute()</code>：删除属性</h5>

<p>这些方法的介绍请看《<strong>属性的操作</strong>》一章。</p>

<h4 id="22-elementqueryselector-返回第一个匹配的子元素">2.2 Element.querySelector() 返回第一个匹配的子元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.querySelector</code>方法接受 <strong>CSS 选择器作为参数，返回父元素的第一个匹配的子元素</strong>。如果没有找到匹配的子元素，就返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">content</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nx">content</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码返回<code class="language-plaintext highlighter-rouge">content</code>节点的第一个<code class="language-plaintext highlighter-rouge">p</code>元素。</p>

<p><code class="language-plaintext highlighter-rouge">Element.querySelector</code>方法<strong>可以接受任何复杂的 CSS 选择器</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">"</span><span class="s2">style[type='text/css'], style:not([type])</span><span class="dl">"</span><span class="p">);</span>
</code></pre></div></div>

<p>注意，这个方法无法选中伪元素。</p>

<p>它可以接受多个选择器，它们之间使用逗号分隔。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">element</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div, p</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码返回<code class="language-plaintext highlighter-rouge">element</code>的第一个<code class="language-plaintext highlighter-rouge">div</code>或<code class="language-plaintext highlighter-rouge">p</code>子元素。</p>

<p>需要<strong>注意</strong>的是，浏览器执行<code class="language-plaintext highlighter-rouge">querySelector</code>方法时，是先在全局范围内搜索给定的 CSS 选择器，然后过滤出哪些属于当前元素的子元素。因此，会有一些违反直觉的结果，下面是一段 HTML 代码。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div&gt;</span>
<span class="nt">&lt;p&gt;</span>111<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;blockquote</span> <span class="na">id=</span><span class="s">"outer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;p&gt;</span>Hello<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"inner"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;p&gt;</span>World<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/blockquote&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>那么，像下面这样查询的话，实际上返回的是第一个<code class="language-plaintext highlighter-rouge">p</code>元素，而不是第二个。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">outer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">outer</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">outer</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div p</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// &lt;p&gt;Hello&lt;/p&gt;</span>
<span class="c1">// 违反自觉的结果，是因为会全局范围搜索到outer外面的div，然后再选出当前元素outer的子元素第一个p</span>

<span class="nx">outer</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">).</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// &lt;p&gt;World&lt;/p&gt; 这样就能拿到里面的p元素</span>
</code></pre></div></div>

<h4 id="23-elementqueryselectorall-返回nodelist实例包含所有子元素">2.3 Element.querySelectorAll() 返回NodeList实例，包含所有子元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.querySelectorAll</code>方法接受 CSS 选择器作为参数，<strong>返回一个<code class="language-plaintext highlighter-rouge">NodeList</code>实例，包含所有匹配的子元素</strong>。</p>

<blockquote>
  <p>返回的NodeList实例是<strong>类数组对象</strong></p>
</blockquote>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#test</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">div.highlighted &gt; p</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>该方法的执行机制与<code class="language-plaintext highlighter-rouge">querySelector</code>方法相同，也是<strong>先在全局范围内查找，再过滤出当前元素的子元素</strong>。因此，选择器实际上针对整个文档的。</p>

<p>它也可以接受多个 CSS 选择器，它们之间使用逗号分隔。如果选择器里面有伪元素的选择器，则总是返回一个空的<code class="language-plaintext highlighter-rouge">NodeList</code>实例。</p>

<h4 id="24-elementgetelementsbyclassname-通过class获取所有子元素">2.4 Element.getElementsByClassName() 通过class获取所有子元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.getElementsByClassName</code>方法返<strong>回一个<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例，成员是当前元素节点的所有具有指定 class 的子元素节点</strong>。该方法与<code class="language-plaintext highlighter-rouge">document.getElementsByClassName</code>方法的用法类似，只是搜索范围不是整个文档，而是当前元素节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">element</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">red test</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>注意，该方法的参数大小写敏感。</p>

<p>由于<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例是一个<strong>活的集合</strong>，<code class="language-plaintext highlighter-rouge">document</code>对象的任何变化会立刻反应到实例，下面的代码不会生效。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="example"&gt;</span>
<span class="c1">//   &lt;p class="foo"&gt;&lt;/p&gt;</span>
<span class="c1">//   &lt;p class="foo"&gt;&lt;/p&gt;</span>
<span class="c1">// &lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">example</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">matches</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 当删除了foo，matches的集合就会立刻改变</span>
  <span class="nx">matches</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="nx">i</span><span class="p">).</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">bar</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// 执行后，HTML 代码如下</span>
<span class="c1">// &lt;div id="example"&gt;</span>
<span class="c1">//   &lt;p&gt;&lt;/p&gt;</span>
<span class="c1">//   &lt;p class="foo bar"&gt;&lt;/p&gt;</span>
<span class="c1">// &lt;/div&gt;</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">matches</code>集合的第一个成员，<strong>一旦被拿掉 class 里面的<code class="language-plaintext highlighter-rouge">foo</code>，就会立刻从<code class="language-plaintext highlighter-rouge">matches</code>里面消失</strong>，导致出现上面的结果。</p>

<h4 id="25-elementgetelementsbytagname-通过标签获取索引子元素">2.5 Element.getElementsByTagName() 通过标签获取索引子元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.getElementsByTagName</code>方法<strong>返回一个<code class="language-plaintext highlighter-rouge">HTMLCollection</code>实例，成员是当前节点的所有匹配指定标签名的子元素节点</strong>。该方法与<code class="language-plaintext highlighter-rouge">document.getElementsByClassName</code>方法的用法类似，只是搜索范围不是整个文档，而是当前元素节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">forecast-table</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">cells</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>注意，该方法的参数是大小写不敏感的。</p>

<h4 id="26-elementclosest-接受css选择器参数返回最靠近的祖先节点">2.6 Element.closest() 接受CSS选择器参数，返回最靠近的祖先节点</h4>

<p><code class="language-plaintext highlighter-rouge">Element.closest</code>方法<strong>接受一个 CSS 选择器作为参数，返回匹配该选择器的、最接近当前节点的一个祖先节点（包括当前节点本身）</strong>。如果没有任何节点匹配 CSS 选择器，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;article&gt;</span>
<span class="c1">//   &lt;div id="div-01"&gt;Here is div-01</span>
<span class="c1">//     &lt;div id="div-02"&gt;Here is div-02</span>
<span class="c1">//       &lt;div id="div-03"&gt;Here is div-03&lt;/div&gt;</span>
<span class="c1">//     &lt;/div&gt;</span>
<span class="c1">//   &lt;/div&gt;</span>
<span class="c1">// &lt;/article&gt;</span>

<span class="kd">var</span> <span class="nx">div03</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div-03</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// div-03 最近的祖先节点</span>
<span class="nx">div03</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="dl">"</span><span class="s2">#div-02</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// div-02</span>

<span class="nx">div03</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="dl">"</span><span class="s2">div</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// div-03 closest包含当前节点本身</span>
<span class="nx">div03</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="dl">"</span><span class="s2">div div</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// div-03</span>
<span class="nx">div03</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="dl">"</span><span class="s2">div&gt;div</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// div-03</span>

<span class="nx">div03</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="dl">"</span><span class="s2">article &gt; div</span><span class="dl">"</span><span class="p">)</span> <span class="c1">//div-01</span>
<span class="nx">div03</span><span class="p">.</span><span class="nx">closest</span><span class="p">(</span><span class="dl">"</span><span class="s2">:not(div)</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// article</span>
</code></pre></div></div>

<p>上面代码中，由于<code class="language-plaintext highlighter-rouge">closest</code>方法将当前节点也考虑在内，所以第二个<code class="language-plaintext highlighter-rouge">closest</code>方法返回<code class="language-plaintext highlighter-rouge">div-03</code>。</p>

<h4 id="27-elementmatches-当前元素是否匹配给定的css选择器">2.7 Element.matches() 当前元素是否匹配给定的css选择器</h4>

<p><code class="language-plaintext highlighter-rouge">Element.matches</code>方法<strong>返回一个布尔值，表示当前元素是否匹配给定的 CSS 选择器。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">matches</span><span class="p">(</span><span class="dl">'</span><span class="s1">.someClass</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Match!</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="28-事件相关方法">2.8 事件相关方法</h4>

<p>以下三个方法与<code class="language-plaintext highlighter-rouge">Element</code>节点的事件相关。这些方法都继承自<code class="language-plaintext highlighter-rouge">EventTarget</code>接口，<strong>详见相关章节</strong>。</p>

<h5 id="1elementaddeventlistener添加事件的回调函数">（1）<code class="language-plaintext highlighter-rouge">Element.addEventListener()</code>：添加事件的回调函数</h5>

<h5 id="2elementremoveeventlistener移除事件监听函数">（2）<code class="language-plaintext highlighter-rouge">Element.removeEventListener()</code>：移除事件监听函数</h5>

<h5 id="3elementdispatchevent触发事件">（3）<code class="language-plaintext highlighter-rouge">Element.dispatchEvent()</code>：触发事件</h5>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">element</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">event</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Event</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">element</span><span class="p">.</span><span class="nx">dispatchEvent</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</code></pre></div></div>

<h4 id="29-elementscrollintoview--让元素滚动到浏览器可视区">2.9 Element.scrollIntoView()  让元素滚动到浏览器可视区</h4>

<p><code class="language-plaintext highlighter-rouge">Element.scrollIntoView</code>方法<strong>让当前的元素滚动到浏览器窗口的可视区域内</strong> ，类似于设置<code class="language-plaintext highlighter-rouge">window.location.hash</code>的效果。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">scrollIntoView</span><span class="p">();</span> <span class="c1">// 等同于el.scrollIntoView(true)</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">scrollIntoView</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</code></pre></div></div>

<p>该方法可以接受一个布尔值作为参数。如果为<code class="language-plaintext highlighter-rouge">true</code>，表示元素的顶部与当前区域的可见部分的顶部对齐（前提是当前区域可滚动）；如果为<code class="language-plaintext highlighter-rouge">false</code>，表示元素的底部与当前区域的可见部分的尾部对齐（前提是当前区域可滚动）。如果没有提供该参数，默认为<code class="language-plaintext highlighter-rouge">true</code>。</p>

<h4 id="210-elementgetboundingclientrect-返回元素大小位置信息的对象">2.10 Element.getBoundingClientRect() 返回元素大小、位置信息的对象</h4>

<p><code class="language-plaintext highlighter-rouge">Element.getBoundingClientRect</code>方法<strong>返回一个对象，提供当前元素节点的大小、位置等信息，基本上就是 CSS 盒状模型的所有信息</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">getBoundingClientRect</code>方法返回的<code class="language-plaintext highlighter-rouge">rect</code>对象，具有以下属性（全部为<strong>只读</strong>）。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">x</code>：元素左上角相对于视口的横坐标</li>
  <li><code class="language-plaintext highlighter-rouge">y</code>：元素左上角相对于视口的纵坐标</li>
  <li><code class="language-plaintext highlighter-rouge">height</code>：元素高度</li>
  <li><code class="language-plaintext highlighter-rouge">width</code>：元素宽度</li>
  <li><code class="language-plaintext highlighter-rouge">left</code>：元素左上角相对于视口的横坐标，与<code class="language-plaintext highlighter-rouge">x</code>属性相等</li>
  <li><code class="language-plaintext highlighter-rouge">right</code>：元素右边界相对于视口的横坐标（等于<code class="language-plaintext highlighter-rouge">x + width</code>）</li>
  <li><code class="language-plaintext highlighter-rouge">top</code>：元素顶部相对于视口的纵坐标，与<code class="language-plaintext highlighter-rouge">y</code>属性相等</li>
  <li><code class="language-plaintext highlighter-rouge">bottom</code>：元素底部相对于视口的纵坐标（等于<code class="language-plaintext highlighter-rouge">y + height</code>）</li>
</ul>

<p>由于元素<strong>相对于视口（viewport）的位置</strong>，<strong>会随着页面滚动变化</strong>，因此表示位置的四个属性值，都不是固定不变的。如果想得到绝对位置，可以将<code class="language-plaintext highlighter-rouge">left</code>属性加上<code class="language-plaintext highlighter-rouge">window.scrollX</code>，<code class="language-plaintext highlighter-rouge">top</code>属性加上<code class="language-plaintext highlighter-rouge">window.scrollY</code>。</p>

<p>注意，<code class="language-plaintext highlighter-rouge">getBoundingClientRect</code>方法的所有属性，都把边框（<code class="language-plaintext highlighter-rouge">border</code>属性）算作元素的一部分。也就是说，都是从边框外缘的各个点来计算。因此，<strong><code class="language-plaintext highlighter-rouge">width</code>和<code class="language-plaintext highlighter-rouge">height</code>包括了元素本身 + <code class="language-plaintext highlighter-rouge">padding</code> + <code class="language-plaintext highlighter-rouge">border</code>。</strong></p>

<p>另外，上面的这些属性，都是继承自原型的属性，<code class="language-plaintext highlighter-rouge">Object.keys</code>会返回一个空数组，这一点也需要注意。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">rect</span><span class="p">)</span> <span class="c1">// []</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">rect</code>对象没有自身属性，而<code class="language-plaintext highlighter-rouge">Object.keys</code>方法只返回对象自身的属性，所以返回了一个空数组。</p>

<h4 id="211-elementgetclientrects-元素在页面上形成的所有矩形类数组">2.11 Element.getClientRects() 元素在页面上形成的所有矩形，类数组</h4>

<p><code class="language-plaintext highlighter-rouge">Element.getClientRects</code>方法<strong>返回一个类似数组的对象，里面是当前元素在页面上形成的所有矩形</strong>（所以方法名中的<code class="language-plaintext highlighter-rouge">Rect</code>用的是复数）。每个矩形都有<code class="language-plaintext highlighter-rouge">bottom</code>、<code class="language-plaintext highlighter-rouge">height</code>、<code class="language-plaintext highlighter-rouge">left</code>、<code class="language-plaintext highlighter-rouge">right</code>、<code class="language-plaintext highlighter-rouge">top</code>和<code class="language-plaintext highlighter-rouge">width</code>六个属性，表示它们相对于视口的四个坐标，以及本身的高度和宽度。</p>

<p>对于盒状元素（比如<code class="language-plaintext highlighter-rouge">  &lt;div&gt;  </code>和<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>），该方法返回的对象中只有该元素一个成员。对于行内元素（比如<code class="language-plaintext highlighter-rouge"> &lt;span&gt; </code>、<code class="language-plaintext highlighter-rouge">  &lt;a&gt;  </code>、<code class="language-plaintext highlighter-rouge"> &lt;em&gt; </code>），该方法返回的对象有多少个成员，取决于该元素在页面上占据多少行。这是它和<code class="language-plaintext highlighter-rouge">Element.getBoundingClientRect()</code>方法的主要区别，后者对于行内元素总是返回一个矩形。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">span</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Hello</span> <span class="nx">World</span> <span class="nx">Hello</span> <span class="nx">World</span> <span class="nx">Hello</span> <span class="nx">World</span><span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span></code></pre></div></div>

<p>上面代码是一个行内元素<code class="language-plaintext highlighter-rouge"> &lt;span&gt; </code>，如果它在页面上占据三行，<code class="language-plaintext highlighter-rouge">getClientRects</code>方法返回的对象就有三个成员，如果它在页面上占据一行，<code class="language-plaintext highlighter-rouge">getClientRects</code>方法返回的对象就只有一个成员。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">inline</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">().</span><span class="nx">length</span> <span class="c1">// 3</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">left</span> <span class="c1">// 8</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">right</span> <span class="c1">// 113.908203125</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">bottom</span> <span class="c1">// 31.200000762939453</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">height</span> <span class="c1">// 23.200000762939453</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">getClientRects</span><span class="p">()[</span><span class="mi">0</span><span class="p">].</span><span class="nx">width</span> <span class="c1">// 105.908203125</span>
</code></pre></div></div>

<p>这个方法主要用于判断行内元素是否换行，以及行内元素的每一行的位置偏移。</p>

<p>注意，如果行内元素包括换行符，那么该方法会把换行符考虑在内。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">span</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">inline</span><span class="dl">"</span><span class="o">&gt;</span>
  <span class="nx">Hello</span> <span class="nx">World</span>
  <span class="nx">Hello</span> <span class="nx">World</span>
  <span class="nx">Hello</span> <span class="nx">World</span>
<span class="o">&lt;</span><span class="sr">/span</span><span class="err">&gt;
</span></code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge"> &lt;span&gt; </code>节点内部有三个换行符，即使 HTML 语言忽略换行符，将它们显示为一行，<code class="language-plaintext highlighter-rouge">getClientRects()</code>方法依然会返回三个成员。如果行宽设置得特别窄，上面的<code class="language-plaintext highlighter-rouge"> &lt;span&gt; </code>元素显示为6行，那么就会返回六个成员。</p>

<h4 id="212-elementinsertadjacentelement--插入新节点到元素的指定位置">2.12 Element.insertAdjacentElement()  插入新节点到元素的指定位置</h4>

<p><code class="language-plaintext highlighter-rouge">Element.insertAdjacentElement</code>方法<strong>在相对于当前元素的指定位置，插入一个新的节点</strong>。该方法返回被插入的节点，如果插入失败，返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">element</span><span class="p">.</span><span class="nx">insertAdjacentElement</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">Element.insertAdjacentElement</code>方法一共可以接受两个参数，第一个参数是一个字符串，表示插入的位置，第二个参数是将要插入的节点。第一个参数只可以取如下的值。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">beforebegin</code>：当前元素之前</li>
  <li><code class="language-plaintext highlighter-rouge">afterbegin</code>：当前元素内部的第一个子节点前面</li>
  <li><code class="language-plaintext highlighter-rouge">beforeend</code>：当前元素内部的最后一个子节点后面</li>
  <li><code class="language-plaintext highlighter-rouge">afterend</code>：当前元素之后</li>
</ul>

<p>注意，<code class="language-plaintext highlighter-rouge">beforebegin</code>和<code class="language-plaintext highlighter-rouge">afterend</code>这两个值，只在当前节点有父节点时才会生效。如果当前节点是由脚本创建的，没有父节点，那么插入会失败。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">)</span>
<span class="nx">p1</span><span class="p">.</span><span class="nx">insertAdjacentElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">afterend</span><span class="dl">'</span><span class="p">,</span> <span class="nx">p2</span><span class="p">)</span> <span class="c1">// null</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">p1</code>没有父节点，所以插入<code class="language-plaintext highlighter-rouge">p2</code>到它后面就失败了。</p>

<p>如果插入的节点是一个文档里现有的节点，它会从原有位置删除，放置到新的位置。</p>

<h4 id="213-elementinsertadjacenthtml-插入html字符串到指定位置elementinsertadjacenttext-插入text到指定位置">2.13 Element.insertAdjacentHTML() 插入html字符串到指定位置，Element.insertAdjacentText() 插入text到指定位置</h4>

<p><code class="language-plaintext highlighter-rouge">Element.insertAdjacentHTML</code>方法<strong>用于将一个 HTML 字符串，解析生成 DOM 结构，插入相对于当前节点的指定位置。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">element</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="nx">position</span><span class="p">,</span> <span class="nx">text</span><span class="p">);</span>
</code></pre></div></div>

<p>该方法接受两个参数，第一个是一个表示指定位置的字符串，第二个是待解析的 HTML 字符串。第一个参数只能设置下面四个值之一。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">beforebegin</code>：当前元素之前</li>
  <li><code class="language-plaintext highlighter-rouge">afterbegin</code>：当前元素内部的第一个子节点前面</li>
  <li><code class="language-plaintext highlighter-rouge">beforeend</code>：当前元素内部的最后一个子节点后面</li>
  <li><code class="language-plaintext highlighter-rouge">afterend</code>：当前元素之后</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码：&lt;div id="one"&gt;one&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">one</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">d1</span><span class="p">.</span><span class="nx">insertAdjacentHTML</span><span class="p">(</span><span class="dl">'</span><span class="s1">afterend</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&lt;div id="two"&gt;two&lt;/div&gt;</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 执行后的 HTML 代码：</span>
<span class="c1">// &lt;div id="one"&gt;one&lt;/div&gt;&lt;div id="two"&gt;two&lt;/div&gt;</span>
</code></pre></div></div>

<p>该方法只是在现有的 DOM 结构里面插入节点，这使得它的执行速度比<code class="language-plaintext highlighter-rouge">innerHTML</code>方法快得多。</p>

<p>注意，该方法不会转义 HTML 字符串，这导致它不能用来插入用户输入的内容，否则会有安全风险。</p>

<p><code class="language-plaintext highlighter-rouge">Element.insertAdjacentText</code>方法在相对于当前节点的指定位置，插入一个文本节点，用法与<code class="language-plaintext highlighter-rouge">Element.insertAdjacentHTML</code>方法完全一致。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码：&lt;div id="one"&gt;one&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">d1</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">one</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">d1</span><span class="p">.</span><span class="nx">insertAdjacentText</span><span class="p">(</span><span class="dl">'</span><span class="s1">afterend</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">two</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 执行后的 HTML 代码：</span>
<span class="c1">// &lt;div id="one"&gt;one&lt;/div&gt;two</span>
</code></pre></div></div>

<h4 id="214-elementremove-移除元素">2.14 Element.remove() 移除元素</h4>

<p><code class="language-plaintext highlighter-rouge">Element.remove</code>方法<strong>继承自 ChildNode 接口，用于将当前元素节点从它的父节点移除。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</code></pre></div></div>

<p>上面代码将<code class="language-plaintext highlighter-rouge">el</code>节点从 DOM 树里面移除。</p>

<h4 id="215-elementfocus-将页面焦点转移到元素elementblur-将焦点移除">2.15 Element.focus() 将页面焦点转移到元素，Element.blur() 将焦点移除</h4>

<p><code class="language-plaintext highlighter-rouge">Element.focus</code>方法<strong>用于将当前页面的焦点，转移到指定元素上</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-span</span><span class="dl">'</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
</code></pre></div></div>

<p>该方法可以接受一个对象作为参数。参数对象的<code class="language-plaintext highlighter-rouge">preventScroll</code>属性是一个布尔值，指定<strong>是否将当前元素停留在原始位置</strong>，而不是滚动到可见区域。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">getFocus</span><span class="p">()</span> <span class="p">{</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">btn</span><span class="dl">'</span><span class="p">).</span><span class="nx">focus</span><span class="p">({</span><span class="na">preventScroll</span><span class="p">:</span><span class="kc">false</span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码会让<code class="language-plaintext highlighter-rouge">btn</code>元素获得焦点，并<strong>滚动到可见区域</strong>。</p>

<p>最后，从<code class="language-plaintext highlighter-rouge">document.activeElement</code>属性可以得到当前获得焦点的元素。</p>

<p><code class="language-plaintext highlighter-rouge">Element.blur</code>方法<strong>用于将焦点从当前元素移除</strong>。</p>

<h4 id="216-elementclick-模拟点击事件">2.16 Element.click() 模拟点击事件</h4>

<p><code class="language-plaintext highlighter-rouge">Element.click</code>方法用于<strong>在当前元素上模拟一次鼠标点击，相当于触发了<code class="language-plaintext highlighter-rouge">click</code>事件。</strong></p>

<h2 id="七元素属性的操作">七、元素属性的操作</h2>

<p>HTML 元素包括标签名和若干个键值对，这个键值对就称为“属性”（attribute）。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">id=</span><span class="s">"test"</span> <span class="na">href=</span><span class="s">"http://www.example.com"</span><span class="nt">&gt;</span>
  链接
<span class="nt">&lt;/a&gt;</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">a</code>元素包括两个属性：<code class="language-plaintext highlighter-rouge">id</code>属性和<code class="language-plaintext highlighter-rouge">href</code>属性。</p>

<p>属性本身是一个对象（<code class="language-plaintext highlighter-rouge">Attr</code>对象），但是实际上，这个对象极少使用。一般都是通过元素节点对象（<code class="language-plaintext highlighter-rouge">HTMlElement</code>对象）来操作属性。本章介绍如何操作这些属性。</p>

<h3 id="1elementattributes-属性-返回包含标签所有属性的类数组动态对象">1、Element.attributes 属性 （返回包含标签所有属性的类数组动态对象）</h3>

<p>元素对象有一个<code class="language-plaintext highlighter-rouge">attributes</code>属性，返回一个<strong>类似数组的动态对象，成员是该元素标签的所有属性节点对象</strong>，属性的实时变化都会反映在这个节点对象上。其他类型的节点对象，虽然也有<code class="language-plaintext highlighter-rouge">attributes</code>属性，但返回的都是<code class="language-plaintext highlighter-rouge">null</code>，因此可以把这个属性视为元素对象独有的。</p>

<p>单个属性可以通过序号引用，也可以通过属性名引用。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// &lt;a id="test" href="http://www.example.com"&gt;链接&lt;/a&gt;</span>
<span class="c1">// document.getElementsByTagName('a')[0].attributes 返回一个 NamedNodeMap 类数组对象</span>

<span class="nx">NamedNodeMap</span><span class="err"> </span><span class="p">{</span><span class="mi">0</span><span class="p">:</span> <span class="nx">id</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span> <span class="nx">href</span><span class="p">,</span> <span class="nx">id</span><span class="p">:</span> <span class="nx">id</span><span class="p">,</span> <span class="nx">href</span><span class="p">:</span> <span class="nx">href</span><span class="p">,</span> <span class="nx">length</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>

<span class="c1">// 这两个访问方法都是返回一个id的属性节点对象</span>
<span class="c1">// NamedNodeMap[0]</span>
<span class="c1">// NamedNodeMap.id</span>

<span class="p">{</span>
    <span class="na">baseURI</span><span class="p">:</span> <span class="dl">"</span><span class="s2">file:///C:/Users/dell/Desktop/test.html</span><span class="dl">"</span>
    <span class="na">childNodes</span><span class="p">:</span> <span class="nx">NodeList</span> <span class="p">[]</span>
    <span class="na">firstChild</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">isConnected</span><span class="p">:</span> <span class="kc">false</span>
    <span class="na">lastChild</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">localName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span> <span class="c1">// 属性是‘id’</span>
    <span class="na">namespaceURI</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">nextSibling</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">nodeName</span><span class="p">:</span> <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span>
    <span class="na">nodeType</span><span class="p">:</span> <span class="mi">2</span>
    <span class="na">nodeValue</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span>
    <span class="na">ownerDocument</span><span class="p">:</span> <span class="nb">document</span>
    <span class="na">ownerElement</span><span class="p">:</span> <span class="nx">a</span><span class="err">#</span><span class="nx">test</span>
    <span class="na">parentElement</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">parentNode</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">prefix</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">previousSibling</span><span class="p">:</span> <span class="kc">null</span>
    <span class="na">specified</span><span class="p">:</span> <span class="kc">true</span>
    <span class="na">textContent</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span>
    <span class="na">value</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span> <span class="c1">// id的值</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;body bgcolor="yellow" onload=""&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">bgcolor</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="dl">'</span><span class="s1">ONLOAD</span><span class="dl">'</span><span class="p">]</span>
</code></pre></div></div>

<p>注意，上面代码的三种方法，<strong>返回的都是属性节点对象，而不是属性值</strong>。</p>

<p><strong>属性节点对象有<code class="language-plaintext highlighter-rouge">name</code>和<code class="language-plaintext highlighter-rouge">value</code>属性</strong>，对应该属性的属性名和属性值，等同于<code class="language-plaintext highlighter-rouge">nodeName</code>属性和<code class="language-plaintext highlighter-rouge">nodeValue</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML代码为</span>
<span class="c1">// &lt;div id="mydiv"&gt;</span>
<span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">n</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">name</span> <span class="c1">// "id"</span>
<span class="nx">n</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeName</span> <span class="c1">// "id"</span>

<span class="nx">n</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span> <span class="c1">// "mydiv"</span>
<span class="nx">n</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">nodeValue</span> <span class="c1">// "mydiv"</span>
</code></pre></div></div>

<p>下面代码可以遍历一个元素节点的所有属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">para</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">result</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">para</span><span class="p">.</span><span class="nx">hasAttributes</span><span class="p">())</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">attrs</span> <span class="o">=</span> <span class="nx">para</span><span class="p">.</span><span class="nx">attributes</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">attrs</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">output</span> <span class="o">+=</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">name</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">-&gt;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">attrs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">result</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">No attributes to show</span><span class="dl">'</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="2元素的标准属性">2、元素的标准属性</h3>

<p>HTML 元素的标准属性（即<strong>在标准中定义的属性</strong>），会<strong>自动成为元素节点对象的属性</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// &lt;a id="aId" href="http://www.example.com" class="aClass"&gt;链接&lt;/a&gt;</span>

<span class="kd">var</span> <span class="nx">a</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">test</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// a是节点对象，id和href自动成为a节点的属性</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">id</span> <span class="c1">// "aId"</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">href</span> <span class="c1">// "http://www.example.com/"</span>
<span class="nx">a</span><span class="p">.</span><span class="nx">className</span> <span class="c1">// "aClass"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">a</code>元素标签的属性<code class="language-plaintext highlighter-rouge">id</code>和<code class="language-plaintext highlighter-rouge">href</code>，自动成为节点对象的属性。</p>

<p>这些属性都是可写的。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myImage</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">img</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">http://www.example.com/image.jpg</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>上面的写法，会立刻替换掉<code class="language-plaintext highlighter-rouge">img</code>对象的<code class="language-plaintext highlighter-rouge">src</code>属性，即会显示另外一张图片。</p>

<p>这种修改属性的方法，常常用于添加表单的属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">forms</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">f</span><span class="p">.</span><span class="nx">action</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">submit.php</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">f</span><span class="p">.</span><span class="nx">method</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>上面代码为表单添加提交网址和提交方法。</p>

<p>注意，<strong>这种用法虽然可以读写属性，但是无法删除属性</strong>，<code class="language-plaintext highlighter-rouge">delete</code>运算符在这里不会生效。</p>

<p>HTML 元素的属性名是大小写不敏感的，但是 JavaScript 对象的属性名是大小写敏感的。转换规则是，转为 JavaScript 属性名时，一律采用小写。<strong>如果属性名包括多个单词，则采用骆驼拼写法</strong>，即从第二个单词开始，每个单词的首字母采用大写，比如<code class="language-plaintext highlighter-rouge">onClick</code>。</p>

<p>有些 HTML 属性名是 JavaScript 的保留字，转为 JavaScript 属性时，必须改名。主要是以下两个。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">for</code>属性改为<code class="language-plaintext highlighter-rouge">htmlFor</code></li>
  <li><code class="language-plaintext highlighter-rouge">class</code>属性改为<code class="language-plaintext highlighter-rouge">className</code></li>
</ul>

<p>另外，HTML 属性值一般都是字符串，但是 JavaScript 属性会自动转换类型。比如，将字符串<code class="language-plaintext highlighter-rouge">true</code>转为布尔值，将<code class="language-plaintext highlighter-rouge">onClick</code>的值转为一个函数，将<code class="language-plaintext highlighter-rouge">style</code>属性的值转为一个<code class="language-plaintext highlighter-rouge">CSSStyleDeclaration</code>对象。因此，可以对这些属性赋予各种类型的值。</p>

<h3 id="3属性操作的标准方法">3、属性操作的标准方法</h3>

<h4 id="31-概述">3.1 概述</h4>

<p><strong>元素节点提供六个方法，用来操作属性。</strong></p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">getAttribute()</code></li>
  <li><code class="language-plaintext highlighter-rouge">getAttributeNames()</code></li>
  <li><code class="language-plaintext highlighter-rouge">setAttribute()</code></li>
  <li><code class="language-plaintext highlighter-rouge">hasAttribute()</code></li>
  <li><code class="language-plaintext highlighter-rouge">hasAttributes()</code></li>
  <li><code class="language-plaintext highlighter-rouge">removeAttribute()</code></li>
</ul>

<p>这有几点注意。</p>

<p>（1）适用性</p>

<p>这六个方法<strong>对所有属性（包括用户自定义的属性）都适用</strong>。</p>

<p>（2）返回值</p>

<p><code class="language-plaintext highlighter-rouge">getAttribute()</code>只返回字符串，不会返回其他类型的值。</p>

<p>（3）属性名</p>

<p>这些方法只接受属性的标准名称，不用改写保留字，比如<code class="language-plaintext highlighter-rouge">for</code>和<code class="language-plaintext highlighter-rouge">class</code>都可以直接使用。另外，这些方法对于属性名是大小写不敏感的。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">images</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">image</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">class</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">myImage</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">setAttribute</code>方法直接使用<code class="language-plaintext highlighter-rouge">class</code>作为属性名，不用写成<code class="language-plaintext highlighter-rouge">className</code>。</p>

<h4 id="32-elementgetattribute-返回元素的指定属性值字符串">3.2 Element.getAttribute() 返回元素的指定属性值，字符串</h4>

<p><code class="language-plaintext highlighter-rouge">Element.getAttribute</code>方法<strong>返回当前元素节点的指定属性</strong>。如果指定属性不存在，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="div1" align="left"&gt;</span>
<span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div1</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">div</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">align</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// "left"</span>
</code></pre></div></div>

<h4 id="33-elementgetattributenames-返回一个数组成员是元素的所有属性的名字">3.3 Element.getAttributeNames() 返回一个数组，成员是元素的所有属性的名字</h4>

<p><code class="language-plaintext highlighter-rouge">Element.getAttributeNames()</code><strong>返回一个数组，成员是当前元素的所有属性的名字</strong>。如果当前元素没有任何属性，则返回一个空数组。使用<code class="language-plaintext highlighter-rouge">Element.attributes</code>属性，也可以拿到同样的结果，唯一的区别是它返回的是类似数组的对象。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mydiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">mydiv</span><span class="p">.</span><span class="nx">getAttributeNames</span><span class="p">().</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">mydiv</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">})</span>
</code></pre></div></div>

<p>上面代码用于遍历某个节点的所有属性。</p>

<h4 id="34-elementsetattribute-为元素设置新增属性">3.4 Element.setAttribute() 为元素设置（新增）属性</h4>

<p><code class="language-plaintext highlighter-rouge">Element.setAttribute</code>方法用于<strong>为当前元素节点新增属性</strong>。如果同名属性已存在，则相当于编辑已存在的属性。该方法没有返回值。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;button&gt;Hello World&lt;/button&gt;</span>
<span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">name</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">myButton</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">b</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">disabled</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// 属性值总是字符串，其他类型会转成字符串，这里会转成字符串'true'</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">button</code>元素的<code class="language-plaintext highlighter-rouge">name</code>属性被设成<code class="language-plaintext highlighter-rouge">myButton</code>，<code class="language-plaintext highlighter-rouge">disabled</code>属性被设成<code class="language-plaintext highlighter-rouge">true</code>。</p>

<p>这里有两个地方需要注意，首先，属性值总是字符串，其他类型的值会自动转成字符串，比如布尔值<code class="language-plaintext highlighter-rouge">true</code>就会变成字符串<code class="language-plaintext highlighter-rouge">true</code>；其次，上例的<code class="language-plaintext highlighter-rouge">disable</code>属性是一个布尔属性，对于<code class="language-plaintext highlighter-rouge"> &lt;button&gt; </code>元素来说，这个属性不需要属性值，只要设置了就总是会生效，因此<code class="language-plaintext highlighter-rouge">setAttribute</code>方法里面可以将<code class="language-plaintext highlighter-rouge">disabled</code>属性设成任意值。</p>

<h4 id="35-elementhasattribute-是否包含指定属性">3.5 Element.hasAttribute() 是否包含指定属性</h4>

<p><code class="language-plaintext highlighter-rouge">Element.hasAttribute</code>方法<strong>返回一个布尔值，表示当前元素节点是否包含指定属性</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div1</span><span class="dl">'</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">hasAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">align</span><span class="dl">'</span><span class="p">))</span> <span class="p">{</span>
  <span class="nx">d</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">align</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">center</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码检查<code class="language-plaintext highlighter-rouge">div</code>节点是否含有<code class="language-plaintext highlighter-rouge">align</code>属性。如果有，则设置为居中对齐。</p>

<h4 id="36-elementhasattributes-是否有任何的属性">3.6 Element.hasAttributes() 是否有任何的属性</h4>

<p><code class="language-plaintext highlighter-rouge">Element.hasAttributes</code>方法<strong>返回一个布尔值，表示当前元素是否有属性，如果没有任何属性，就返回<code class="language-plaintext highlighter-rouge">false</code>，否则返回<code class="language-plaintext highlighter-rouge">true</code>。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">foo</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">foo</span><span class="p">.</span><span class="nx">hasAttributes</span><span class="p">()</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="37-elementremoveattribute-移除指定属性">3.7 Element.removeAttribute() 移除指定属性</h4>

<p><code class="language-plaintext highlighter-rouge">Element.removeAttribute</code>方法<strong>移除指定属性</strong>。该方法<strong>没有返回值</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="div1" align="left" width="200px"&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">div1</span><span class="dl">'</span><span class="p">).</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">align</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 现在的HTML代码为</span>
<span class="c1">// &lt;div id="div1" width="200px"&gt;</span>
</code></pre></div></div>

<h3 id="4dataset-属性---获取data-自定义属性">4、dataset 属性   获取data-*自定义属性</h3>

<p>有时，需要在HTML元素上附加数据，供 JavaScript 脚本使用。一种解决方法是<strong>自定义属性</strong>。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"mydiv"</span> <span class="na">foo=</span><span class="s">"bar"</span><span class="nt">&gt;</span>
</code></pre></div></div>

<p>上面代码为<code class="language-plaintext highlighter-rouge">div</code>元素<strong>自定义了<code class="language-plaintext highlighter-rouge">foo</code>属性</strong>，然后可以用<code class="language-plaintext highlighter-rouge">getAttribute()</code>和<code class="language-plaintext highlighter-rouge">setAttribute()</code>读写这个属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">n</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// bar</span>
<span class="nx">n</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p><strong>这种方法虽然可以达到目的，但是会使得 HTML 元素的属性不符合标准，导致网页代码通不过校验。</strong></p>

<p>更好的解决方法是，使用<strong>标准提供的<code class="language-plaintext highlighter-rouge">data-*</code>属性</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">mydiv</span><span class="dl">"</span> <span class="nx">data</span><span class="o">-</span><span class="nx">foo</span><span class="o">=</span><span class="dl">"</span><span class="s2">bar</span><span class="dl">"</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>然后，使用元素节点对象的<code class="language-plaintext highlighter-rouge">dataset</code>属性，它指向一个对象，可以用来操作 HTML 元素标签的<code class="language-plaintext highlighter-rouge">data-*</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">mydiv</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">n</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">foo</span> <span class="c1">// bar  省略data-，直接访问foo即可访问到 data-foo的值</span>
<span class="nx">n</span><span class="p">.</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">foo</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">baz</span><span class="dl">'</span>
</code></pre></div></div>

<p>上面代码中，通过<code class="language-plaintext highlighter-rouge">dataset.foo</code>读写<code class="language-plaintext highlighter-rouge">data-foo</code>属性。</p>

<p><strong>删除一个<code class="language-plaintext highlighter-rouge">data-*</code>属性，可以直接使用<code class="language-plaintext highlighter-rouge">delete</code>命令。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">delete</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">dataset</span><span class="p">.</span><span class="nx">foo</span><span class="p">;</span>
</code></pre></div></div>

<p>除了<code class="language-plaintext highlighter-rouge">dataset</code>属性，也可以用<code class="language-plaintext highlighter-rouge">getAttribute('data-foo')</code>、<code class="language-plaintext highlighter-rouge">removeAttribute('data-foo')</code>、<code class="language-plaintext highlighter-rouge">setAttribute('data-foo')</code>、<code class="language-plaintext highlighter-rouge">hasAttribute('data-foo')</code>等方法操作<code class="language-plaintext highlighter-rouge">data-*</code>属性。</p>

<p>注意，<code class="language-plaintext highlighter-rouge">data-</code>后面的属性名有限制，只能包含字母、数字、连词线（<code class="language-plaintext highlighter-rouge">-</code>）、点（<code class="language-plaintext highlighter-rouge">.</code>）、冒号（<code class="language-plaintext highlighter-rouge">:</code>）和下划线（<code class="language-plaintext highlighter-rouge">_</code>)。而且，属性名<strong>不应该使用<code class="language-plaintext highlighter-rouge">A</code>到<code class="language-plaintext highlighter-rouge">Z</code>的大写字母</strong>，比如不能有<code class="language-plaintext highlighter-rouge">data-helloWorld</code>这样的属性名，而要写成<code class="language-plaintext highlighter-rouge">data-hello-world</code>。</p>

<p><strong>data-后面不能使用驼峰写法，可以使用烤串写法。</strong></p>

<p>转成<code class="language-plaintext highlighter-rouge">dataset</code>的键名时，连词线后面如果跟着一个小写字母，那么连词线会被移除，该小写字母转为大写字母，其他字符不变。反过来，<code class="language-plaintext highlighter-rouge">dataset</code>的键名转成属性名时，所有大写字母都会被转成连词线+该字母的小写形式，其他字符不变。比如，<code class="language-plaintext highlighter-rouge">dataset.helloWorld</code>会转成<code class="language-plaintext highlighter-rouge">data-hello-world</code>。</p>

<p><strong>通过dataset访问的时候，如有烤串写法属性需通过驼峰写法访问</strong></p>

<h2 id="八text-节点和-documentfragment-节点">八、Text 节点和 DocumentFragment 节点</h2>

<h3 id="1text-节点的概念">1、Text 节点的概念</h3>

<p><strong>文本节点（<code class="language-plaintext highlighter-rouge">Text</code>）代表元素节点（<code class="language-plaintext highlighter-rouge">Element</code>）和属性节点（<code class="language-plaintext highlighter-rouge">Attribute</code>）的文本内容。如果一个节点只包含一段文本，那么它就有一个文本子节点，代表该节点的文本内容。</strong></p>

<p>通常我们使用父节点的<code class="language-plaintext highlighter-rouge">firstChild</code>、<code class="language-plaintext highlighter-rouge">nextSibling</code>等属性获取文本节点，或者使用<code class="language-plaintext highlighter-rouge">Document</code>节点的<code class="language-plaintext highlighter-rouge">createTextNode</code>方法创造一个文本节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 获取文本节点</span>
<span class="kd">var</span> <span class="nx">textNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">;</span>

<span class="c1">// 创造文本节点</span>
<span class="kd">var</span> <span class="nx">textNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hi</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">textNode</span><span class="p">);</span>
</code></pre></div></div>

<p>浏览器原生提供一个<strong><code class="language-plaintext highlighter-rouge">Text</code>构造函数</strong>。它返回一个文本节点实例。它的参数就是该文本节点的文本内容。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 空字符串</span>
<span class="kd">var</span> <span class="nx">text1</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">();</span> <span class="c1">// 返回一个文本实例</span>

<span class="c1">// 非空字符串</span>
<span class="kd">var</span> <span class="nx">text2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="dl">'</span><span class="s1">This is a text node</span><span class="dl">'</span><span class="p">);</span> <span class="c1">// 参数为该文本节点的文本内容</span>
</code></pre></div></div>

<p>注意，由于空格也是一个字符，所以哪怕只有一个空格，也会形成文本节点。比如，<code class="language-plaintext highlighter-rouge"> </code>包含一个空格，它的子节点就是一个文本节点。</p>

<p>文本节点除了<strong>继承<code class="language-plaintext highlighter-rouge">Node</code>接口，还继承了<code class="language-plaintext highlighter-rouge">CharacterData</code>接口</strong>。<code class="language-plaintext highlighter-rouge">Node</code>接口的属性和方法请参考《Node 接口》一章，这里不再重复介绍了，以下的属性和方法大部分来自<code class="language-plaintext highlighter-rouge">CharacterData</code>接口。</p>

<h3 id="2text-节点的属性">2、Text 节点的属性</h3>

<h4 id="21-data--设置或读取文本节点内容">2.1 data  设置或读取文本节点内容</h4>

<p><code class="language-plaintext highlighter-rouge">data</code>属性等同于<code class="language-plaintext highlighter-rouge">nodeValue</code>属性，用来<strong>设置或读取文本节点的内容</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 读取文本内容</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">data</span>
<span class="c1">// 等同于</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">nodeValue</span>

<span class="c1">// 设置文本内容</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">data</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h4 id="22-wholetext-当前文本和毗邻文本节作为整体返回">2.2 wholeText 当前文本和毗邻文本节，作为整体返回</h4>

<p><code class="language-plaintext highlighter-rouge">wholeText</code>属性<strong>将当前文本节点与毗邻的文本节点，作为一个整体返回</strong>。大多数情况下，<code class="language-plaintext highlighter-rouge">wholeText</code>属性的返回值，与<code class="language-plaintext highlighter-rouge">data</code>属性和<code class="language-plaintext highlighter-rouge">textContent</code>属性相同。但是，某些特殊情况会有差异。</p>

<p>举例来说，HTML 代码如下。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">p</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">para</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">A</span> <span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">B</span><span class="o">&lt;</span><span class="sr">/em&gt; C&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>这时，文本节点的<code class="language-plaintext highlighter-rouge">wholeText</code>属性和<code class="language-plaintext highlighter-rouge">data</code>属性，返回值相同。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">para</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">wholeText</span> <span class="c1">// "A "</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">data</span> <span class="c1">// "A "</span>
</code></pre></div></div>

<p>但是，一旦移除<code class="language-plaintext highlighter-rouge"> &lt;em&gt; </code>节点，<code class="language-plaintext highlighter-rouge">wholeText</code>属性与<code class="language-plaintext highlighter-rouge">data</code>属性就会有差异，因为这时其实<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>节点下面包含了两个毗邻的文本节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">para</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">wholeText</span> <span class="c1">// "A C"</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">data</span> <span class="c1">// "A "</span>
</code></pre></div></div>

<h4 id="23-length-文本长度">2.3 length 文本长度</h4>

<p><code class="language-plaintext highlighter-rouge">length</code>属性<strong>返回当前文本节点的文本长度</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">new</span> <span class="nx">Text</span><span class="p">(</span><span class="dl">'</span><span class="s1">Hello</span><span class="dl">'</span><span class="p">)).</span><span class="nx">length</span> <span class="c1">// 5</span>
</code></pre></div></div>

<h4 id="24-nextelementsibling-后一个兄弟元素节点previouselementsibling-前一个兄弟元素节点">2.4 nextElementSibling 后一个兄弟元素节点，previousElementSibling 前一个兄弟元素节点</h4>

<p><code class="language-plaintext highlighter-rouge">nextElementSibling</code>属性<strong>返回紧跟在当前文本节点后面的那个同级元素节点</strong>。如果取不到元素节点，则返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 为</span>
<span class="c1">// &lt;div&gt;Hello &lt;em&gt;World&lt;/em&gt;&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">tn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">;</span>
<span class="nx">tn</span><span class="p">.</span><span class="nx">nextElementSibling</span>
<span class="c1">// &lt;em&gt;World&lt;/em&gt;</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">previousElementSibling</code>属性<strong>返回当前文本节点前面最近的同级元素节点</strong>。如果取不到元素节点，则返回<code class="language-plaintext highlighter-rouge">null：</code>。</p>

<h3 id="3text-节点的方法">3、Text 节点的方法</h3>

<h4 id="31-appenddatadeletedatainsertdatareplacedatasubstringdata">3.1 appendData()，deleteData()，insertData()，replaceData()，substringData()</h4>

<p>以下5个方法都是<strong>编辑<code class="language-plaintext highlighter-rouge">Text</code>节点文本内容的方法</strong>。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">appendData()</code>：在<code class="language-plaintext highlighter-rouge">Text</code>节点<strong>尾部追加字符串</strong>。</li>
  <li><code class="language-plaintext highlighter-rouge">deleteData()</code>：<strong>删除<code class="language-plaintext highlighter-rouge">Text</code>节点内部的子字符串</strong>，第一个参数为子字符串开始位置，第二个参数为子字符串长度。</li>
  <li><code class="language-plaintext highlighter-rouge">insertData()</code>：在<code class="language-plaintext highlighter-rouge">Text</code>节点<strong>插入字符串</strong>，第一个参数为插入位置，第二个参数为插入的子字符串。</li>
  <li><code class="language-plaintext highlighter-rouge">replaceData()</code>：用于<strong>替换文本</strong>，第一个参数为替换开始位置，第二个参数为需要被替换掉的长度，第三个参数为新加入的字符串。</li>
  <li><code class="language-plaintext highlighter-rouge">substringData()</code>：用于<strong>获取子字符串</strong>，第一个参数为子字符串在<code class="language-plaintext highlighter-rouge">Text</code>节点中的开始位置，第二个参数为子字符串长度。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;p&gt;Hello World&lt;/p&gt;</span>
<span class="kd">var</span> <span class="nx">pElementText</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">;</span>

<span class="nx">pElementText</span><span class="p">.</span><span class="nx">appendData</span><span class="p">(</span><span class="dl">'</span><span class="s1">!</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 页面显示 Hello World!</span>
<span class="nx">pElementText</span><span class="p">.</span><span class="nx">deleteData</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
<span class="c1">// 页面显示 Hello W</span>
<span class="nx">pElementText</span><span class="p">.</span><span class="nx">insertData</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Hello </span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 页面显示 Hello WHello</span>
<span class="nx">pElementText</span><span class="p">.</span><span class="nx">replaceData</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="dl">'</span><span class="s1">World</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// 页面显示 Hello WWorld</span>
<span class="nx">pElementText</span><span class="p">.</span><span class="nx">substringData</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">// 页面显示不变，返回"World "</span>
</code></pre></div></div>

<h4 id="32-remove-移除text节点">3.2 remove() 移除Text节点</h4>

<p><code class="language-plaintext highlighter-rouge">remove</code>方法用于移除当前<code class="language-plaintext highlighter-rouge">Text</code>节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;p&gt;Hello World&lt;/p&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">).</span><span class="nx">firstChild</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
<span class="c1">// 现在 HTML 代码为</span>
<span class="c1">// &lt;p&gt;&lt;/p&gt;</span>
</code></pre></div></div>

<h4 id="33-splittext-分割text节点变为两个">3.3 splitText() 分割Text节点变为两个</h4>

<p><code class="language-plaintext highlighter-rouge">splitText</code>方法<strong>将<code class="language-plaintext highlighter-rouge">Text</code>节点一分为二，变成两个毗邻的<code class="language-plaintext highlighter-rouge">Text</code>节点。它的参数就是分割位置（从零开始）</strong>，分割到该位置的字符前结束。如果分割位置不存在，将报错。</p>

<p>分割后，该方法<strong>返回分割位置后方的字符串</strong>，而原<code class="language-plaintext highlighter-rouge">Text</code>节点变成只包含分割位置前方的字符串。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// html 代码为 &lt;p id="p"&gt;foobar&lt;/p&gt;</span>
<span class="kd">var</span> <span class="nx">p</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">p</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">textnode</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">firstChild</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">newText</span> <span class="o">=</span> <span class="nx">textnode</span><span class="p">.</span><span class="nx">splitText</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
<span class="nx">newText</span> <span class="c1">// "bar"</span>
<span class="nx">textnode</span> <span class="c1">// "foo"</span>
</code></pre></div></div>

<p><strong>父元素节点的<code class="language-plaintext highlighter-rouge">normalize</code>方法可以将毗邻的两个<code class="language-plaintext highlighter-rouge">Text</code>节点合并。</strong></p>

<p>接上面的例子，文本节点的<code class="language-plaintext highlighter-rouge">splitText</code>方法将一个<code class="language-plaintext highlighter-rouge">Text</code>节点分割成两个，父元素的<code class="language-plaintext highlighter-rouge">normalize</code>方法可以实现逆操作，将它们合并。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">p</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 2</span>

<span class="c1">// 将毗邻的两个 Text 节点合并</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">normalize</span><span class="p">();</span>
<span class="nx">p</span><span class="p">.</span><span class="nx">childNodes</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 1</span>
</code></pre></div></div>

<h3 id="4documentfragment-文档片段节点">4、DocumentFragment 文档片段节点</h3>

<p><code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点代表一个<strong>文档的片段，本身就是一个完整的 DOM 树形结构。它没有父节点</strong>，<code class="language-plaintext highlighter-rouge">parentNode</code>返回<code class="language-plaintext highlighter-rouge">null</code>，但是<strong>可以插入任意数量的子节点。它不属于当前文档，操作<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点，要比直接操作 DOM 树快得多。</strong></p>

<p>它一般用于构建一个 DOM 结构，然后插入当前文档。<code class="language-plaintext highlighter-rouge">document.createDocumentFragment</code>方法，以及浏览器原生的<code class="language-plaintext highlighter-rouge">DocumentFragment</code>构造函数，可以创建一个空的<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点。然后再使用其他 DOM 方法，向其添加子节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">docFrag</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
<span class="c1">// 等同于</span>
<span class="kd">var</span> <span class="nx">docFrag</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">DocumentFragment</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">li</span><span class="p">.</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Hello World</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">docFrag</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">).</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">docFrag</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码创建了一个<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点，然后将一个<code class="language-plaintext highlighter-rouge">li</code>节点添加在它里面，最后将<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点移动到原文档。</p>

<p><strong>注意</strong>，<code class="language-plaintext highlighter-rouge">DocumentFragment</code><strong>节点本身不能被插入当前文档</strong>。当它作为<code class="language-plaintext highlighter-rouge">appendChild()</code>、<code class="language-plaintext highlighter-rouge">insertBefore()</code>、<code class="language-plaintext highlighter-rouge">replaceChild()</code>等方法的参数时，是它的<strong>所有子节点插入当前文档，而不是它自身</strong>。一旦<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点被添加进当前文档，它自身就变成了空节点（<code class="language-plaintext highlighter-rouge">textContent</code>属性为空字符串），可以被再次使用。如果想要保存<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点的内容，可以使用<code class="language-plaintext highlighter-rouge">cloneNode</code>方法。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span>
  <span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">ul</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">docFrag</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span>
</code></pre></div></div>

<p>上面这样添加<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点进入当前文档，不会清空<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点。</p>

<p>下面是一个例子，使用<code class="language-plaintext highlighter-rouge">DocumentFragment</code>反转一个指定节点的所有子节点的顺序。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">reverse</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">f</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
  <span class="k">while</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">)</span> <span class="nx">f</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">n</span><span class="p">.</span><span class="nx">lastChild</span><span class="p">);</span>
  <span class="nx">n</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">f</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点对象<strong>没有自己的属性和方法，全部继承自<code class="language-plaintext highlighter-rouge">Node</code>节点和<code class="language-plaintext highlighter-rouge">ParentNode</code>接口</strong>。也就是说，<code class="language-plaintext highlighter-rouge">DocumentFragment</code>节点比<code class="language-plaintext highlighter-rouge">Node</code>节点多出以下四个属性。</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">children</code>：返回一个动态的<code class="language-plaintext highlighter-rouge">HTMLCollection</code>集合对象，包括当前<code class="language-plaintext highlighter-rouge">DocumentFragment</code>对象的所有子元素节点。</li>
  <li><code class="language-plaintext highlighter-rouge">firstElementChild</code>：返回当前<code class="language-plaintext highlighter-rouge">DocumentFragment</code>对象的第一个子元素节点，如果没有则返回<code class="language-plaintext highlighter-rouge">null</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">lastElementChild</code>：返回当前<code class="language-plaintext highlighter-rouge">DocumentFragment</code>对象的最后一个子元素节点，如果没有则返回<code class="language-plaintext highlighter-rouge">null</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">childElementCount</code>：返回当前<code class="language-plaintext highlighter-rouge">DocumentFragment</code>对象的所有子元素数量。</li>
</ul>

<h2 id="八css-操作">八、CSS 操作</h2>

<p>CSS 与 JavaScript 是两个有着明确分工的领域，前者负责页面的视觉效果，后者负责与用户的行为互动。但是，它们毕竟同属网页开发的前端，因此不可避免有着交叉和互相配合。本章介绍如何<strong>通过 JavaScript 操作 CSS</strong>。</p>

<h3 id="1html-元素的-style-属性">1、HTML 元素的 style 属性</h3>

<p>操作 CSS 样式最简单的方法，就是使用网页元素节点的<code class="language-plaintext highlighter-rouge">getAttribute()</code>方法、<code class="language-plaintext highlighter-rouge">setAttribute()</code>方法和<code class="language-plaintext highlighter-rouge">removeAttribute()</code>方法，直接读写或删除网页元素的<code class="language-plaintext highlighter-rouge">style</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">div</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span>
  <span class="dl">'</span><span class="s1">style</span><span class="dl">'</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">background-color:red;</span><span class="dl">'</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">border:1px solid black;</span><span class="dl">'</span>
<span class="p">);</span>
</code></pre></div></div>

<p>上面的代码相当于下面的 HTML 代码。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">style</span><span class="o">=</span><span class="dl">"</span><span class="s2">background-color:red; border:1px solid black;</span><span class="dl">"</span> <span class="o">/&gt;</span>
</code></pre></div></div>

<p><strong><code class="language-plaintext highlighter-rouge">style</code>不仅可以使用字符串读写，它本身还是一个对象</strong>，部署了 CSSStyleDeclaration 接口（详见下面的介绍），<strong>可以直接读写个别属性</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">fontSize</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">18px</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">e</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">black</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="2cssstyledeclaration-接口">2、CSSStyleDeclaration 接口</h3>

<h4 id="21-简介---用来操作元素的样式可读写">2.1 简介 - 用来操作元素的样式，可读写</h4>

<p>CSSStyleDeclaration 接口<strong>用来操作元素的样式</strong>。三个地方部署了这个接口。</p>

<ul>
  <li>元素节点的<code class="language-plaintext highlighter-rouge">style</code>属性（<code class="language-plaintext highlighter-rouge">Element.style</code>）</li>
  <li><code class="language-plaintext highlighter-rouge">CSSStyle</code>实例的<code class="language-plaintext highlighter-rouge">style</code>属性</li>
  <li><code class="language-plaintext highlighter-rouge">window.getComputedStyle()</code>的返回值</li>
</ul>

<p>CSSStyleDeclaration 接口<strong>可以直接读写 CSS 的样式属性</strong>，不过，连词号需要变成骆驼拼写法。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">divStyle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>

<span class="c1">// 可读写</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">red</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">border</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">1px solid black</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">100px</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">100px</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">fontSize</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">10em</span><span class="dl">'</span><span class="p">;</span>

<span class="c1">// 注意，读的样式只是行内样式，不能读取样式表的样式</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="c1">// red</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">border</span> <span class="c1">// 1px solid black</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">height</span> <span class="c1">// 100px</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">width</span> <span class="c1">// 100px</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">style</code>属性的值是一个 CSSStyleDeclaration 实例。<strong>这个对象所包含的属性与 CSS 规则一一对应</strong>，但是名字需要改写，比如<code class="language-plaintext highlighter-rouge">background-color</code>写成<code class="language-plaintext highlighter-rouge">backgroundColor</code>。改写的规则是将横杠从 CSS 属性名中去除，然后将横杠后的第一个字母大写。如果 CSS 属性名是 JavaScript 保留字，则规则名之前需要加上字符串<code class="language-plaintext highlighter-rouge">css</code>，比如<strong><code class="language-plaintext highlighter-rouge">float</code>写成<code class="language-plaintext highlighter-rouge">cssFloat</code></strong>。</p>

<p><strong>改写规则：烤串变驼峰，保留字前加<code class="language-plaintext highlighter-rouge">css</code></strong></p>

<p>注意，该对象的属性值都是字符串，设置时必须包括单位，但是不含规则结尾的分号。比如，<code class="language-plaintext highlighter-rouge">divStyle.width</code>不能写为<code class="language-plaintext highlighter-rouge">100</code>，而要写为<code class="language-plaintext highlighter-rouge">100px</code>。</p>

<p>另外，<strong><code class="language-plaintext highlighter-rouge">Element.style</code>返回的只是行内样式，并不是该元素的全部样式</strong>。通过样式表设置的样式，或者从父元素继承的样式，无法通过这个属性得到。<strong>元素的全部样式要通过<code class="language-plaintext highlighter-rouge">window.getComputedStyle()</code>得到。</strong></p>

<h4 id="22-cssstyledeclaration-实例属性">2.2 CSSStyleDeclaration 实例属性</h4>

<h5 id="1cssstyledeclarationcsstext-用来读写所有行内样式">（1）CSSStyleDeclaration.cssText 用来读写所有行内样式</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.cssText</code>属性<strong>用来读写当前规则的所有样式声明文本</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">divStyle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>

<span class="nx">divStyle</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">background-color: red;</span><span class="dl">'</span> <span class="c1">// 会覆盖原有的整个行内样式</span>
  <span class="o">+</span> <span class="dl">'</span><span class="s1">border: 1px solid black;</span><span class="dl">'</span>
  <span class="o">+</span> <span class="dl">'</span><span class="s1">height: 100px;</span><span class="dl">'</span>
  <span class="o">+</span> <span class="dl">'</span><span class="s1">width: 100px;</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">cssText</code>的属性值不用改写 CSS 属性名。</p>

<p><strong>删除一个元素的所有行内样式，最简便的方法就是设置<code class="language-plaintext highlighter-rouge">cssText</code>为空字符串。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">divStyle</span><span class="p">.</span><span class="nx">cssText</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
</code></pre></div></div>

<h5 id="2cssstyledeclarationlength-行内样式的长度">（2）CSSStyleDeclaration.length 行内样式的长度</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.length</code>属性<strong>返回一个整数值，表示当前规则包含多少条样式声明。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;div id="myDiv"</span>
<span class="c1">//   style="height: 1px;width: 100%;background-color: #CA1;"</span>
<span class="c1">// &gt;&lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">myDiv</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">divStyle</span> <span class="o">=</span> <span class="nx">myDiv</span><span class="p">.</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">divStyle</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 3</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">myDiv</code>元素的行内样式共包含3条样式规则。</p>

<h5 id="3cssstyledeclarationparentrule-返回当前规则所属的那个样式块">（3）CSSStyleDeclaration.parentRule 返回当前规则所属的那个样式块</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.parentRule</code>属性<strong>返回当前规则所属的那个样式块</strong>（CSSRule 实例）。如果不存在所属的样式块，该属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<p>该属性只读，且只在使用 CSSRule 接口时有意义。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">declaration</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">rules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">declaration</span><span class="p">.</span><span class="nx">parentRule</span> <span class="o">===</span> <span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">rules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">// true</span>
</code></pre></div></div>

<h4 id="23-cssstyledeclaration-实例方法">2.3 CSSStyleDeclaration 实例方法</h4>

<h5 id="1cssstyledeclarationgetpropertypriority-指定样式有没有设置important优先级">（1）CSSStyleDeclaration.getPropertyPriority() 指定样式有没有设置important优先级</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.getPropertyPriority</code>方法<strong>接受 CSS 样式的属性名作为参数，返回一个字符串，表示有没有设置<code class="language-plaintext highlighter-rouge">important</code>优先级。如果有就返回<code class="language-plaintext highlighter-rouge">important</code>，否则返回空字符串。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="myDiv" style="margin: 10px!important; color: red;"/&gt;</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">margin</span> <span class="c1">// "10px"</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">getPropertyPriority</span><span class="p">(</span><span class="dl">'</span><span class="s1">margin</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// "important"</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">getPropertyPriority</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// ""</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">margin</code>属性有<code class="language-plaintext highlighter-rouge">important</code>优先级，<code class="language-plaintext highlighter-rouge">color</code>属性没有。</p>

<h5 id="2cssstyledeclarationgetpropertyvalue-返回指定样式的值">（2）CSSStyleDeclaration.getPropertyValue() 返回指定样式的值</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.getPropertyValue</code>方法<strong>接受 CSS 样式属性名作为参数，返回一个字符串，表示该属性的属性值。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="myDiv" style="margin: 10px!important; color: red;"/&gt;</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">margin</span> <span class="c1">// "10px"</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="dl">"</span><span class="s2">margin</span><span class="dl">"</span><span class="p">)</span> <span class="c1">// "10px"</span>
</code></pre></div></div>

<h5 id="3cssstyledeclarationitem-返回指定位置的css属性名">（3）CSSStyleDeclaration.item() 返回指定位置的CSS属性名</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.item</code>方法<strong>接受一个整数值作为参数，返回该位置的 CSS 属性名</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="myDiv" style="color: red; background-color: white;"/&gt;</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="c1">// "color"</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">item</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="c1">// "background-color"</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">0</code>号位置的 CSS 属性名是<code class="language-plaintext highlighter-rouge">color</code>，<code class="language-plaintext highlighter-rouge">1</code>号位置的 CSS 属性名是<code class="language-plaintext highlighter-rouge">background-color</code>。</p>

<p>如果没有提供参数，这个方法会报错。如果参数值超过实际的属性数目，这个方法返回一个空字符值。</p>

<h5 id="4cssstyledeclarationremoveproperty-移除指定css属性并返回原来的值">（4）CSSStyleDeclaration.removeProperty() 移除指定CSS属性，并返回原来的值</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.removeProperty</code>方法<strong>接受一个属性名作为参数，在 CSS 规则里面移除这个属性，返回这个属性原来的值。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="myDiv" style="color: red; background-color: white;"&gt;</span>
<span class="c1">//   111</span>
<span class="c1">// &lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// 'red'</span>
<span class="c1">// HTML 代码变为</span>
<span class="c1">// &lt;div id="myDiv" style="background-color: white;"&gt;</span>
</code></pre></div></div>

<p>上面代码中，删除<code class="language-plaintext highlighter-rouge">color</code>属性以后，字体颜色从红色变成默认颜色。</p>

<h5 id="5cssstyledeclarationsetproperty-设置新的-css-属性">（5）CSSStyleDeclaration.setProperty() 设置新的 CSS 属性</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleDeclaration.setProperty</code>方法用来<strong>设置新的 CSS 属性</strong>。该方法没有返回值。</p>

<p>该方法可以接受三个参数。</p>

<ul>
  <li>第一个参数：属性名，该参数是必需的。</li>
  <li>第二个参数：属性值，该参数可选。如果省略，则参数值默认为空字符串。</li>
  <li>第三个参数：优先级，该参数可选。如果设置，唯一的合法值是<code class="language-plaintext highlighter-rouge">important</code>，表示 CSS 规则里面的<code class="language-plaintext highlighter-rouge">!important</code>。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;div id="myDiv" style="color: red; background-color: white;"&gt;</span>
<span class="c1">//   111</span>
<span class="c1">// &lt;/div&gt;</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myDiv</span><span class="dl">'</span><span class="p">).</span><span class="nx">style</span><span class="p">;</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">border</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">1px solid blue</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码执行后，<code class="language-plaintext highlighter-rouge">myDiv</code>元素就会出现蓝色的边框。</p>

<h3 id="3css-模块的侦测判断浏览器是否支持某个样式">3、CSS 模块的侦测（判断浏览器是否支持某个样式）</h3>

<p>CSS 的规格发展太快，新的模块层出不穷。不同浏览器的不同版本，对 CSS 模块的支持情况都不一样。有时候，<strong>需要知道当前浏览器是否支持某个模块，这就叫做“CSS模块的侦测”。</strong></p>

<p><strong>判断浏览器是否支持某个样式</strong></p>

<p>一个比较普遍适用的方法是，判断元素的<code class="language-plaintext highlighter-rouge">style</code>对象的某个属性值是否为字符串。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">typeof</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">animationName</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">;</span>
<span class="k">typeof</span> <span class="nx">element</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<p>如果该 CSS 属性确实存在，会返回一个字符串。即使该属性实际上并未设置，也会返回一个空字符串。如果该属性不存在，则会返回<code class="language-plaintext highlighter-rouge">undefined</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="dl">'</span><span class="s1">maxWidth</span><span class="dl">'</span><span class="p">]</span> <span class="c1">// ""</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="dl">'</span><span class="s1">maximumWidth</span><span class="dl">'</span><span class="p">]</span> <span class="c1">// undefined</span>
</code></pre></div></div>

<p>上面代码说明，这个浏览器支持<code class="language-plaintext highlighter-rouge">max-width</code>属性，但是不支持<code class="language-plaintext highlighter-rouge">maximum-width</code>属性。</p>

<p>注意，不管 CSS 属性名的写法带不带连词线，<code class="language-plaintext highlighter-rouge">style</code>属性上都能反映出该属性是否存在。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="dl">'</span><span class="s1">backgroundColor</span><span class="dl">'</span><span class="p">]</span> <span class="c1">// ""</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="dl">'</span><span class="s1">background-color</span><span class="dl">'</span><span class="p">]</span> <span class="c1">// ""</span>
</code></pre></div></div>

<p>另外，使用的时候，需要把不同浏览器的 CSS 前缀也考虑进去。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">content</span><span class="dl">'</span><span class="p">);</span>
<span class="k">typeof</span> <span class="nx">content</span><span class="p">.</span><span class="nx">style</span><span class="p">[</span><span class="dl">'</span><span class="s1">webkitAnimation</span><span class="dl">'</span><span class="p">]</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span>
</code></pre></div></div>

<p><strong>这种侦测方法可以写成一个函数。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">isPropertySupported</span><span class="p">(</span><span class="nx">property</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">property</span> <span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="dl">'</span><span class="s1">Moz</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Webkit</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">O</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">ms</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">Khtml</span><span class="dl">'</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">prefProperty</span> <span class="o">=</span> <span class="nx">property</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">property</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

  <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">prefixes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="k">if</span><span class="p">((</span><span class="nx">prefixes</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">prefProperty</span><span class="p">)</span> <span class="k">in</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">)</span> <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">isPropertySupported</span><span class="p">(</span><span class="dl">'</span><span class="s1">background-clip</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// true</span>
</code></pre></div></div>

<h3 id="4原生css-对象">4、原生CSS 对象</h3>

<p><strong>浏览器原生提供 CSS 对象，为 JavaScript 操作 CSS 提供一些工具方法。</strong></p>

<p>这个对象目前有两个静态方法。</p>

<h4 id="41-cssescape-转义css选择器里的特殊字符">4.1 CSS.escape() 转义CSS选择器里的特殊字符</h4>

<p><code class="language-plaintext highlighter-rouge">CSS.escape</code>方法<strong>用于转义 CSS 选择器里面的特殊字符。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">foo#bar</span><span class="dl">"</span><span class="o">&gt;</span>
</code></pre></div></div>

<p>上面代码中，该元素的<code class="language-plaintext highlighter-rouge">id</code>属性包含一个<code class="language-plaintext highlighter-rouge">#</code>号，该字符在 CSS 选择器里面有特殊含义。不能直接写成<code class="language-plaintext highlighter-rouge">document.querySelector('#foo#bar')</code>，只能写成<code class="language-plaintext highlighter-rouge">document.querySelector('#foo\\#bar')</code>。这里必须使用双斜杠的原因是，单引号字符串本身会转义一次斜杠。</p>

<p><code class="language-plaintext highlighter-rouge">CSS.escape</code>方法就用来转义那些特殊字符。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">CSS</span><span class="p">.</span><span class="nx">escape</span><span class="p">(</span><span class="dl">'</span><span class="s1">foo#bar</span><span class="dl">'</span><span class="p">))</span>
<span class="c1">//CSS.escape('foo#bar')转义成foo\#bar</span>
</code></pre></div></div>

<h4 id="42-csssupports-当前环境是否支持某一句-css-规则">4.2 CSS.supports() 当前环境是否支持某一句 CSS 规则</h4>

<p><code class="language-plaintext highlighter-rouge">CSS.supports</code>方法<strong>返回一个布尔值，表示当前环境是否支持某一句 CSS 规则</strong>。</p>

<p>它的参数有两种写法，一种是第一个参数是属性名，第二个参数是属性值；另一种是整个参数就是一行完整的 CSS 语句。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 第一种写法</span>
<span class="nx">CSS</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="dl">'</span><span class="s1">transform-origin</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">5px</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// true</span>

<span class="c1">// 第二种写法</span>
<span class="nx">CSS</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="dl">'</span><span class="s1">display: table-cell</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>注意，第二种写法的参数结尾不能带有分号，否则结果不准确。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">CSS</span><span class="p">.</span><span class="nx">supports</span><span class="p">(</span><span class="dl">'</span><span class="s1">display: table-cell;</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// false</span>
</code></pre></div></div>

<h3 id="5windowgetcomputedstyle-返回元素最终样式">5、window.getComputedStyle() 返回元素最终样式</h3>

<p>行内样式（inline style）具有最高的优先级，改变行内样式，通常会立即反映出来。但是，网页元素最终的样式是综合各种规则计算出来的。因此，如果想得到元素实际的样式，只读取行内样式是不够的，需要得到浏览器最终计算出来的样式规则。</p>

<p><code class="language-plaintext highlighter-rouge">window.getComputedStyle</code>方法，就用来<strong>返回浏览器计算后得到的最终样式规则</strong>。它接受一个元素节点对象作为参数，返回一个 CSSStyleDeclaration 实例，包含了指定节点的最终样式信息。所谓“最终样式信息”，指的是各种 CSS 规则叠加后的结果。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">styleObj</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">div</span><span class="p">);</span>
<span class="nx">styleObj</span><span class="p">.</span><span class="nx">backgroundColor</span>
</code></pre></div></div>

<p>上面代码中，得到的背景色就是<code class="language-plaintext highlighter-rouge">div</code>元素真正的背景色。</p>

<p>注意，CSSStyleDeclaration 实例是一个<strong>活的对象</strong>，任何对于样式的修改，会实时反映到这个实例上面。另外，这个实例是<strong>只读的</strong>。</p>

<p><code class="language-plaintext highlighter-rouge">getComputedStyle</code>方法还可以接受第二个参数，表示当前元素的伪元素（比如<code class="language-plaintext highlighter-rouge">:before</code>、<code class="language-plaintext highlighter-rouge">:after</code>、<code class="language-plaintext highlighter-rouge">:first-line</code>、<code class="language-plaintext highlighter-rouge">:first-letter</code>等）。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">div</span><span class="p">,</span> <span class="dl">'</span><span class="s1">:before</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>下面的例子是如何获取元素的高度。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">elem</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">elem-container</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">styleObj</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">elem</span><span class="p">,</span> <span class="kc">null</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">styleObj</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span> <span class="c1">// 得到元素最终渲染出来的高度，最可靠</span>
<span class="c1">// 等同于</span>
<span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">styleObj</span><span class="p">[</span><span class="dl">'</span><span class="s1">height</span><span class="dl">'</span><span class="p">];</span>
<span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">styleObj</span><span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">height</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码得到的<code class="language-plaintext highlighter-rouge">height</code>属性，是浏览器最终渲染出来的高度，比其他方法得到的高度更可靠。由于<code class="language-plaintext highlighter-rouge">styleObj</code>是 CSSStyleDeclaration 实例，所以可以使用各种 CSSStyleDeclaration 的实例属性和方法。</p>

<p>有几点需要注意。</p>

<ul>
  <li>CSSStyleDeclaration 实例返回的 CSS 值都是绝对单位。比如，<strong>长度都是像素单位</strong>（返回值包括<code class="language-plaintext highlighter-rouge">px</code>后缀），<strong>颜色是<code class="language-plaintext highlighter-rouge">rgb(#, #, #)</code>或<code class="language-plaintext highlighter-rouge">rgba(#, #, #, #)</code>格式</strong>。</li>
  <li>CSS 规则的<strong>简写形式无效</strong>。比如，想读取<code class="language-plaintext highlighter-rouge">margin</code>属性的值，不能直接读，只能读<code class="language-plaintext highlighter-rouge">marginLeft</code>、<code class="language-plaintext highlighter-rouge">marginTop</code>等属性；再比如，<code class="language-plaintext highlighter-rouge">font</code>属性也是不能直接读的，只能读<code class="language-plaintext highlighter-rouge">font-size</code>等单个属性。</li>
  <li>如果读取 CSS 原始的属性名，要用方括号运算符，比如<code class="language-plaintext highlighter-rouge">styleObj['z-index']</code>；如果读取骆驼拼写法的 CSS 属性名，可以直接读取<code class="language-plaintext highlighter-rouge">styleObj.zIndex</code>。</li>
  <li>该方法返回的 CSSStyleDeclaration 实例的<code class="language-plaintext highlighter-rouge">cssText</code>属性无效，返回<code class="language-plaintext highlighter-rouge">undefined</code>。</li>
</ul>

<h3 id="6css-伪元素样式的获取">6、CSS 伪元素样式的获取</h3>

<p>CSS 伪元素是通过 CSS 向 DOM 添加的元素，主要是通过<code class="language-plaintext highlighter-rouge">:before</code>和<code class="language-plaintext highlighter-rouge">:after</code>选择器生成，然后用<code class="language-plaintext highlighter-rouge">content</code>属性指定伪元素的内容。</p>

<p>下面是一段 HTML 代码。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"test"</span><span class="nt">&gt;</span>Test content<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>CSS 添加伪元素<code class="language-plaintext highlighter-rouge">:before</code>的写法如下。</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">#test</span><span class="nd">:before</span> <span class="p">{</span>
  <span class="nl">content</span><span class="p">:</span> <span class="s2">'Before '</span><span class="p">;</span>
  <span class="nl">color</span><span class="p">:</span> <span class="m">#FF0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><strong>节点元素的<code class="language-plaintext highlighter-rouge">style</code>对象无法读写伪元素的样式，这时就要用到<code class="language-plaintext highlighter-rouge">window.getComputedStyle()</code></strong>。JavaScript 获取伪元素，可以使用下面的方法。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#test</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">test</span><span class="p">,</span> <span class="dl">'</span><span class="s1">:before</span><span class="dl">'</span><span class="p">).</span><span class="nx">content</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">test</span><span class="p">,</span> <span class="dl">'</span><span class="s1">:before</span><span class="dl">'</span><span class="p">).</span><span class="nx">color</span><span class="p">;</span>
</code></pre></div></div>

<p>此外，<strong>也可以使用 CSSStyleDeclaration 实例的<code class="language-plaintext highlighter-rouge">getPropertyValue</code>方法</strong>，获取伪元素的属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">test</span><span class="p">,</span> <span class="dl">'</span><span class="s1">:before</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">content</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">color</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">test</span><span class="p">,</span> <span class="dl">'</span><span class="s1">:before</span><span class="dl">'</span><span class="p">)</span>
  <span class="p">.</span><span class="nx">getPropertyValue</span><span class="p">(</span><span class="dl">'</span><span class="s1">color</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="7stylesheet-接口">7、StyleSheet 接口</h3>

<h4 id="71-概述">7.1 概述</h4>

<p><code class="language-plaintext highlighter-rouge">StyleSheet</code>接口代表网页的一张样式表，包括<code class="language-plaintext highlighter-rouge"> &lt;link&gt; </code>元素加载的样式表和<code class="language-plaintext highlighter-rouge">  &lt;style&gt;  </code>元素内嵌的样式表。</p>

<p><strong><code class="language-plaintext highlighter-rouge">document</code>对象的<code class="language-plaintext highlighter-rouge">styleSheets</code>属性</strong>，可以返回当前页面的所有<code class="language-plaintext highlighter-rouge">StyleSheet</code>实例（即<strong>所有样式表</strong>）。它是一个<strong>类似数组的对象</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">sheets</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">sheet</span> <span class="k">instanceof</span> <span class="nx">StyleSheet</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>如果是<code class="language-plaintext highlighter-rouge">  &lt;style&gt;  </code>元素嵌入的样式表，还有<strong>另一种获取<code class="language-plaintext highlighter-rouge">StyleSheet</code>实例的方法</strong>，就是这个节点元素的<code class="language-plaintext highlighter-rouge">sheet</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为 &lt;style id="myStyle"&gt;&lt;/style&gt;</span>
<span class="kd">var</span> <span class="nx">myStyleSheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myStyle</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span><span class="c1">// 另一种获取styleSheet方式</span>
<span class="nx">myStyleSheet</span> <span class="k">instanceof</span> <span class="nx">StyleSheet</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>严格地说，<code class="language-plaintext highlighter-rouge">StyleSheet</code>接口不仅包括网页样式表，还包括 XML 文档的样式表。所以，<strong>它有一个子类<code class="language-plaintext highlighter-rouge">CSSStyleSheet</code></strong>表示网页的 CSS 样式表。我们在网页里面拿到的样式表实例，实际上是<code class="language-plaintext highlighter-rouge">CSSStyleSheet</code>的实例。这个<strong>子接口继承了<code class="language-plaintext highlighter-rouge">StyleSheet</code>的所有属性和方法</strong>，<strong>并且定义了几个自己的属性</strong>，下面把这两个接口放在一起介绍。</p>

<h4 id="72-实例属性">7.2 实例属性</h4>

<p><code class="language-plaintext highlighter-rouge">StyleSheet</code>实例有以下属性。</p>

<h5 id="1stylesheetdisabled-样式表是否处于禁用状态可读写">（1）StyleSheet.disabled 样式表是否处于禁用状态，可读写</h5>

<p><code class="language-plaintext highlighter-rouge">StyleSheet.disabled</code>返回一个布尔值，表示该样式表是否处于禁用状态。手动设置<code class="language-plaintext highlighter-rouge">disabled</code>属性为<code class="language-plaintext highlighter-rouge">true</code>，等同于在<code class="language-plaintext highlighter-rouge"> &lt;link&gt; </code>元素里面，将这张样式表设为<code class="language-plaintext highlighter-rouge">alternate stylesheet</code>，即该样式表将不会生效。</p>

<p>注意，<code class="language-plaintext highlighter-rouge">disabled</code>属性只能在 JavaScript 脚本中设置，不能在 HTML 语句中设置。</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"alternate stylesheet"</span> <span class="na">href=</span><span class="s">"style.css"</span><span class="nt">&gt;</span>
<span class="c">&lt;!--设置了alternate stylesheet表示禁用此样式表--&gt;</span>

<span class="nt">&lt;style&gt;</span>
    <span class="nt">body</span><span class="p">{</span><span class="nl">font-size</span><span class="p">:</span> <span class="m">16px</span><span class="p">;}</span>
<span class="nt">&lt;/style&gt;</span>

 <span class="nt">&lt;script&gt;</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">)</span>

     <span class="cm">/*
     StyleSheetList {}
		0: CSSStyleSheet {ownerRule: null, type: "text/css", href: 		"file:///C:/Users/dell/Desktop/css.css", ownerNode: link, parentStyleSheet: null, …}
		1: CSSStyleSheet {ownerRule: null, cssRules: CSSRuleList, rules: CSSRuleList, type: "text/css", href: null, …}
		length: 2
     */</span>

     <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">disabled</span><span class="p">)</span> <span class="c1">// false 未禁用？不能判断样式表设置了alternate？</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">disabled</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">disabled</span><span class="p">)</span> <span class="c1">// true 已禁用</span>
 <span class="nt">&lt;/script&gt;</span>
</code></pre></div></div>

<h5 id="2stylesheethref--返回样式表的网址">（2）Stylesheet.href  返回样式表的网址</h5>

<p><code class="language-plaintext highlighter-rouge">Stylesheet.href</code><strong>返回样式表的网址</strong>。对于内嵌样式表，该属性返回<code class="language-plaintext highlighter-rouge">null</code>。该属性<strong>只读</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">href</span>
</code></pre></div></div>

<h5 id="3stylesheetmedia-返回一个媒介类数组">（3）StyleSheet.media 返回一个媒介类数组</h5>

<p><code class="language-plaintext highlighter-rouge">StyleSheet.media</code>属性<strong>返回一个类似数组的对象（<code class="language-plaintext highlighter-rouge">MediaList</code>实例），成员是表示适用媒介的字符串。</strong>表示当前样式表是用于屏幕（screen），还是用于打印（print）或手持设备（handheld），或各种媒介都适用（all）。该属性只读，默认值是<code class="language-plaintext highlighter-rouge">screen</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">media</span><span class="p">.</span><span class="nx">mediaText</span>
<span class="c1">// "all"</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">MediaList</code>实例的<code class="language-plaintext highlighter-rouge">appendMedium</code>方法，用于增加媒介；<code class="language-plaintext highlighter-rouge">deleteMedium</code>方法用于删除媒介。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">media</span><span class="p">.</span><span class="nx">appendMedium</span><span class="p">(</span><span class="dl">'</span><span class="s1">handheld</span><span class="dl">'</span><span class="p">);</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">media</span><span class="p">.</span><span class="nx">deleteMedium</span><span class="p">(</span><span class="dl">'</span><span class="s1">print</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div></div>

<h5 id="4stylesheettitle-返回样式表的title属性">（4）StyleSheet.title 返回样式表的<code class="language-plaintext highlighter-rouge">title</code>属性</h5>

<p><code class="language-plaintext highlighter-rouge">StyleSheet.title</code>属性返回样式表的<code class="language-plaintext highlighter-rouge">title</code>属性。</p>

<h5 id="5stylesheettype-返回样式表的type属性">（5）StyleSheet.type 返回样式表的<code class="language-plaintext highlighter-rouge">type</code>属性</h5>

<p><code class="language-plaintext highlighter-rouge">StyleSheet.type</code>属性返回样式表的<code class="language-plaintext highlighter-rouge">type</code>属性，通常是<code class="language-plaintext highlighter-rouge">text/css</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">type</span>  <span class="c1">// "text/css"</span>
</code></pre></div></div>

<h5 id="6stylesheetparentstylesheet-返回父样式表当前样式表是通过import加载才有值否则null">（6）StyleSheet.parentStyleSheet 返回父样式表，当前样式表是通过@import加载才有值，否则null</h5>

<p>CSS 的<code class="language-plaintext highlighter-rouge">@import</code>命令允许在样式表中加载其他样式表。<code class="language-plaintext highlighter-rouge">StyleSheet.parentStyleSheet</code>属性<strong>返回包含了当前样式表的那张样式表</strong>。如果当前样式表是顶层样式表，则该属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">stylesheet</span><span class="p">.</span><span class="nx">parentStyleSheet</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">stylesheet</span><span class="p">.</span><span class="nx">parentStyleSheet</span><span class="p">;</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">stylesheet</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="7stylesheetownernode-返回样式表所在的dom节点">（7）StyleSheet.ownerNode 返回样式表所在的DOM节点</h5>

<p><code class="language-plaintext highlighter-rouge">StyleSheet.ownerNode</code>属性<strong>返回<code class="language-plaintext highlighter-rouge">StyleSheet</code>对象所在的 DOM 节点，通常是<code class="language-plaintext highlighter-rouge"> &lt;link&gt; </code>或<code class="language-plaintext highlighter-rouge">  &lt;style&gt;  </code></strong>。对于那些由其他样式表引用的样式表，该属性为<code class="language-plaintext highlighter-rouge">null</code>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML代码为</span>
<span class="c1">// &lt;link rel="StyleSheet" href="example.css" type="text/css" /&gt;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">ownerNode</span> <span class="c1">// [object HTMLLinkElement]</span>
</code></pre></div></div>

<h5 id="8cssstylesheetcssrules-返回一个包含所有css规则的类数组">（8）CSSStyleSheet.cssRules 返回一个包含所有css规则的类数组</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleSheet.cssRules</code>属性<strong>指向一个类似数组的对象（<code class="language-plaintext highlighter-rouge">CSSRuleList</code>实例），里面每一个成员就是当前样式表的一条 CSS 规则。</strong>使用该规则的<code class="language-plaintext highlighter-rouge">cssText</code>属性，可以得到 CSS 规则对应的字符串。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#styleElement</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>

<span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">cssText</span>
<span class="c1">// "body { background-color: red; margin: 20px; }"</span>

<span class="nx">sheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">cssText</span>
<span class="c1">// "p { line-height: 1.4em; color: blue; }"</span>
</code></pre></div></div>

<p>每条 CSS 规则还有一个<code class="language-plaintext highlighter-rouge">style</code>属性，指向一个对象，用来<strong>读写具体的 CSS 命令</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cssStyleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">red</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">cssStyleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">purple</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div></div>

<h5 id="9cssstylesheetownerrule-规则所有者">（9）CSSStyleSheet.ownerRule 规则所有者</h5>

<p>有些样式表是通过<code class="language-plaintext highlighter-rouge">@import</code>规则输入的，它的<code class="language-plaintext highlighter-rouge">ownerRule</code>属性会返回一个<code class="language-plaintext highlighter-rouge">CSSRule</code>实例，代表那行<code class="language-plaintext highlighter-rouge">@import</code>规则。如果当前样式表不是通过<code class="language-plaintext highlighter-rouge">@import</code>引入的，<code class="language-plaintext highlighter-rouge">ownerRule</code>属性返回<code class="language-plaintext highlighter-rouge">null</code>。</p>

<h4 id="73-实例方法">7.3 实例方法</h4>

<h5 id="1cssstylesheetinsertrule-插入css规则">（1）CSSStyleSheet.insertRule() 插入css规则</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleSheet.insertRule</code>方法用于<strong>在当前样式表的插入一个新的 CSS 规则</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">#styleElement</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>
<span class="nx">sheet</span><span class="p">.</span><span class="nx">insertRule</span><span class="p">(</span><span class="dl">'</span><span class="s1">#block { color: white }</span><span class="dl">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="nx">sheet</span><span class="p">.</span><span class="nx">insertRule</span><span class="p">(</span><span class="dl">'</span><span class="s1">p { color: red }</span><span class="dl">'</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<p>该方法可以接受两个参数，第一个参数是表示 CSS 规则的字符串，这里只能有一条规则，否则会报错。第二个参数是该规则在样式表的插入位置（从0开始），该参数可选，默认为0（即默认插在样式表的头部）。注意，如果插入位置大于现有规则的数目，会报错。</p>

<p>该方法的返回值是新插入规则的位置序号。</p>

<p>注意，浏览器对脚本在样式表里面插入规则有很多<a href="https://drafts.csswg.org/cssom/#insert-a-css-rule">限制</a>。所以，这个方法最好放在<code class="language-plaintext highlighter-rouge">try...catch</code>里使用。</p>

<h5 id="2cssstylesheetdeleterule-移除css规则">（2）CSSStyleSheet.deleteRule() 移除css规则</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleSheet.deleteRule</code>方法用来在样式表里面移除一条规则，它的参数是该条规则在<code class="language-plaintext highlighter-rouge">cssRules</code>对象中的位置。该方法没有返回值。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">deleteRule</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="8实例添加样式表">8、实例：添加样式表</h3>

<p>网页添加样式表有两种方式。一种是添加一张内置样式表，即在文档中添加一个<code class="language-plaintext highlighter-rouge">  &lt;style&gt;  </code>节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 写法一</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">style</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">media</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">screen</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">body{color:red}</span><span class="dl">'</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>

<span class="c1">// 写法二</span>
<span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">style</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">style</span><span class="dl">'</span><span class="p">);</span>
  <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">style</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">style</span><span class="p">;</span>
<span class="p">})();</span>
<span class="nx">style</span><span class="p">.</span><span class="nx">sheet</span><span class="p">.</span><span class="nx">insertRule</span><span class="p">(</span><span class="dl">'</span><span class="s1">.foo{color:red;}</span><span class="dl">'</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span> <span class="c1">// 样式表插入规则</span>
</code></pre></div></div>

<p>另一种是添加外部样式表，即在文档中添加一个<code class="language-plaintext highlighter-rouge"> &lt;link&gt; </code>节点，然后将<code class="language-plaintext highlighter-rouge">href</code>属性指向外部样式表的 URL。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">linkElm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">link</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">linkElm</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">rel</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">stylesheet</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">linkElm</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/css</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">linkElm</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">href</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">reset-min.css</span><span class="dl">'</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">linkElm</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="9cssrulelist-接口">9、CSSRuleList 接口</h3>

<p>CSSRuleList 接口是<strong>一个类似数组的对象，表示一组 CSS 规则，成员都是 CSSRule 实例</strong>。</p>

<p>获取 CSSRuleList 实例，一般是通过<code class="language-plaintext highlighter-rouge">StyleSheet.cssRules</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;style id="myStyle"&gt;</span>
<span class="c1">//   h1 { color: red; }</span>
<span class="c1">//   p { color: blue; }</span>
<span class="c1">// &lt;/style&gt;</span>
<span class="kd">var</span> <span class="nx">myStyleSheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myStyle</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">crl</span> <span class="o">=</span> <span class="nx">myStyleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">;</span>
<span class="nx">crl</span> <span class="k">instanceof</span> <span class="nx">CSSRuleList</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>CSSRuleList 实例里面，每一条规则（CSSRule 实例）可以通过<code class="language-plaintext highlighter-rouge">rules.item(index)</code>或者<code class="language-plaintext highlighter-rouge">rules[index]</code>拿到。CSS 规则的条数通过<code class="language-plaintext highlighter-rouge">rules.length</code>拿到。还是用上面的例子。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">crl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">CSSRule</span> <span class="c1">// true</span>
<span class="nx">crl</span><span class="p">.</span><span class="nx">length</span> <span class="c1">// 2</span>
</code></pre></div></div>

<p>注意，添加规则和删除规则不能在 CSSRuleList 实例操作，而要在它的父元素 StyleSheet 实例上，通过<code class="language-plaintext highlighter-rouge">StyleSheet.insertRule()</code>和<code class="language-plaintext highlighter-rouge">StyleSheet.deleteRule()</code>操作。</p>

<h3 id="10cssrule-接口">10、CSSRule 接口</h3>

<h4 id="101-概述">10.1 概述</h4>

<p>一条 CSS 规则包括两个部分：CSS 选择器和样式声明。下面就是一条典型的 CSS 规则。</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.myClass</span> <span class="p">{</span>
  <span class="nl">color</span><span class="p">:</span> <span class="no">red</span><span class="p">;</span>
  <span class="nl">background-color</span><span class="p">:</span> <span class="no">yellow</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>JavaScript <strong>通过 CSSRule 接口操作 CSS 规则</strong>。一般通过 CSSRuleList 接口（<code class="language-plaintext highlighter-rouge">StyleSheet.cssRules</code>）获取 CSSRule 实例。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;style id="myStyle"&gt;</span>
<span class="c1">//   .myClass {</span>
<span class="c1">//     color: red;</span>
<span class="c1">//     background-color: yellow;</span>
<span class="c1">//   }</span>
<span class="c1">// &lt;/style&gt;</span>
<span class="kd">var</span> <span class="nx">myStyleSheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myStyle</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ruleList</span> <span class="o">=</span> <span class="nx">myStyleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">rule</span> <span class="o">=</span> <span class="nx">ruleList</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">rule</span> <span class="k">instanceof</span> <span class="nx">CSSRule</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="102-cssrule-实例的属性">10.2 CSSRule 实例的属性</h4>

<h5 id="1cssrulecsstext">（1）CSSRule.cssText</h5>

<p><code class="language-plaintext highlighter-rouge">CSSRule.cssText</code>属性<strong>返回当前规则的文本</strong>，还是使用上面的例子。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">rule</span><span class="p">.</span><span class="nx">cssText</span>
<span class="c1">// ".myClass { color: red; background-color: yellow; }"</span>
</code></pre></div></div>

<p>如果规则是加载（<code class="language-plaintext highlighter-rouge">@import</code>）其他样式表，<code class="language-plaintext highlighter-rouge">cssText</code>属性返回<code class="language-plaintext highlighter-rouge">@import 'url'</code>。</p>

<h5 id="2cssruleparentstylesheet">（2）CSSRule.parentStyleSheet</h5>

<p><code class="language-plaintext highlighter-rouge">CSSRule.parentStyleSheet</code>属性<strong>返回当前规则所在的样式表对象（StyleSheet 实例）</strong>，还是使用上面的例子。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">rule</span><span class="p">.</span><span class="nx">parentStyleSheet</span> <span class="o">===</span> <span class="nx">myStyleSheet</span> <span class="c1">// true</span>
</code></pre></div></div>

<h5 id="3cssruleparentrule">（3）CSSRule.parentRule</h5>

<p><code class="language-plaintext highlighter-rouge">CSSRule.parentRule</code>属性<strong>返回包含当前规则的父规则，如果不存在父规则（即当前规则是顶层规则），则返回<code class="language-plaintext highlighter-rouge">null</code>。</strong></p>

<p>父规则最常见的情况是，当前规则包含在<code class="language-plaintext highlighter-rouge">@media</code>规则代码块之中。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;style id="myStyle"&gt;</span>
<span class="c1">//   @supports (display: flex) {</span>
<span class="c1">//     @media screen and (min-width: 900px) {</span>
<span class="c1">//       article {</span>
<span class="c1">//         display: flex;</span>
<span class="c1">//       }</span>
<span class="c1">//     }</span>
<span class="c1">//  }</span>
<span class="c1">// &lt;/style&gt;</span>
<span class="kd">var</span> <span class="nx">myStyleSheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myStyle</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">ruleList</span> <span class="o">=</span> <span class="nx">myStyleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">rule0</span> <span class="o">=</span> <span class="nx">ruleList</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">rule0</span><span class="p">.</span><span class="nx">cssText</span>
<span class="c1">// "@supports (display: flex) {</span>
<span class="c1">//    @media screen and (min-width: 900px) {</span>
<span class="c1">//      article { display: flex; }</span>
<span class="c1">//    }</span>
<span class="c1">// }"</span>

<span class="c1">// 由于这条规则内嵌其他规则，</span>
<span class="c1">// 所以它有 cssRules 属性，且该属性是 CSSRuleList 实例</span>
<span class="nx">rule0</span><span class="p">.</span><span class="nx">cssRules</span> <span class="k">instanceof</span> <span class="nx">CSSRuleList</span> <span class="c1">// true</span>

<span class="kd">var</span> <span class="nx">rule1</span> <span class="o">=</span> <span class="nx">rule0</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">rule1</span><span class="p">.</span><span class="nx">cssText</span>
<span class="c1">// "@media screen and (min-width: 900px) {</span>
<span class="c1">//   article { display: flex; }</span>
<span class="c1">// }"</span>

<span class="kd">var</span> <span class="nx">rule2</span> <span class="o">=</span> <span class="nx">rule1</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">rule2</span><span class="p">.</span><span class="nx">cssText</span>
<span class="c1">// "article { display: flex; }"</span>

<span class="nx">rule1</span><span class="p">.</span><span class="nx">parentRule</span> <span class="o">===</span> <span class="nx">rule0</span> <span class="c1">// true</span>
<span class="nx">rule2</span><span class="p">.</span><span class="nx">parentRule</span> <span class="o">===</span> <span class="nx">rule1</span> <span class="c1">// true</span>
</code></pre></div></div>

<h5 id="4cssruletype">（4）CSSRule.type</h5>

<p><code class="language-plaintext highlighter-rouge">CSSRule.type</code>属性<strong>返回一个整数值，表示当前规则的类型</strong>。</p>

<p>最常见的类型有以下几种。</p>

<ul>
  <li>1：普通样式规则（CSSStyleRule 实例）</li>
  <li>3：<code class="language-plaintext highlighter-rouge">@import</code>规则</li>
  <li>4：<code class="language-plaintext highlighter-rouge">@media</code>规则（CSSMediaRule 实例）</li>
  <li>5：<code class="language-plaintext highlighter-rouge">@font-face</code>规则</li>
</ul>

<h4 id="103-cssstylerule-接口">10.3 CSSStyleRule 接口</h4>

<p><strong>如果一条 CSS 规则是普通的样式规则（不含特殊的 CSS 命令），那么除了 CSSRule 接口，它还部署了 CSSStyleRule 接口。</strong></p>

<p>CSSStyleRule 接口有以下两个属性。</p>

<h5 id="1cssstyleruleselectortext">（1）CSSStyleRule.selectorText</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleRule.selectorText</code>属性<strong>返回当前规则的选择器</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">stylesheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">styleSheets</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="nx">stylesheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">selectorText</span> <span class="c1">// ".myClass"</span>
</code></pre></div></div>

<p>注意，这个属性是<strong>可写的</strong>。</p>

<h5 id="2cssstylerulestyle">（2）CSSStyleRule.style</h5>

<p><code class="language-plaintext highlighter-rouge">CSSStyleRule.style</code>属性<strong>返回一个对象（CSSStyleDeclaration 实例），代表当前规则的样式声明，也就是选择器后面的大括号里面的部分。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码为</span>
<span class="c1">// &lt;style id="myStyle"&gt;</span>
<span class="c1">//   p { color: red; }</span>
<span class="c1">// &lt;/style&gt;</span>
<span class="kd">var</span> <span class="nx">styleSheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myStyle</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>
<span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span> <span class="k">instanceof</span> <span class="nx">CSSStyleDeclaration</span>
<span class="c1">// true</span>
</code></pre></div></div>

<p>CSSStyleDeclaration 实例的<code class="language-plaintext highlighter-rouge">cssText</code>属性，可以返回所有样式声明，格式为字符串。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">cssText</span>
<span class="c1">// "color: red;"</span>
<span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">selectorText</span>
<span class="c1">// "p"</span>
</code></pre></div></div>

<h4 id="104-cssmediarule-接口">10.4 CSSMediaRule 接口</h4>

<p><strong>如果一条 CSS 规则是<code class="language-plaintext highlighter-rouge">@media</code>代码块，那么它除了 CSSRule 接口，还部署了 CSSMediaRule 接口。</strong></p>

<p>该接口主要提供<code class="language-plaintext highlighter-rouge">media</code>属性和<code class="language-plaintext highlighter-rouge">conditionText</code>属性。前者返回代表<code class="language-plaintext highlighter-rouge">@media</code>规则的一个对象（MediaList 实例），后者返回<code class="language-plaintext highlighter-rouge">@media</code>规则的生效条件。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// HTML 代码如下</span>
<span class="c1">// &lt;style id="myStyle"&gt;</span>
<span class="c1">//   @media screen and (min-width: 900px) {</span>
<span class="c1">//     article { display: flex; }</span>
<span class="c1">//   }</span>
<span class="c1">// &lt;/style&gt;</span>
<span class="kd">var</span> <span class="nx">styleSheet</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myStyle</span><span class="dl">'</span><span class="p">).</span><span class="nx">sheet</span><span class="p">;</span>
<span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">instanceof</span> <span class="nx">CSSMediaRule</span>
<span class="c1">// true</span>

<span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">media</span>
<span class="c1">//  {</span>
<span class="c1">//    0: "screen and (min-width: 900px)",</span>
<span class="c1">//    appendMedium: function,</span>
<span class="c1">//    deleteMedium: function,</span>
<span class="c1">//    item: function,</span>
<span class="c1">//    length: 1,</span>
<span class="c1">//    mediaText: "screen and (min-width: 900px)"</span>
<span class="c1">// }</span>

<span class="nx">styleSheet</span><span class="p">.</span><span class="nx">cssRules</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">conditionText</span>
<span class="c1">// "screen and (min-width: 900px)"</span>
</code></pre></div></div>

<h3 id="11windowmatchmedia">11、window.matchMedia()</h3>

<h4 id="111-基本用法">11.1 基本用法</h4>

<p><code class="language-plaintext highlighter-rouge">window.matchMedia</code>方法<strong>用来将 CSS 的<a href="https://developer.mozilla.org/en-US/docs/DOM/Using_media_queries_from_code"><code class="language-plaintext highlighter-rouge">MediaQuery</code></a>条件语句，转换成一个 MediaQueryList 实例</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mdl</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">'</span><span class="s1">(min-width: 400px)</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">mdl</span> <span class="k">instanceof</span> <span class="nx">MediaQueryList</span> <span class="c1">// true</span>
</code></pre></div></div>

<p>上面代码中，变量<code class="language-plaintext highlighter-rouge">mdl</code>就是 mediaQueryList 的实例。</p>

<p>注意，如果参数不是有效的<code class="language-plaintext highlighter-rouge">MediaQuery</code>条件语句，<code class="language-plaintext highlighter-rouge">window.matchMedia</code>不会报错，依然返回一个 MediaQueryList 实例。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">'</span><span class="s1">bad string</span><span class="dl">'</span><span class="p">)</span> <span class="k">instanceof</span> <span class="nx">MediaQueryList</span> <span class="c1">// true</span>
</code></pre></div></div>

<h4 id="112-mediaquerylist-接口的实例属性">11.2 MediaQueryList 接口的实例属性</h4>

<p>MediaQueryList 实例有三个属性。</p>

<h5 id="1mediaquerylistmedia">（1）MediaQueryList.media</h5>

<p><code class="language-plaintext highlighter-rouge">MediaQueryList.media</code>属性<strong>返回一个字符串，表示对应的 MediaQuery 条件语句</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mql</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">'</span><span class="s1">(min-width: 400px)</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">mql</span><span class="p">.</span><span class="nx">media</span> <span class="c1">// "(min-width: 400px)"</span>
</code></pre></div></div>

<h5 id="2mediaquerylistmatches">（2）MediaQueryList.matches</h5>

<p><code class="language-plaintext highlighter-rouge">MediaQueryList.matches</code>属性<strong>返回一个布尔值，表示当前页面是否符合指定的 MediaQuery 条件语句</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">'</span><span class="s1">(min-width: 400px)</span><span class="dl">'</span><span class="p">).</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
  <span class="cm">/* 当前视口不小于 400 像素 */</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
  <span class="cm">/* 当前视口小于 400 像素 */</span>
<span class="p">}</span>
</code></pre></div></div>

<p>下面的例子根据<code class="language-plaintext highlighter-rouge">mediaQuery</code>是否匹配当前环境，加载相应的 CSS 样式表。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">"</span><span class="s2">(max-width: 700px)</span><span class="dl">"</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">matches</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">linkElm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">link</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">linkElm</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">rel</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">stylesheet</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">linkElm</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/css</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">linkElm</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">href</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">small.css</span><span class="dl">'</span><span class="p">);</span>

  <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">linkElm</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h5 id="3mediaquerylistonchange">（3）MediaQueryList.onchange</h5>

<p><strong>如果 MediaQuery 条件语句的适配环境发生变化，会触发<code class="language-plaintext highlighter-rouge">change</code>事件</strong>。<code class="language-plaintext highlighter-rouge">MediaQueryList.onchange</code>属性用来指定<code class="language-plaintext highlighter-rouge">change</code>事件的监听函数。该函数的参数是<code class="language-plaintext highlighter-rouge">change</code>事件对象（MediaQueryListEvent 实例），该对象与 MediaQueryList 实例类似，也有<code class="language-plaintext highlighter-rouge">media</code>和<code class="language-plaintext highlighter-rouge">matches</code>属性。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mql</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">'</span><span class="s1">(max-width: 600px)</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">mql</span><span class="p">.</span><span class="nx">onchange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* 视口不超过 600 像素 */</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="cm">/* 视口超过 600 像素 */</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">change</code>事件发生后，存在两种可能。一种是显示宽度从700像素以上变为以下，另一种是从700像素以下变为以上，所以在监听函数内部要判断一下当前是哪一种情况。</p>

<h4 id="113-mediaquerylist-接口的实例方法">11.3 MediaQueryList 接口的实例方法</h4>

<p>MediaQueryList 实例有两个方法<code class="language-plaintext highlighter-rouge">MediaQueryList.addListener()</code>和<code class="language-plaintext highlighter-rouge">MediaQueryList.removeListener()</code>，<strong>用来为<code class="language-plaintext highlighter-rouge">change</code>事件添加或撤销监听函数</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">mql</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">matchMedia</span><span class="p">(</span><span class="dl">'</span><span class="s1">(max-width: 600px)</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// 指定监听函数</span>
<span class="nx">mql</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="nx">mqCallback</span><span class="p">);</span>

<span class="c1">// 撤销监听函数</span>
<span class="nx">mql</span><span class="p">.</span><span class="nx">removeListener</span><span class="p">(</span><span class="nx">mqCallback</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">mqCallback</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">matches</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* 视口不超过 600 像素 */</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="cm">/* 视口超过 600 像素 */</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">MediaQueryList.removeListener()</code>方法不能撤销<code class="language-plaintext highlighter-rouge">MediaQueryList.onchange</code>属性指定的监听函数。</p>

<h3 id="12本章小结">12、本章小结</h3>

<p>本章当中的实例（接口）有：</p>

<p><strong>CSSStyleDeclaration接口</strong>（css样式声明）： 用来操作元素的样式</p>

<p><strong>StyleSheet接口（样式表</strong>）： 代表网页的一张样式表，包括<code class="language-plaintext highlighter-rouge"> &lt;link&gt; </code>元素加载的样式表和<code class="language-plaintext highlighter-rouge">  &lt;style&gt;  </code>元素内嵌的样式表。</p>

<p><strong>CSSRuleList接口（css规则列表）</strong>： 一个类似数组的对象，表示一组 CSS 规则，成员都是 CSSRule 实例。</p>

<p><strong>CSSRule接口（css规则）</strong>： JavaScript 通过 CSSRule 接口操作 CSS 规则。一般通过 CSSRuleList 接口（<code class="language-plaintext highlighter-rouge">StyleSheet.cssRules</code>）获取 CSSRule 实例。</p>

<p><strong>CSSStyleRule接口</strong>： 如果一条 CSS 规则是普通的样式规则（不含特殊的 CSS 命令），那么除了 CSSRule 接口，它还部署了 CSSStyleRule 接口。</p>

<p><strong>CSSMediaRule 接口</strong>： 如果一条 CSS 规则是<code class="language-plaintext highlighter-rouge">@media</code>代码块，那么它除了 CSSRule 接口，还部署了 CSSMediaRule 接口。</p>

<h2 id="九mutation-observer-api-监视dom变动">九、Mutation Observer API 监视DOM变动</h2>

<h3 id="1概述-1">1、概述</h3>

<p>Mutation Observer API <strong>用来监视 DOM 变动</strong>。DOM 的任何变动，比如节点的增减、属性的变动、文本内容的变动，这个 API 都可以得到通知。</p>

<p>概念上，它很接近事件，<strong>可以理解为 DOM 发生变动就会触发 Mutation Observer 事件。但是，它与事件有一个本质不同：事件是同步触发，也就是说，DOM 的变动立刻会触发相应的事件；Mutation Observer 则是异步触发，DOM 的变动并不会马上触发，而是要等到当前所有 DOM 操作都结束才触发。</strong></p>

<p>这样设计是为了应付 DOM 变动频繁的特点。举例来说，如果文档中连续插入1000个<code class="language-plaintext highlighter-rouge">  &lt;p&gt;  </code>元素，就会连续触发1000个插入事件，执行每个事件的回调函数，这很可能造成浏览器的卡顿；而 Mutation Observer 完全不同，只在1000个段落都插入结束后才会触发，而且只触发一次。</p>

<p>Mutation Observer 有以下特点。</p>

<ul>
  <li><strong>它等待所有脚本任务完成后，才会运行（即异步触发方式）。</strong></li>
  <li><strong>它把 DOM 变动记录封装成一个数组进行处理，而不是一条条个别处理 DOM 变动。</strong></li>
  <li><strong>它既可以观察 DOM 的所有类型变动，也可以指定只观察某一类变动。</strong></li>
</ul>

<h3 id="2mutationobserver-构造函数-使用方式">2、MutationObserver 构造函数 (使用方式)</h3>

<p>使用时，<strong>首先使用<code class="language-plaintext highlighter-rouge">MutationObserver</code>构造函数，新建一个观察器实例，同时指定这个实例的回调函数。</strong></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中的回调函数，会在每次 DOM 变动后调用。该回调函数接受两个参数，第一个是变动数组，第二个是观察器实例，下面是一个例子。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">mutations</span><span class="p">,</span> <span class="nx">observer</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">mutations</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mutation</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mutation</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<h3 id="3mutationobserver-的实例方法">3、MutationObserver 的实例方法</h3>

<h4 id="31-observe">3.1 observe()</h4>

<p><code class="language-plaintext highlighter-rouge">observe</code>方法<strong>用来启动监听，它接受两个参数。</strong></p>

<ul>
  <li>第一个参数：所要观察的 DOM 节点</li>
  <li>第二个参数：一个配置对象，指定所要观察的特定变动</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">article</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">article</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span>  <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span> <span class="c1">// 配置对象，用于observer参数二，配置指定观察的特定变动</span>
  <span class="dl">'</span><span class="s1">childList</span><span class="dl">'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 子节点变动</span>
  <span class="dl">'</span><span class="s1">attributes</span><span class="dl">'</span><span class="p">:</span><span class="kc">true</span><span class="p">,</span> <span class="c1">// 属性变动</span>
  <span class="dl">'</span><span class="s1">characterData</span><span class="dl">'</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">// 节点内容或节点文本的变动</span>
<span class="p">}</span> <span class="p">;</span>

<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">article</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码中，<code class="language-plaintext highlighter-rouge">observe</code>方法接受两个参数，第一个是所要观察的DOM元素是<code class="language-plaintext highlighter-rouge">article</code>，第二个是所要观察的变动类型（子节点变动和属性变动）。</p>

<p>观察器所能观察的 DOM 变动类型（即上面代码的<code class="language-plaintext highlighter-rouge">options</code>对象），有以下几种。</p>

<ul>
  <li><strong>childList</strong>：子节点的变动（指新增，删除或者更改）。</li>
  <li><strong>attributes</strong>：属性的变动。</li>
  <li><strong>characterData</strong>：节点内容或节点文本的变动。</li>
</ul>

<p>想要观察哪一种变动类型，就在<code class="language-plaintext highlighter-rouge">option</code>对象中指定它的值为<code class="language-plaintext highlighter-rouge">true</code>。需要注意的是，必须同时指定<code class="language-plaintext highlighter-rouge">childList</code>、<code class="language-plaintext highlighter-rouge">attributes</code>和<code class="language-plaintext highlighter-rouge">characterData</code>中的一种或多种，若未均指定将报错。</p>

<p>除了变动类型，<code class="language-plaintext highlighter-rouge">options</code>对象还可以设定以下属性：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">subtree</code>：布尔值，表示是否将该观察器应用于该节点的所有后代节点。</li>
  <li><code class="language-plaintext highlighter-rouge">attributeOldValue</code>：布尔值，表示观察<code class="language-plaintext highlighter-rouge">attributes</code>变动时，是否需要记录变动前的属性值。</li>
  <li><code class="language-plaintext highlighter-rouge">characterDataOldValue</code>：布尔值，表示观察<code class="language-plaintext highlighter-rouge">characterData</code>变动时，是否需要记录变动前的值。</li>
  <li><code class="language-plaintext highlighter-rouge">attributeFilter</code>：数组，表示需要观察的特定属性（比如<code class="language-plaintext highlighter-rouge">['class','src']</code>）。</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 开始监听文档根节点（即&lt;html&gt;标签）的变动</span>
<span class="nx">mutationObserver</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">attributes</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 属性变动</span>
  <span class="na">characterData</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 节点内容或节点文本的变动</span>
  <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 子节点的变动</span>
  <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 是否将该观察器应用于该节点的所有后代节点</span>
  <span class="na">attributeOldValue</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 观察attributes变动时，是否需要记录变动前的属性值</span>
  <span class="na">characterDataOldValue</span><span class="p">:</span> <span class="kc">true</span> <span class="c1">// 观察characterData变动时，是否需要记录变动前的值。</span>
<span class="p">});</span>
</code></pre></div></div>

<p>对一个节点添加观察器，就像使用<code class="language-plaintext highlighter-rouge">addEventListener</code>方法一样，多次添加同一个观察器是无效的，回调函数依然只会触发一次。如果指定不同的<code class="language-plaintext highlighter-rouge">options</code>对象，以后面添加的那个为准，类似覆盖。</p>

<p>下面的例子是观察新增的子节点。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">insertedNodes</span> <span class="o">=</span> <span class="p">[];</span>
<span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mutations</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">mutations</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">mutation</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">mutation</span><span class="p">.</span><span class="nx">addedNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">insertedNodes</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">mutation</span><span class="p">.</span><span class="nx">addedNodes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">});</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">insertedNodes</span><span class="p">);</span>
<span class="p">});</span>
<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">,</span> <span class="p">{</span> <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
</code></pre></div></div>

<h4 id="32-disconnecttakerecords">3.2 disconnect()，takeRecords（）</h4>

<p><code class="language-plaintext highlighter-rouge">disconnect</code>方法<strong>用来停止观察。调用该方法后，DOM 再发生变动，也不会触发观察器</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observer</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">takeRecords</code>方法<strong>用来清除变动记录，即不再处理未处理的变动。该方法返回变动记录的数组</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">observer</span><span class="p">.</span><span class="nx">takeRecords</span><span class="p">();</span>
</code></pre></div></div>

<p>下面是一个例子。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 保存所有没有被观察器处理的变动</span>
<span class="kd">var</span> <span class="nx">changes</span> <span class="o">=</span> <span class="nx">mutationObserver</span><span class="p">.</span><span class="nx">takeRecords</span><span class="p">();</span>

<span class="c1">// 停止观察</span>
<span class="nx">mutationObserver</span><span class="p">.</span><span class="nx">disconnect</span><span class="p">();</span>
</code></pre></div></div>

<h3 id="4mutationrecord-对象-变动记录">4、MutationRecord 对象 (变动记录)</h3>

<p><strong>DOM 每次发生变化，就会生成一条变动记录（MutationRecord 实例）</strong>。该实例包含了与变动相关的所有信息。Mutation Observer 处理的就是一个个<code class="language-plaintext highlighter-rouge">MutationRecord</code>实例所组成的数组。</p>

<p><code class="language-plaintext highlighter-rouge">MutationRecord</code>对象包含了DOM的相关信息，有如下属性：</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">type</code>：观察的变动类型（<code class="language-plaintext highlighter-rouge">attributes</code>、<code class="language-plaintext highlighter-rouge">characterData</code>或者<code class="language-plaintext highlighter-rouge">childList</code>）。</li>
  <li><code class="language-plaintext highlighter-rouge">target</code>：发生变动的DOM节点。</li>
  <li><code class="language-plaintext highlighter-rouge">addedNodes</code>：新增的DOM节点。</li>
  <li><code class="language-plaintext highlighter-rouge">removedNodes</code>：删除的DOM节点。</li>
  <li><code class="language-plaintext highlighter-rouge">previousSibling</code>：前一个同级节点，如果没有则返回<code class="language-plaintext highlighter-rouge">null</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">nextSibling</code>：下一个同级节点，如果没有则返回<code class="language-plaintext highlighter-rouge">null</code>。</li>
  <li><code class="language-plaintext highlighter-rouge">attributeName</code>：发生变动的属性。如果设置了<code class="language-plaintext highlighter-rouge">attributeFilter</code>，则只返回预先指定的属性。</li>
  <li><code class="language-plaintext highlighter-rouge">oldValue</code>：变动前的值。这个属性只对<code class="language-plaintext highlighter-rouge">attribute</code>和<code class="language-plaintext highlighter-rouge">characterData</code>变动有效，如果发生<code class="language-plaintext highlighter-rouge">childList</code>变动，则返回<code class="language-plaintext highlighter-rouge">null</code>。</li>
</ul>

<h3 id="5应用示例">5、应用示例</h3>

<h4 id="51-子元素的变动">5.1 子元素的变动</h4>

<p>下面的例子说明如何读取变动记录。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">records</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">records</span><span class="p">)</span> <span class="c1">// records参数是 MutationRecord实例</span>
  <span class="nx">records</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">record</span><span class="p">){</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mutation type: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">record</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Mutation target: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">record</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>
<span class="cm">/*
    [MutationRecord]
    0: MutationRecord
    addedNodes: NodeList [text]
    attributeName: null
    attributeNamespace: null
    nextSibling: null
    oldValue: null
    previousSibling: script
    removedNodes: NodeList []
    target: body
    type: "childList"
    __proto__: MutationRecord
    length: 1
    __proto__: Array(0)
    Mutation type: childList
    test.html:23 Mutation target: [object HTMLBodyElement]
*/</span>
<span class="kd">var</span> <span class="nx">mo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">option</span> <span class="o">=</span> <span class="p">{</span>
  <span class="dl">'</span><span class="s1">childList</span><span class="dl">'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">subtree</span><span class="dl">'</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">};</span>

<span class="nx">mo</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">,</span> <span class="nx">option</span><span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">).</span><span class="nx">textContent</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">123</span><span class="dl">'</span><span class="p">)</span>
</code></pre></div></div>

<p>上面代码的观察器，观察<code class="language-plaintext highlighter-rouge"> &lt;body&gt; </code>的所有下级节点（<code class="language-plaintext highlighter-rouge">childList</code>表示观察子节点，<code class="language-plaintext highlighter-rouge">subtree</code>表示观察后代节点）的变动。回调函数会在控制台显示所有变动的类型和目标节点。</p>

<h4 id="52-属性的变动">5.2 属性的变动</h4>

<p>下面的例子说明如何追踪属性的变动。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">records</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">records</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">record</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Previous attribute value: </span><span class="dl">'</span> <span class="o">+</span> <span class="nx">record</span><span class="p">.</span><span class="nx">oldValue</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">mo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">#my_element</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
  <span class="dl">'</span><span class="s1">attributes</span><span class="dl">'</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="dl">'</span><span class="s1">attributeOldValue</span><span class="dl">'</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">}</span>

<span class="nx">mo</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
</code></pre></div></div>

<p>上面代码先设定追踪属性变动（<code class="language-plaintext highlighter-rouge">'attributes': true</code>），然后设定记录变动前的值。实际发生变动时，会将变动前的值显示在控制台。</p>

<h4 id="53-取代-domcontentloaded-事件">5.3 取代 DOMContentLoaded 事件</h4>

<p>网页加载的时候，DOM 节点的生成会产生变动记录，因此只要观察 DOM 的变动，就能在第一时间触发相关事件，也就没有必要使用<code class="language-plaintext highlighter-rouge">DOMContentLoaded</code>事件。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
<span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span>
<span class="p">});</span>
</code></pre></div></div>

<p>上面代码中，监听<code class="language-plaintext highlighter-rouge">document.documentElement</code>（即网页的<code class="language-plaintext highlighter-rouge"> &lt;html&gt; </code>HTML 节点）的子节点的变动，<code class="language-plaintext highlighter-rouge">subtree</code>属性指定监听还包括后代节点。因此，任意一个网页元素一旦生成，就能立刻被监听到。</p>

<h6 id="封装一个监听-dom-生成的函数">封装一个监听 DOM 生成的函数</h6>

<p>下面的代码，使用<code class="language-plaintext highlighter-rouge">MutationObserver</code>对象<strong>封装一个监听 DOM 生成的函数</strong>。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">win</span><span class="p">){</span>
  <span class="dl">'</span><span class="s1">use strict</span><span class="dl">'</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">listeners</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">doc</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">MutationObserver</span> <span class="o">=</span> <span class="nx">win</span><span class="p">.</span><span class="nx">MutationObserver</span> <span class="o">||</span> <span class="nx">win</span><span class="p">.</span><span class="nx">WebKitMutationObserver</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">observer</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">ready</span><span class="p">(</span><span class="nx">selector</span><span class="p">,</span> <span class="nx">fn</span><span class="p">){</span>
    <span class="c1">// 储存选择器和回调函数</span>
    <span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
      <span class="na">selector</span><span class="p">:</span> <span class="nx">selector</span><span class="p">,</span>
      <span class="na">fn</span><span class="p">:</span> <span class="nx">fn</span>
    <span class="p">});</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">observer</span><span class="p">){</span>
      <span class="c1">// 监听document变化</span>
      <span class="nx">observer</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MutationObserver</span><span class="p">(</span><span class="nx">check</span><span class="p">);</span>
      <span class="nx">observer</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nx">doc</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">,</span> <span class="p">{</span>
        <span class="na">childList</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="na">subtree</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">});</span>
    <span class="p">}</span>
    <span class="c1">// 检查该节点是否已经在DOM中</span>
    <span class="nx">check</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">check</span><span class="p">(){</span>
  <span class="c1">// 检查是否匹配已储存的节点</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="nx">listeners</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="c1">// 检查指定节点是否有匹配</span>
      <span class="kd">var</span> <span class="nx">elements</span> <span class="o">=</span> <span class="nx">doc</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">selector</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">elements</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">element</span> <span class="o">=</span> <span class="nx">elements</span><span class="p">[</span><span class="nx">j</span><span class="p">];</span>
        <span class="c1">// 确保回调函数只会对该元素调用一次</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">element</span><span class="p">.</span><span class="nx">ready</span><span class="p">){</span>
          <span class="nx">element</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="c1">// 对该节点调用回调函数</span>
          <span class="nx">listener</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">element</span><span class="p">,</span> <span class="nx">element</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="c1">// 对外暴露ready</span>
  <span class="nx">win</span><span class="p">.</span><span class="nx">ready</span> <span class="o">=</span> <span class="nx">ready</span><span class="p">;</span>

<span class="p">})(</span><span class="k">this</span><span class="p">);</span>

<span class="c1">// 使用方法</span>
<span class="nx">ready</span><span class="p">(</span><span class="dl">'</span><span class="s1">.foo</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">){</span>
  <span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div></div>

<h2 id="文档">文档</h2>

<p>学习文档：<a href="https://wangdoc.com/javascript/">https://wangdoc.com/javascript/</a></p>
