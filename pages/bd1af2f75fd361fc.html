<h1 id="vue项目使用mock数据的几种方式">Vue项目使用mock数据的几种方式</h1>

<p>本文是基于vue/cli 3.0创建的项目进行讲解</p>

<p>首先我们来说一说vue/cli 3.0 与 2.0 的一些不同：</p>

<ol>
  <li>3.0 移除了 static 文件目录，新增了 public 目录，这个目录下的静态资源不会经过 webpack 的处理，会被直接拷贝，所以我们能够直接访问到该目录下的资源，静态数据（如json数据、图片等）需要存放在这里。
<!-- more -->
    <blockquote>
      <p>放在<code class="language-plaintext highlighter-rouge">public</code>目录下的静态资源可直接通过(http://localhost:8080/+ 文件名称)来访问，不需要在前面加一个<code class="language-plaintext highlighter-rouge">/public</code>路径</p>
    </blockquote>
  </li>
  <li>3.0 移除了 config、build 等配置目录，如果需要进行相关配置我们需要在根目录下创建<code class="language-plaintext highlighter-rouge"> vue.config.js</code> 进行配置。</li>
</ol>

<h2 id="方式一使用mockjs插件实现本地mock数据">方式一：使用mockjs插件实现本地mock数据</h2>

<ol>
  <li>
    <p>安装<code class="language-plaintext highlighter-rouge">mockjs</code>插件</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm i mockjs <span class="nt">-D</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>在src目录下创建一个<code class="language-plaintext highlighter-rouge">mock</code>文件夹，在<code class="language-plaintext highlighter-rouge">mock</code>文件夹下创建一个<code class="language-plaintext highlighter-rouge">index.js</code>和一个<code class="language-plaintext highlighter-rouge">data</code>文件夹（用于存放项目需要的模拟数据）</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── src
│   ├── mock
│   │   └── data
│   │   │   └──  test.json
│   │   └── index.js 
.   .   
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">mock</code>目录下的<code class="language-plaintext highlighter-rouge">index.js</code>示例如下：</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">Mock</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">mockjs</span><span class="dl">'</span><span class="p">)</span>
    
<span class="c1">// 格式： Mock.mock( url, 'post'|'get' , 返回的数据)</span>
<span class="nx">Mock</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/test</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">get</span><span class="dl">'</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./data/test.json</span><span class="dl">'</span><span class="p">))</span>
<span class="nx">Mock</span><span class="p">.</span><span class="nx">mock</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/test2</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./data/test2.json</span><span class="dl">'</span><span class="p">))</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>在<code class="language-plaintext highlighter-rouge">main.js</code>入口文件中引入mock数据，不需要时，则注释掉</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./mock</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// 引入mock数据，不需要时，则注释掉</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>最后，在vue模板中使用即可</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/test</span><span class="dl">'</span><span class="p">)</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">})</span>
<span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="方式二在public文件夹放mock数据无需使用mockjs插件">方式二：在public文件夹放mock数据（无需使用mockjs插件）</h2>

<ol>
  <li>
    <p>在<code class="language-plaintext highlighter-rouge">public</code>文件夹下创建一个<code class="language-plaintext highlighter-rouge">mock</code>文件夹，用来存放模拟数据的json文件</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── public
│   ├── mock
│   │   └── test.json 
.   .   
</code></pre></div>    </div>

    <blockquote>
      <p>放在<code class="language-plaintext highlighter-rouge">public</code>目录下的静态资源可直接通过(http://localhost:8080/ + 文件名称)来访问，不需要在前面加一个<code class="language-plaintext highlighter-rouge">/public</code>路径。</p>
    </blockquote>
  </li>
  <li>
    <p>在<code class="language-plaintext highlighter-rouge">vue.config.js</code>里进行路径配置，如下:</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
 <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
   <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
     <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// 代理接口</span>
       <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:8080</span><span class="dl">'</span><span class="p">,</span>
       <span class="na">ws</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// proxy websockets</span>
       <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 是否开启跨域</span>
       <span class="na">pathRewrite</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// 路径重写</span>
         <span class="dl">'</span><span class="s1">^/api</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/mock</span><span class="dl">'</span>
       <span class="p">}</span>
     <span class="p">}</span>
   <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>

    <p><a href="https://cli.vuejs.org/zh/config/#devserver-proxy">devServer.proxy官方文档</a></p>
  </li>
  <li>
    <p>最后，在vue模板中使用即可</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/test.json</span><span class="dl">'</span><span class="p">)</span> <span class="c1">// 注意这里需要.json后缀</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">})</span>
<span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>
  </li>
</ol>

<blockquote>
  <p>这方式貌似不支持<code class="language-plaintext highlighter-rouge">post</code>请求，有待研究。</p>
</blockquote>

<h2 id="方式三前端本地启动一个nodejs服务vue项目向nodejs服务请求mock数据">方式三：前端本地启动一个nodejs服务，vue项目向nodejs服务请求mock数据</h2>

<ol>
  <li>
    <p>创建一个node项目（为了方便，本例直接在vue项目根目录创建，当然也可以是其它任何地方）</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>.
├── 项目根目录
│   └── serve.js
.   .  
</code></pre></div>    </div>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">serve.js</code>示例</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">http</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">http</span><span class="dl">'</span><span class="p">)</span>
<span class="c1">// url模块用于处理与解析 前端传给后台的URL，适用于get请求（不适用于post请求），详情参见文档</span>
<span class="kd">const</span> <span class="nx">urlLib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">url</span><span class="dl">'</span><span class="p">)</span>
   
<span class="nx">http</span><span class="p">.</span><span class="nx">createServer</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">urlObj</span> <span class="o">=</span> <span class="nx">urlLib</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span> <span class="c1">// 注意：这里的第二个参数一定要设置为：true, query才能解析为对象形式,可以更加方便地获取key:value</span>
  <span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">urlObj</span><span class="p">.</span><span class="nx">pathname</span>
  <span class="kd">const</span> <span class="kd">get</span> <span class="o">=</span> <span class="nx">urlObj</span><span class="p">.</span><span class="nx">query</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
  <span class="c1">// 模拟的mock数据</span>
  <span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
    <span class="dl">"</span><span class="s2">code</span><span class="dl">"</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span>
    <span class="dl">"</span><span class="s2">list</span><span class="dl">"</span><span class="p">:</span> <span class="p">[</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0001</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test</span><span class="dl">"</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span> <span class="dl">'</span><span class="s1">0002</span><span class="dl">'</span><span class="p">,</span>
            <span class="dl">"</span><span class="s2">name</span><span class="dl">"</span><span class="p">:</span> <span class="dl">"</span><span class="s2">test2</span><span class="dl">"</span>
        <span class="p">}</span>
    <span class="p">]</span>
  <span class="p">}</span>
   
  <span class="c1">// console.log(get.user)</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">url</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">/test</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 接口名</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span>
  <span class="p">}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">()</span>
<span class="p">}).</span><span class="nx">listen</span><span class="p">(</span><span class="mi">9000</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>启动node服务</p>

    <div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node serve.js
</code></pre></div>    </div>
  </li>
  <li>
    <p>配置<code class="language-plaintext highlighter-rouge">vue.config.js</code>的<code class="language-plaintext highlighter-rouge">proxy</code>，解决跨域</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
 <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
   <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
     <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
       <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://localhost:9000</span><span class="dl">'</span><span class="p">,</span>
       <span class="na">ws</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// proxy websockets</span>
       <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 是否开启跨域</span>
       <span class="na">pathRewrite</span><span class="p">:</span> <span class="p">{</span> <span class="c1">// 路径重写</span>
         <span class="dl">'</span><span class="s1">^/api</span><span class="dl">'</span><span class="p">:</span> <span class="dl">''</span>
       <span class="p">}</span>
     <span class="p">}</span>
   <span class="p">}</span>
 <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>最后，在vue模板中使用即可</p>

    <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/api/test</span><span class="dl">'</span><span class="p">)</span>
<span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
<span class="p">})</span>
<span class="p">.</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>    </div>
  </li>
</ol>

<h2 id="总结">总结</h2>

<p>方式二目前来看只支持get方式请求，对于post请求还有待研究。方式三虽然也是一种实现方式，但实现起来比较麻烦。个人建议使用方式一，灵活、方便。</p>

<h2 id="相关文章">相关文章</h2>

<p><a href="https://maoyln.com/pages/5d463fbdb172d43b/">《Vue CLi3 修改webpack配置》</a></p>

