<h1 id="axios-函数重载">axios 函数重载</h1>

<h2 id="需求分析">需求分析</h2>

<p>目前我们的 axios 函数只支持传入 1 个参数，如下：</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/extend/post</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>我们希望该函数也能支持传入 2 个参数，如下：</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">(</span><span class="dl">'</span><span class="s1">/extend/post</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>第一个参数是 <code class="language-plaintext highlighter-rouge">url</code>，第二个参数是 <code class="language-plaintext highlighter-rouge">config</code>，这个函数有点类似 <code class="language-plaintext highlighter-rouge">axios.get</code> 方法支持的参数类型，不同的是如果我们想要指定 HTTP 方法类型，仍然需要在 <code class="language-plaintext highlighter-rouge">config</code> 传入 <code class="language-plaintext highlighter-rouge">method</code>。</p>

<p>这就用到我们之前所学的函数重载知识点了，接下来我们来实现它。</p>

<h2 id="重载实现">重载实现</h2>

<p>首先我们要修改 <code class="language-plaintext highlighter-rouge">AxiosInstance</code> 的类型定义。</p>

<p><code class="language-plaintext highlighter-rouge">types/index.ts</code>：</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">export</span> <span class="kr">interface</span> <span class="nx">AxiosInstance</span> <span class="kd">extends</span> <span class="nx">Axios</span> <span class="p">{</span>
  <span class="p">(</span><span class="nx">config</span><span class="p">:</span> <span class="nx">AxiosRequestConfig</span><span class="p">):</span> <span class="nx">AxiosPromise</span>

  <span class="p">(</span><span class="nx">url</span><span class="p">:</span> <span class="kr">string</span><span class="p">,</span> <span class="nx">config</span><span class="p">?:</span> <span class="nx">AxiosRequestConfig</span><span class="p">):</span> <span class="nx">AxiosPromise</span>
<span class="p">}</span>
</code></pre></div></div>

<p>我们增加一种函数的定义，它支持 2 个参数，其中 <code class="language-plaintext highlighter-rouge">url</code> 是必选参数，<code class="language-plaintext highlighter-rouge">config</code> 是可选参数。</p>

<p>由于 <code class="language-plaintext highlighter-rouge">axios</code> 函数实际上指向的是 <code class="language-plaintext highlighter-rouge">request</code> 函数，所以我们来修改 <code class="language-plaintext highlighter-rouge">request</code> 函数的实现。</p>

<p><code class="language-plaintext highlighter-rouge">core/Axios.ts</code>：</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="nx">request</span><span class="p">(</span><span class="nx">url</span><span class="p">:</span> <span class="kr">any</span><span class="p">,</span> <span class="nx">config</span><span class="p">?:</span> <span class="kr">any</span><span class="p">):</span> <span class="nx">AxiosPromise</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">url</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">config</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="p">}</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">config</span> <span class="o">=</span> <span class="nx">url</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">dispatchRequest</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span>
  <span class="p">}</span>
</code></pre></div></div>

<p>我们把 <code class="language-plaintext highlighter-rouge">request</code> 函数的参数改成 2 个，<code class="language-plaintext highlighter-rouge">url</code> 和 <code class="language-plaintext highlighter-rouge">config</code> 都是 <code class="language-plaintext highlighter-rouge">any</code> 类型，<code class="language-plaintext highlighter-rouge">config</code> 还是可选参数。</p>

<p>接着在函数体我们判断 <code class="language-plaintext highlighter-rouge">url</code> 是否为字符串类型，一旦它为字符串类型，则继续对 <code class="language-plaintext highlighter-rouge">config</code> 判断，因为它可能不传，如果为空则构造一个空对象，然后把 <code class="language-plaintext highlighter-rouge">url</code> 添加到 <code class="language-plaintext highlighter-rouge">config.url</code> 中。如果 <code class="language-plaintext highlighter-rouge">url</code> 不是字符串类型，则说明我们传入的就是单个参数，且 <code class="language-plaintext highlighter-rouge">url</code> 就是 <code class="language-plaintext highlighter-rouge">config</code>，因此把 <code class="language-plaintext highlighter-rouge">url</code> 赋值给 <code class="language-plaintext highlighter-rouge">config</code>。</p>

<p>这里要注意的是，我们虽然修改了 <code class="language-plaintext highlighter-rouge">request</code> 的实现，支持了 2 种参数，但是我们对外提供的 <code class="language-plaintext highlighter-rouge">request</code> 接口仍然不变，可以理解为这仅仅是内部的实现的修改，与对外接口不必一致，只要保留实现兼容接口即可。</p>

<h2 id="编写-demo">编写 demo</h2>

<p><code class="language-plaintext highlighter-rouge">examples/extend/app.ts</code>：</p>

<div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">axios</span><span class="p">({</span>
  <span class="na">url</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/extend/post</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hi</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">})</span>

<span class="nx">axios</span><span class="p">(</span><span class="dl">'</span><span class="s1">/extend/post</span><span class="dl">'</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">method</span><span class="p">:</span> <span class="dl">'</span><span class="s1">post</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">msg</span><span class="p">:</span> <span class="dl">'</span><span class="s1">hello</span><span class="dl">'</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre></div></div>

<p>我们使用了 <code class="language-plaintext highlighter-rouge">axios</code> 2 种请求方式，打开页面运行 <code class="language-plaintext highlighter-rouge">demo</code>，通过 network 我们可以看到 2 种请求都是运行正常的。</p>

<p>至此我们实现了 <code class="language-plaintext highlighter-rouge">axios</code> 函数的重载。官方 axios 支持了一种能力，我们可以去定义返回数据的类型，并在请求的时候指定该类型，然后在响应数据中我们就可以获取到该数据类型。下一节课我们就来实现这个 feature。</p>
