<h1 id="vue-cli3-修改webpack配置">Vue CLi3 修改webpack配置</h1>

<h2 id="审查项目的-webpack-配置">审查项目的 webpack 配置</h2>

<p>因为 <code class="language-plaintext highlighter-rouge">@vue/cli-service</code> 对 webpack 配置进行了抽象，当你想查看webpack的配置时可以使用 <code class="language-plaintext highlighter-rouge">inspect</code>命令：
<!-- more --></p>
<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vue inspect <span class="c"># 在终端打印 webpack配置信息</span>
</code></pre></div></div>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vue inspect <span class="o">&gt;</span> output.js <span class="c"># 把webpack配置信息生成到output.js文件</span>
</code></pre></div></div>

<p>注意，<code class="language-plaintext highlighter-rouge">output.js</code> 文件不是一个有效的 webpack 配置文件，仅用于审查。</p>

<h2 id="修改webpack配置">修改webpack配置</h2>

<p>以<strong>修改路径别名</strong>为例：</p>

<ol>
  <li>
    <p>项目根目录创建文件 <code class="language-plaintext highlighter-rouge">vue.config.js</code></p>
  </li>
  <li>
    <p>参考如下代码修改路径别名：</p>
  </li>
</ol>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// vue.config.js</span>
<span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">resolve</span> <span class="o">=</span> <span class="nx">dir</span> <span class="o">=&gt;</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">dir</span><span class="p">)</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">chainWebpack</span><span class="p">:</span> <span class="nx">config</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span>
      <span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">styles</span><span class="dl">'</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">src/assets/styles</span><span class="dl">'</span><span class="p">))</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="https://cli.vuejs.org/zh/guide/webpack.html">官方文档</a></li>
  <li><a href="https://cli.vuejs.org/zh/config/#vue-config-js">官方 vue.config.js 参数说明</a></li>
  <li>
    <p><a href="https://github.com/ustbhuangyi/vue-music/blob/master/vue.config.js">vue.config.js 设置接口代理示例</a></p>
  </li>
  <li>配置示例：</li>
</ul>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">UglifyJsPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">uglifyjs-webpack-plugin</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">ProxyAgent</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">proxy-agent</span><span class="dl">'</span><span class="p">)</span>
<span class="kd">const</span> <span class="nx">resolve</span> <span class="o">=</span> <span class="nx">dir</span> <span class="o">=&gt;</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="nx">dir</span><span class="p">)</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">outputDir</span><span class="p">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">outputDir</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">,</span> <span class="c1">// 'dist', 生产环境构建文件的目录</span>
  <span class="na">runtimeCompiler</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">assetsDir</span><span class="p">:</span> <span class="dl">'</span><span class="s1">static</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">productionSourceMap</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// 生产环境的 source map</span>
  <span class="na">parallel</span><span class="p">:</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">os</span><span class="dl">'</span><span class="p">).</span><span class="nx">cpus</span><span class="p">().</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">,</span>
  <span class="na">configureWebpack</span><span class="p">:</span> <span class="nx">config</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="c1">// 公共配置</span>
    <span class="c1">// cdn引用时配置externals 防止将某些 import 的包(package)打包到 bundle 中，而是在运行时(runtime)再去从外部获取这些扩展依赖</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">externals</span> <span class="o">=</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">vue</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Vue</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">vue-router</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">VueRouter</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">element-ui</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ELEMENT</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">vuex</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Vuex</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">axios</span><span class="dl">'</span>
    <span class="p">}</span>
    <span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">assign</span><span class="p">({},</span> <span class="nx">config</span><span class="p">.</span><span class="nx">resolve</span><span class="p">.</span><span class="nx">alias</span><span class="p">,</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">src</span><span class="dl">'</span><span class="p">:</span> <span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">src/common</span><span class="dl">'</span><span class="p">),</span>
      <span class="dl">'</span><span class="s1">common</span><span class="dl">'</span><span class="p">:</span> <span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">src/views/common</span><span class="dl">'</span><span class="p">),</span>
      <span class="dl">'</span><span class="s1">static</span><span class="dl">'</span><span class="p">:</span> <span class="nx">resolve</span><span class="p">(</span><span class="dl">'</span><span class="s1">static</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">production</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// 为生产环境修改配置...</span>
      <span class="nx">config</span><span class="p">.</span><span class="nx">optimization</span> <span class="o">=</span> <span class="p">{</span>
        <span class="na">minimizer</span><span class="p">:</span> <span class="p">[</span>
          <span class="k">new</span> <span class="nx">UglifyJsPlugin</span><span class="p">({</span>
            <span class="na">uglifyOptions</span><span class="p">:</span> <span class="p">{</span>
              <span class="na">compress</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">drop_console</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// console</span>
                <span class="na">drop_debugger</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="na">pure_funcs</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">console.log</span><span class="dl">'</span><span class="p">]</span><span class="c1">// 移除console</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">})</span>
        <span class="p">]</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// 为开发环境修改配置...</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">css</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">loaderOptions</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">css</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">importLoaders</span><span class="p">:</span> <span class="mi">1</span> <span class="c1">// @import 引入的文件可被一个loader处理 （2 可被两个loader处理）</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">},</span>
  <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">port</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="na">disableHostCheck</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// 可使用本地host配置的域名访问</span>
    <span class="na">proxy</span><span class="p">:</span> <span class="p">{</span>
      <span class="dl">'</span><span class="s1">/api</span><span class="dl">'</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">agent</span><span class="p">:</span> <span class="k">new</span> <span class="nx">ProxyAgent</span><span class="p">(</span><span class="dl">'</span><span class="s1">http://132.128.11.12</span><span class="dl">'</span><span class="p">),</span>
        <span class="na">target</span><span class="p">:</span> <span class="dl">'</span><span class="s1">http://132.128.11.12</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">ws</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="na">changeOrigin</span><span class="p">:</span> <span class="kc">true</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
